!function(){"use strict";function e(e,t){for(var s=0;s<t.length;s++){const r=t[s];if("string"!=typeof r&&!Array.isArray(r))for(const t in r)if("default"!==t&&!(t in e)){const s=Object.getOwnPropertyDescriptor(r,t);s&&Object.defineProperty(e,t,s.get?s:{enumerable:!0,get:()=>r[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}
/**
  * @vue/shared v3.5.25
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **/function t(e){const t=Object.create(null);for(const s of e.split(","))t[s]=1;return e=>e in t}const s={},r=[],n=()=>{},i=()=>!1,a=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),o=e=>e.startsWith("onUpdate:"),l=Object.assign,c=(e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)},u=Object.prototype.hasOwnProperty,d=(e,t)=>u.call(e,t),h=Array.isArray,f=e=>"[object Map]"===k(e),p=e=>"[object Set]"===k(e),v=e=>"[object Date]"===k(e),g=e=>"function"==typeof e,y=e=>"string"==typeof e,m=e=>"symbol"==typeof e,_=e=>null!==e&&"object"==typeof e,b=e=>(_(e)||g(e))&&g(e.then)&&g(e.catch),w=Object.prototype.toString,k=e=>w.call(e),S=e=>"[object Object]"===k(e),E=e=>y(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,O=t(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),T=e=>{const t=Object.create(null);return s=>t[s]||(t[s]=e(s))},C=/-\w/g,A=T(e=>e.replace(C,e=>e.slice(1).toUpperCase())),j=/\B([A-Z])/g,x=T(e=>e.replace(j,"-$1").toLowerCase()),R=T(e=>e.charAt(0).toUpperCase()+e.slice(1)),P=T(e=>e?`on${R(e)}`:""),I=(e,t)=>!Object.is(e,t),$=(e,...t)=>{for(let s=0;s<e.length;s++)e[s](...t)},N=(e,t,s,r=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:r,value:s})},U=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let L;const D=()=>L||(L="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{});function B(e){if(h(e)){const t={};for(let s=0;s<e.length;s++){const r=e[s],n=y(r)?V(r):B(r);if(n)for(const e in n)t[e]=n[e]}return t}if(y(e)||_(e))return e}const F=/;(?![^(]*\))/g,M=/:([^]+)/,q=/\/\*[^]*?\*\//g;function V(e){const t={};return e.replace(q,"").split(F).forEach(e=>{if(e){const s=e.split(M);s.length>1&&(t[s[0].trim()]=s[1].trim())}}),t}function W(e){let t="";if(y(e))t=e;else if(h(e))for(let s=0;s<e.length;s++){const r=W(e[s]);r&&(t+=r+" ")}else if(_(e))for(const s in e)e[s]&&(t+=s+" ");return t.trim()}const K=t("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function z(e){return!!e||""===e}function H(e,t){if(e===t)return!0;let s=v(e),r=v(t);if(s||r)return!(!s||!r)&&e.getTime()===t.getTime();if(s=m(e),r=m(t),s||r)return e===t;if(s=h(e),r=h(t),s||r)return!(!s||!r)&&function(e,t){if(e.length!==t.length)return!1;let s=!0;for(let r=0;s&&r<e.length;r++)s=H(e[r],t[r]);return s}(e,t);if(s=_(e),r=_(t),s||r){if(!s||!r)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e){const r=e.hasOwnProperty(s),n=t.hasOwnProperty(s);if(r&&!n||!r&&n||!H(e[s],t[s]))return!1}}return String(e)===String(t)}function J(e,t){return e.findIndex(e=>H(e,t))}const G=e=>!(!e||!0!==e.__v_isRef),Y=e=>y(e)?e:null==e?"":h(e)||_(e)&&(e.toString===w||!g(e.toString))?G(e)?Y(e.value):JSON.stringify(e,Q,2):String(e),Q=(e,t)=>G(t)?Q(e,t.value):f(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[t,s],r)=>(e[X(t,r)+" =>"]=s,e),{})}:p(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>X(e))}:m(t)?X(t):!_(t)||h(t)||S(t)?t:String(t),X=(e,t="")=>{var s;return m(e)?`Symbol(${null!=(s=e.description)?s:t})`:e};
/**
  * @vue/reactivity v3.5.25
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **/
let Z,ee;class te{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Z,!e&&Z&&(this.index=(Z.scopes||(Z.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let e,t;if(this._isPaused=!0,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){let e,t;if(this._isPaused=!1,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Z;try{return Z=this,e()}finally{Z=t}}}on(){1===++this._on&&(this.prevScope=Z,Z=this)}off(){this._on>0&&0===--this._on&&(Z=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){let t,s;for(this._active=!1,t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(this.effects.length=0,t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0}}}const se=new WeakSet;class re{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Z&&Z.active&&Z.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,se.has(this)&&(se.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||oe(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,be(this),ue(this);const e=ee,t=ge;ee=this,ge=!0;try{return this.fn()}finally{de(this),ee=e,ge=t,this.flags&=-3}}stop(){if(1&this.flags){for(let e=this.deps;e;e=e.nextDep)pe(e);this.deps=this.depsTail=void 0,be(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?se.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){he(this)&&this.run()}get dirty(){return he(this)}}let ne,ie,ae=0;function oe(e,t=!1){if(e.flags|=8,t)return e.next=ie,void(ie=e);e.next=ne,ne=e}function le(){ae++}function ce(){if(--ae>0)return;if(ie){let e=ie;for(ie=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let e;for(;ne;){let s=ne;for(ne=void 0;s;){const r=s.next;if(s.next=void 0,s.flags&=-9,1&s.flags)try{s.trigger()}catch(t){e||(e=t)}s=r}}if(e)throw e}function ue(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function de(e){let t,s=e.depsTail,r=s;for(;r;){const e=r.prevDep;-1===r.version?(r===s&&(s=e),pe(r),ve(r)):t=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=e}e.deps=t,e.depsTail=s}function he(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(fe(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function fe(e){if(4&e.flags&&!(16&e.flags))return;if(e.flags&=-17,e.globalVersion===we)return;if(e.globalVersion=we,!e.isSSR&&128&e.flags&&(!e.deps&&!e._dirty||!he(e)))return;e.flags|=2;const t=e.dep,s=ee,r=ge;ee=e,ge=!0;try{ue(e);const s=e.fn(e._value);(0===t.version||I(s,e._value))&&(e.flags|=128,e._value=s,t.version++)}catch(n){throw t.version++,n}finally{ee=s,ge=r,de(e),e.flags&=-3}}function pe(e,t=!1){const{dep:s,prevSub:r,nextSub:n}=e;if(r&&(r.nextSub=n,e.prevSub=void 0),n&&(n.prevSub=r,e.nextSub=void 0),s.subs===e&&(s.subs=r,!r&&s.computed)){s.computed.flags&=-5;for(let e=s.computed.deps;e;e=e.nextDep)pe(e,!0)}t||--s.sc||!s.map||s.map.delete(s.key)}function ve(e){const{prevDep:t,nextDep:s}=e;t&&(t.nextDep=s,e.prevDep=void 0),s&&(s.prevDep=t,e.nextDep=void 0)}let ge=!0;const ye=[];function me(){ye.push(ge),ge=!1}function _e(){const e=ye.pop();ge=void 0===e||e}function be(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const e=ee;ee=void 0;try{t()}finally{ee=e}}}let we=0;class ke{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Se{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!ee||!ge||ee===this.computed)return;let t=this.activeLink;if(void 0===t||t.sub!==ee)t=this.activeLink=new ke(ee,this),ee.deps?(t.prevDep=ee.depsTail,ee.depsTail.nextDep=t,ee.depsTail=t):ee.deps=ee.depsTail=t,Ee(t);else if(-1===t.version&&(t.version=this.version,t.nextDep)){const e=t.nextDep;e.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=e),t.prevDep=ee.depsTail,t.nextDep=void 0,ee.depsTail.nextDep=t,ee.depsTail=t,ee.deps===t&&(ee.deps=e)}return t}trigger(e){this.version++,we++,this.notify(e)}notify(e){le();try{0;for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{ce()}}}function Ee(e){if(e.dep.sc++,4&e.sub.flags){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let e=t.deps;e;e=e.nextDep)Ee(e)}const s=e.dep.subs;s!==e&&(e.prevSub=s,s&&(s.nextSub=e)),e.dep.subs=e}}const Oe=new WeakMap,Te=Symbol(""),Ce=Symbol(""),Ae=Symbol("");function je(e,t,s){if(ge&&ee){let t=Oe.get(e);t||Oe.set(e,t=new Map);let r=t.get(s);r||(t.set(s,r=new Se),r.map=t,r.key=s),r.track()}}function xe(e,t,s,r,n,i){const a=Oe.get(e);if(!a)return void we++;const o=e=>{e&&e.trigger()};if(le(),"clear"===t)a.forEach(o);else{const n=h(e),i=n&&E(s);if(n&&"length"===s){const e=Number(r);a.forEach((t,s)=>{("length"===s||s===Ae||!m(s)&&s>=e)&&o(t)})}else switch((void 0!==s||a.has(void 0))&&o(a.get(s)),i&&o(a.get(Ae)),t){case"add":n?i&&o(a.get("length")):(o(a.get(Te)),f(e)&&o(a.get(Ce)));break;case"delete":n||(o(a.get(Te)),f(e)&&o(a.get(Ce)));break;case"set":f(e)&&o(a.get(Te))}}ce()}function Re(e){const t=gt(e);return t===e?t:(je(t,0,Ae),pt(e)?t:t.map(yt))}function Pe(e){return je(e=gt(e),0,Ae),e}function Ie(e,t){return ft(e)?ht(e)?mt(yt(t)):mt(t):yt(t)}const $e={__proto__:null,[Symbol.iterator](){return Ne(this,Symbol.iterator,e=>Ie(this,e))},concat(...e){return Re(this).concat(...e.map(e=>h(e)?Re(e):e))},entries(){return Ne(this,"entries",e=>(e[1]=Ie(this,e[1]),e))},every(e,t){return Le(this,"every",e,t,void 0,arguments)},filter(e,t){return Le(this,"filter",e,t,e=>e.map(e=>Ie(this,e)),arguments)},find(e,t){return Le(this,"find",e,t,e=>Ie(this,e),arguments)},findIndex(e,t){return Le(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return Le(this,"findLast",e,t,e=>Ie(this,e),arguments)},findLastIndex(e,t){return Le(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return Le(this,"forEach",e,t,void 0,arguments)},includes(...e){return Be(this,"includes",e)},indexOf(...e){return Be(this,"indexOf",e)},join(e){return Re(this).join(e)},lastIndexOf(...e){return Be(this,"lastIndexOf",e)},map(e,t){return Le(this,"map",e,t,void 0,arguments)},pop(){return Fe(this,"pop")},push(...e){return Fe(this,"push",e)},reduce(e,...t){return De(this,"reduce",e,t)},reduceRight(e,...t){return De(this,"reduceRight",e,t)},shift(){return Fe(this,"shift")},some(e,t){return Le(this,"some",e,t,void 0,arguments)},splice(...e){return Fe(this,"splice",e)},toReversed(){return Re(this).toReversed()},toSorted(e){return Re(this).toSorted(e)},toSpliced(...e){return Re(this).toSpliced(...e)},unshift(...e){return Fe(this,"unshift",e)},values(){return Ne(this,"values",e=>Ie(this,e))}};function Ne(e,t,s){const r=Pe(e),n=r[t]();return r===e||pt(e)||(n._next=n.next,n.next=()=>{const e=n._next();return e.done||(e.value=s(e.value)),e}),n}const Ue=Array.prototype;function Le(e,t,s,r,n,i){const a=Pe(e),o=a!==e&&!pt(e),l=a[t];if(l!==Ue[t]){const t=l.apply(e,i);return o?yt(t):t}let c=s;a!==e&&(o?c=function(t,r){return s.call(this,Ie(e,t),r,e)}:s.length>2&&(c=function(t,r){return s.call(this,t,r,e)}));const u=l.call(a,c,r);return o&&n?n(u):u}function De(e,t,s,r){const n=Pe(e);let i=s;return n!==e&&(pt(e)?s.length>3&&(i=function(t,r,n){return s.call(this,t,r,n,e)}):i=function(t,r,n){return s.call(this,t,Ie(e,r),n,e)}),n[t](i,...r)}function Be(e,t,s){const r=gt(e);je(r,0,Ae);const n=r[t](...s);return-1!==n&&!1!==n||!vt(s[0])?n:(s[0]=gt(s[0]),r[t](...s))}function Fe(e,t,s=[]){me(),le();const r=gt(e)[t].apply(e,s);return ce(),_e(),r}const Me=t("__proto__,__v_isRef,__isVue"),qe=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>"arguments"!==e&&"caller"!==e).map(e=>Symbol[e]).filter(m));function Ve(e){m(e)||(e=String(e));const t=gt(this);return je(t,0,e),t.hasOwnProperty(e)}class We{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,s){if("__v_skip"===t)return e.__v_skip;const r=this._isReadonly,n=this._isShallow;if("__v_isReactive"===t)return!r;if("__v_isReadonly"===t)return r;if("__v_isShallow"===t)return n;if("__v_raw"===t)return s===(r?n?ot:at:n?it:nt).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const i=h(e);if(!r){let e;if(i&&(e=$e[t]))return e;if("hasOwnProperty"===t)return Ve}const a=Reflect.get(e,t,_t(e)?e:s);if(m(t)?qe.has(t):Me(t))return a;if(r||je(e,0,t),n)return a;if(_t(a)){const e=i&&E(t)?a:a.value;return r&&_(e)?ut(e):e}return _(a)?r?ut(a):ct(a):a}}class Ke extends We{constructor(e=!1){super(!1,e)}set(e,t,s,r){let n=e[t];const i=h(e)&&E(t);if(!this._isShallow){const e=ft(n);if(pt(s)||ft(s)||(n=gt(n),s=gt(s)),!i&&_t(n)&&!_t(s))return e||(n.value=s),!0}const a=i?Number(t)<e.length:d(e,t),o=Reflect.set(e,t,s,_t(e)?e:r);return e===gt(r)&&(a?I(s,n)&&xe(e,"set",t,s):xe(e,"add",t,s)),o}deleteProperty(e,t){const s=d(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&s&&xe(e,"delete",t,void 0),r}has(e,t){const s=Reflect.has(e,t);return m(t)&&qe.has(t)||je(e,0,t),s}ownKeys(e){return je(e,0,h(e)?"length":Te),Reflect.ownKeys(e)}}class ze extends We{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const He=new Ke,Je=new ze,Ge=new Ke(!0),Ye=e=>e,Qe=e=>Reflect.getPrototypeOf(e);function Xe(e){return function(...t){return"delete"!==e&&("clear"===e?void 0:this)}}function Ze(e,t){const s={get(s){const r=this.__v_raw,n=gt(r),i=gt(s);e||(I(s,i)&&je(n,0,s),je(n,0,i));const{has:a}=Qe(n),o=t?Ye:e?mt:yt;return a.call(n,s)?o(r.get(s)):a.call(n,i)?o(r.get(i)):void(r!==n&&r.get(s))},get size(){const t=this.__v_raw;return!e&&je(gt(t),0,Te),t.size},has(t){const s=this.__v_raw,r=gt(s),n=gt(t);return e||(I(t,n)&&je(r,0,t),je(r,0,n)),t===n?s.has(t):s.has(t)||s.has(n)},forEach(s,r){const n=this,i=n.__v_raw,a=gt(i),o=t?Ye:e?mt:yt;return!e&&je(a,0,Te),i.forEach((e,t)=>s.call(r,o(e),o(t),n))}};l(s,e?{add:Xe("add"),set:Xe("set"),delete:Xe("delete"),clear:Xe("clear")}:{add(e){t||pt(e)||ft(e)||(e=gt(e));const s=gt(this);return Qe(s).has.call(s,e)||(s.add(e),xe(s,"add",e,e)),this},set(e,s){t||pt(s)||ft(s)||(s=gt(s));const r=gt(this),{has:n,get:i}=Qe(r);let a=n.call(r,e);a||(e=gt(e),a=n.call(r,e));const o=i.call(r,e);return r.set(e,s),a?I(s,o)&&xe(r,"set",e,s):xe(r,"add",e,s),this},delete(e){const t=gt(this),{has:s,get:r}=Qe(t);let n=s.call(t,e);n||(e=gt(e),n=s.call(t,e)),r&&r.call(t,e);const i=t.delete(e);return n&&xe(t,"delete",e,void 0),i},clear(){const e=gt(this),t=0!==e.size,s=e.clear();return t&&xe(e,"clear",void 0,void 0),s}});return["keys","values","entries",Symbol.iterator].forEach(r=>{s[r]=function(e,t,s){return function(...r){const n=this.__v_raw,i=gt(n),a=f(i),o="entries"===e||e===Symbol.iterator&&a,l="keys"===e&&a,c=n[e](...r),u=s?Ye:t?mt:yt;return!t&&je(i,0,l?Ce:Te),{next(){const{value:e,done:t}=c.next();return t?{value:e,done:t}:{value:o?[u(e[0]),u(e[1])]:u(e),done:t}},[Symbol.iterator](){return this}}}}(r,e,t)}),s}function et(e,t){const s=Ze(e,t);return(t,r,n)=>"__v_isReactive"===r?!e:"__v_isReadonly"===r?e:"__v_raw"===r?t:Reflect.get(d(s,r)&&r in t?s:t,r,n)}const tt={get:et(!1,!1)},st={get:et(!1,!0)},rt={get:et(!0,!1)},nt=new WeakMap,it=new WeakMap,at=new WeakMap,ot=new WeakMap;function lt(e){return e.__v_skip||!Object.isExtensible(e)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}((e=>k(e).slice(8,-1))(e))}function ct(e){return ft(e)?e:dt(e,!1,He,tt,nt)}function ut(e){return dt(e,!0,Je,rt,at)}function dt(e,t,s,r,n){if(!_(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const i=lt(e);if(0===i)return e;const a=n.get(e);if(a)return a;const o=new Proxy(e,2===i?r:s);return n.set(e,o),o}function ht(e){return ft(e)?ht(e.__v_raw):!(!e||!e.__v_isReactive)}function ft(e){return!(!e||!e.__v_isReadonly)}function pt(e){return!(!e||!e.__v_isShallow)}function vt(e){return!!e&&!!e.__v_raw}function gt(e){const t=e&&e.__v_raw;return t?gt(t):e}const yt=e=>_(e)?ct(e):e,mt=e=>_(e)?ut(e):e;function _t(e){return!!e&&!0===e.__v_isRef}function bt(e){return function(e,t){if(_t(e))return e;return new wt(e,t)}(e,!1)}class wt{constructor(e,t){this.dep=new Se,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:gt(e),this._value=t?e:yt(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,s=this.__v_isShallow||pt(e)||ft(e);e=s?e:gt(e),I(e,t)&&(this._rawValue=e,this._value=s?e:yt(e),this.dep.trigger())}}function kt(e){return _t(e)?e.value:e}const St={get:(e,t,s)=>"__v_raw"===t?e:kt(Reflect.get(e,t,s)),set:(e,t,s,r)=>{const n=e[t];return _t(n)&&!_t(s)?(n.value=s,!0):Reflect.set(e,t,s,r)}};function Et(e){return ht(e)?e:new Proxy(e,St)}class Ot{constructor(e,t,s){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Se(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=we-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=s}notify(){if(this.flags|=16,!(8&this.flags)&&ee!==this)return oe(this,!0),!0}get value(){const e=this.dep.track();return fe(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}const Tt={},Ct=new WeakMap;let At;function jt(e,t,r=s){const{immediate:i,deep:a,once:o,scheduler:l,augmentJob:u,call:d}=r,f=e=>a?e:pt(e)||!1===a||0===a?xt(e,1):xt(e);let p,v,y,m,_=!1,b=!1;if(_t(e)?(v=()=>e.value,_=pt(e)):ht(e)?(v=()=>f(e),_=!0):h(e)?(b=!0,_=e.some(e=>ht(e)||pt(e)),v=()=>e.map(e=>_t(e)?e.value:ht(e)?f(e):g(e)?d?d(e,2):e():void 0)):v=g(e)?t?d?()=>d(e,2):e:()=>{if(y){me();try{y()}finally{_e()}}const t=At;At=p;try{return d?d(e,3,[m]):e(m)}finally{At=t}}:n,t&&a){const e=v,t=!0===a?1/0:a;v=()=>xt(e(),t)}const w=Z,k=()=>{p.stop(),w&&w.active&&c(w.effects,p)};if(o&&t){const e=t;t=(...t)=>{e(...t),k()}}let S=b?new Array(e.length).fill(Tt):Tt;const E=e=>{if(1&p.flags&&(p.dirty||e))if(t){const e=p.run();if(a||_||(b?e.some((e,t)=>I(e,S[t])):I(e,S))){y&&y();const s=At;At=p;try{const s=[e,S===Tt?void 0:b&&S[0]===Tt?[]:S,m];S=e,d?d(t,3,s):t(...s)}finally{At=s}}}else p.run()};return u&&u(E),p=new re(v),p.scheduler=l?()=>l(E,!1):E,m=e=>function(e,t=!1,s=At){if(s){let t=Ct.get(s);t||Ct.set(s,t=[]),t.push(e)}}(e,!1,p),y=p.onStop=()=>{const e=Ct.get(p);if(e){if(d)d(e,4);else for(const t of e)t();Ct.delete(p)}},t?i?E(!0):S=p.run():l?l(E.bind(null,!0),!0):p.run(),k.pause=p.pause.bind(p),k.resume=p.resume.bind(p),k.stop=k,k}function xt(e,t=1/0,s){if(t<=0||!_(e)||e.__v_skip)return e;if(((s=s||new Map).get(e)||0)>=t)return e;if(s.set(e,t),t--,_t(e))xt(e.value,t,s);else if(h(e))for(let r=0;r<e.length;r++)xt(e[r],t,s);else if(p(e)||f(e))e.forEach(e=>{xt(e,t,s)});else if(S(e)){for(const r in e)xt(e[r],t,s);for(const r of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,r)&&xt(e[r],t,s)}return e}
/**
  * @vue/runtime-core v3.5.25
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **/function Rt(e,t,s,r){try{return r?e(...r):e()}catch(n){It(n,t,s)}}function Pt(e,t,s,r){if(g(e)){const n=Rt(e,t,s,r);return n&&b(n)&&n.catch(e=>{It(e,t,s)}),n}if(h(e)){const n=[];for(let i=0;i<e.length;i++)n.push(Pt(e[i],t,s,r));return n}}function It(e,t,r,n=!0){t&&t.vnode;const{errorHandler:i,throwUnhandledErrorInProduction:a}=t&&t.appContext.config||s;if(t){let s=t.parent;const n=t.proxy,a=`https://vuejs.org/error-reference/#runtime-${r}`;for(;s;){const t=s.ec;if(t)for(let s=0;s<t.length;s++)if(!1===t[s](e,n,a))return;s=s.parent}if(i)return me(),Rt(i,null,10,[e,n,a]),void _e()}!function(e,t,s,r=!0,n=!1){if(n)throw e;console.error(e)}(e,0,0,n,a)}const $t=[];let Nt=-1;const Ut=[];let Lt=null,Dt=0;const Bt=Promise.resolve();let Ft=null;function Mt(e){const t=Ft||Bt;return e?t.then(this?e.bind(this):e):t}function qt(e){if(!(1&e.flags)){const t=zt(e),s=$t[$t.length-1];!s||!(2&e.flags)&&t>=zt(s)?$t.push(e):$t.splice(function(e){let t=Nt+1,s=$t.length;for(;t<s;){const r=t+s>>>1,n=$t[r],i=zt(n);i<e||i===e&&2&n.flags?t=r+1:s=r}return t}(t),0,e),e.flags|=1,Vt()}}function Vt(){Ft||(Ft=Bt.then(Ht))}function Wt(e,t,s=Nt+1){for(;s<$t.length;s++){const t=$t[s];if(t&&2&t.flags){if(e&&t.id!==e.uid)continue;$t.splice(s,1),s--,4&t.flags&&(t.flags&=-2),t(),4&t.flags||(t.flags&=-2)}}}function Kt(e){if(Ut.length){const e=[...new Set(Ut)].sort((e,t)=>zt(e)-zt(t));if(Ut.length=0,Lt)return void Lt.push(...e);for(Lt=e,Dt=0;Dt<Lt.length;Dt++){const e=Lt[Dt];4&e.flags&&(e.flags&=-2),8&e.flags||e(),e.flags&=-2}Lt=null,Dt=0}}const zt=e=>null==e.id?2&e.flags?-1:1/0:e.id;function Ht(e){try{for(Nt=0;Nt<$t.length;Nt++){const e=$t[Nt];!e||8&e.flags||(4&e.flags&&(e.flags&=-2),Rt(e,e.i,e.i?15:14),4&e.flags||(e.flags&=-2))}}finally{for(;Nt<$t.length;Nt++){const e=$t[Nt];e&&(e.flags&=-2)}Nt=-1,$t.length=0,Kt(),Ft=null,($t.length||Ut.length)&&Ht()}}let Jt=null,Gt=null;function Yt(e){const t=Jt;return Jt=e,Gt=e&&e.type.__scopeId||null,t}function Qt(e,t){if(null===Jt)return e;const r=yn(Jt),n=e.dirs||(e.dirs=[]);for(let i=0;i<t.length;i++){let[e,a,o,l=s]=t[i];e&&(g(e)&&(e={mounted:e,updated:e}),e.deep&&xt(a),n.push({dir:e,instance:r,value:a,oldValue:void 0,arg:o,modifiers:l}))}return e}function Xt(e,t,s,r){const n=e.dirs,i=t&&t.dirs;for(let a=0;a<n.length;a++){const o=n[a];i&&(o.oldValue=i[a].value);let l=o.dir[r];l&&(me(),Pt(l,s,8,[e.el,o,e,t]),_e())}}const Zt=Symbol("_vte"),es=Symbol("_leaveCb");function ts(e,t){6&e.shapeFlag&&e.component?(e.transition=t,ts(e.component.subTree,t)):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function ss(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const rs=new WeakMap;function ns(e,t,r,n,a=!1){if(h(e))return void e.forEach((e,s)=>ns(e,t&&(h(t)?t[s]:t),r,n,a));if(as(n)&&!a)return void(512&n.shapeFlag&&n.type.__asyncResolved&&n.component.subTree.component&&ns(e,t,r,n.component.subTree));const o=4&n.shapeFlag?yn(n.component):n.el,l=a?null:o,{i:u,r:f}=e,p=t&&t.r,v=u.refs===s?u.refs={}:u.refs,m=u.setupState,_=gt(m),b=m===s?i:e=>d(_,e);if(null!=p&&p!==f)if(is(t),y(p))v[p]=null,b(p)&&(m[p]=null);else if(_t(p)){p.value=null;const e=t;e.k&&(v[e.k]=null)}if(g(f))Rt(f,u,12,[l,v]);else{const t=y(f),s=_t(f);if(t||s){const n=()=>{if(e.f){const s=t?b(f)?m[f]:v[f]:f.value;if(a)h(s)&&c(s,o);else if(h(s))s.includes(o)||s.push(o);else if(t)v[f]=[o],b(f)&&(m[f]=v[f]);else{const t=[o];f.value=t,e.k&&(v[e.k]=t)}}else t?(v[f]=l,b(f)&&(m[f]=l)):s&&(f.value=l,e.k&&(v[e.k]=l))};if(l){const t=()=>{n(),rs.delete(e)};t.id=-1,rs.set(e,t),Sr(t,r)}else is(e),n()}}}function is(e){const t=rs.get(e);t&&(t.flags|=8,rs.delete(e))}D().requestIdleCallback,D().cancelIdleCallback;const as=e=>!!e.type.__asyncLoader,os=e=>e.type.__isKeepAlive;function ls(e,t){us(e,"a",t)}function cs(e,t){us(e,"da",t)}function us(e,t,s=an){const r=e.__wdc||(e.__wdc=()=>{let t=s;for(;t;){if(t.isDeactivated)return;t=t.parent}return e()});if(hs(t,r,s),s){let e=s.parent;for(;e&&e.parent;)os(e.parent.vnode)&&ds(r,t,s,e),e=e.parent}}function ds(e,t,s,r){const n=hs(t,e,r,!0);_s(()=>{c(r[t],n)},s)}function hs(e,t,s=an,r=!1){if(s){const n=s[e]||(s[e]=[]),i=t.__weh||(t.__weh=(...r)=>{me();const n=un(s),i=Pt(t,s,e,r);return n(),_e(),i});return r?n.unshift(i):n.push(i),i}}const fs=e=>(t,s=an)=>{fn&&"sp"!==e||hs(e,(...e)=>t(...e),s)},ps=fs("bm"),vs=fs("m"),gs=fs("bu"),ys=fs("u"),ms=fs("bum"),_s=fs("um"),bs=fs("sp"),ws=fs("rtg"),ks=fs("rtc");function Ss(e,t=an){hs("ec",e,t)}const Es=Symbol.for("v-ndc");function Os(e,t,s,r){let n;const i=s,a=h(e);if(a||y(e)){let s=!1,r=!1;a&&ht(e)&&(s=!pt(e),r=ft(e),e=Pe(e)),n=new Array(e.length);for(let a=0,o=e.length;a<o;a++)n[a]=t(s?r?mt(yt(e[a])):yt(e[a]):e[a],a,void 0,i)}else if("number"==typeof e){n=new Array(e);for(let s=0;s<e;s++)n[s]=t(s+1,s,void 0,i)}else if(_(e))if(e[Symbol.iterator])n=Array.from(e,(e,s)=>t(e,s,void 0,i));else{const s=Object.keys(e);n=new Array(s.length);for(let r=0,a=s.length;r<a;r++){const a=s[r];n[r]=t(e[a],a,r,i)}}else n=[];return n}const Ts=e=>e?hn(e)?yn(e):Ts(e.parent):null,Cs=l(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Ts(e.parent),$root:e=>Ts(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>Ns(e),$forceUpdate:e=>e.f||(e.f=()=>{qt(e.update)}),$nextTick:e=>e.n||(e.n=Mt.bind(e.proxy)),$watch:e=>Xs.bind(e)}),As=(e,t)=>e!==s&&!e.__isScriptSetup&&d(e,t),js={get({_:e},t){if("__v_skip"===t)return!0;const{ctx:r,setupState:n,data:i,props:a,accessCache:o,type:l,appContext:c}=e;if("$"!==t[0]){const e=o[t];if(void 0!==e)switch(e){case 1:return n[t];case 2:return i[t];case 4:return r[t];case 3:return a[t]}else{if(As(n,t))return o[t]=1,n[t];if(i!==s&&d(i,t))return o[t]=2,i[t];if(d(a,t))return o[t]=3,a[t];if(r!==s&&d(r,t))return o[t]=4,r[t];Rs&&(o[t]=0)}}const u=Cs[t];let h,f;return u?("$attrs"===t&&je(e.attrs,0,""),u(e)):(h=l.__cssModules)&&(h=h[t])?h:r!==s&&d(r,t)?(o[t]=4,r[t]):(f=c.config.globalProperties,d(f,t)?f[t]:void 0)},set({_:e},t,r){const{data:n,setupState:i,ctx:a}=e;return As(i,t)?(i[t]=r,!0):n!==s&&d(n,t)?(n[t]=r,!0):!d(e.props,t)&&(("$"!==t[0]||!(t.slice(1)in e))&&(a[t]=r,!0))},has({_:{data:e,setupState:t,accessCache:r,ctx:n,appContext:i,props:a,type:o}},l){let c;return!!(r[l]||e!==s&&"$"!==l[0]&&d(e,l)||As(t,l)||d(a,l)||d(n,l)||d(Cs,l)||d(i.config.globalProperties,l)||(c=o.__cssModules)&&c[l])},defineProperty(e,t,s){return null!=s.get?e._.accessCache[t]=0:d(s,"value")&&this.set(e,t,s.value,null),Reflect.defineProperty(e,t,s)}};function xs(e){return h(e)?e.reduce((e,t)=>(e[t]=null,e),{}):e}let Rs=!0;function Ps(e){const t=Ns(e),s=e.proxy,r=e.ctx;Rs=!1,t.beforeCreate&&Is(t.beforeCreate,e,"bc");const{data:i,computed:a,methods:o,watch:l,provide:c,inject:u,created:d,beforeMount:f,mounted:p,beforeUpdate:v,updated:y,activated:m,deactivated:b,beforeDestroy:w,beforeUnmount:k,destroyed:S,unmounted:E,render:O,renderTracked:T,renderTriggered:C,errorCaptured:A,serverPrefetch:j,expose:x,inheritAttrs:R,components:P,directives:I,filters:$}=t;if(u&&function(e,t){h(e)&&(e=Bs(e));for(const s in e){const r=e[s];let n;n=_(r)?"default"in r?Hs(r.from||s,r.default,!0):Hs(r.from||s):Hs(r),_t(n)?Object.defineProperty(t,s,{enumerable:!0,configurable:!0,get:()=>n.value,set:e=>n.value=e}):t[s]=n}}(u,r,null),o)for(const n in o){const e=o[n];g(e)&&(r[n]=e.bind(s))}if(i){const t=i.call(s,s);_(t)&&(e.data=ct(t))}if(Rs=!0,a)for(const h in a){const e=a[h],t=g(e)?e.bind(s,s):g(e.get)?e.get.bind(s,s):n,i=!g(e)&&g(e.set)?e.set.bind(s):n,o=mn({get:t,set:i});Object.defineProperty(r,h,{enumerable:!0,configurable:!0,get:()=>o.value,set:e=>o.value=e})}if(l)for(const n in l)$s(l[n],r,s,n);if(c){const e=g(c)?c.call(s):c;Reflect.ownKeys(e).forEach(t=>{!function(e,t){if(an){let s=an.provides;const r=an.parent&&an.parent.provides;r===s&&(s=an.provides=Object.create(r)),s[e]=t}}(t,e[t])})}function N(e,t){h(t)?t.forEach(t=>e(t.bind(s))):t&&e(t.bind(s))}if(d&&Is(d,e,"c"),N(ps,f),N(vs,p),N(gs,v),N(ys,y),N(ls,m),N(cs,b),N(Ss,A),N(ks,T),N(ws,C),N(ms,k),N(_s,E),N(bs,j),h(x))if(x.length){const t=e.exposed||(e.exposed={});x.forEach(e=>{Object.defineProperty(t,e,{get:()=>s[e],set:t=>s[e]=t,enumerable:!0})})}else e.exposed||(e.exposed={});O&&e.render===n&&(e.render=O),null!=R&&(e.inheritAttrs=R),P&&(e.components=P),I&&(e.directives=I),j&&ss(e)}function Is(e,t,s){Pt(h(e)?e.map(e=>e.bind(t.proxy)):e.bind(t.proxy),t,s)}function $s(e,t,s,r){let n=r.includes(".")?Zs(s,r):()=>s[r];if(y(e)){const s=t[e];g(s)&&Ys(n,s)}else if(g(e))Ys(n,e.bind(s));else if(_(e))if(h(e))e.forEach(e=>$s(e,t,s,r));else{const r=g(e.handler)?e.handler.bind(s):t[e.handler];g(r)&&Ys(n,r,e)}}function Ns(e){const t=e.type,{mixins:s,extends:r}=t,{mixins:n,optionsCache:i,config:{optionMergeStrategies:a}}=e.appContext,o=i.get(t);let l;return o?l=o:n.length||s||r?(l={},n.length&&n.forEach(e=>Us(l,e,a,!0)),Us(l,t,a)):l=t,_(t)&&i.set(t,l),l}function Us(e,t,s,r=!1){const{mixins:n,extends:i}=t;i&&Us(e,i,s,!0),n&&n.forEach(t=>Us(e,t,s,!0));for(const a in t)if(r&&"expose"===a);else{const r=Ls[a]||s&&s[a];e[a]=r?r(e[a],t[a]):t[a]}return e}const Ls={data:Ds,props:qs,emits:qs,methods:Ms,computed:Ms,beforeCreate:Fs,created:Fs,beforeMount:Fs,mounted:Fs,beforeUpdate:Fs,updated:Fs,beforeDestroy:Fs,beforeUnmount:Fs,destroyed:Fs,unmounted:Fs,activated:Fs,deactivated:Fs,errorCaptured:Fs,serverPrefetch:Fs,components:Ms,directives:Ms,watch:function(e,t){if(!e)return t;if(!t)return e;const s=l(Object.create(null),e);for(const r in t)s[r]=Fs(e[r],t[r]);return s},provide:Ds,inject:function(e,t){return Ms(Bs(e),Bs(t))}};function Ds(e,t){return t?e?function(){return l(g(e)?e.call(this,this):e,g(t)?t.call(this,this):t)}:t:e}function Bs(e){if(h(e)){const t={};for(let s=0;s<e.length;s++)t[e[s]]=e[s];return t}return e}function Fs(e,t){return e?[...new Set([].concat(e,t))]:t}function Ms(e,t){return e?l(Object.create(null),e,t):t}function qs(e,t){return e?h(e)&&h(t)?[...new Set([...e,...t])]:l(Object.create(null),xs(e),xs(null!=t?t:{})):t}function Vs(){return{app:null,config:{isNativeTag:i,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Ws=0;function Ks(e,t){return function(t,s=null){g(t)||(t=l({},t)),null==s||_(s)||(s=null);const r=Vs(),n=new WeakSet,i=[];let a=!1;const o=r.app={_uid:Ws++,_component:t,_props:s,_container:null,_context:r,_instance:null,version:_n,get config(){return r.config},set config(e){},use:(e,...t)=>(n.has(e)||(e&&g(e.install)?(n.add(e),e.install(o,...t)):g(e)&&(n.add(e),e(o,...t))),o),mixin:e=>(r.mixins.includes(e)||r.mixins.push(e),o),component:(e,t)=>t?(r.components[e]=t,o):r.components[e],directive:(e,t)=>t?(r.directives[e]=t,o):r.directives[e],mount(n,i,l){if(!a){const i=o._ceVNode||Jr(t,s);return i.appContext=r,!0===l?l="svg":!1===l&&(l=void 0),e(i,n,l),a=!0,o._container=n,n.__vue_app__=o,yn(i.component)}},onUnmount(e){i.push(e)},unmount(){a&&(Pt(i,o._instance,16),e(null,o._container),delete o._container.__vue_app__)},provide:(e,t)=>(r.provides[e]=t,o),runWithContext(e){const t=zs;zs=o;try{return e()}finally{zs=t}}};return o}}let zs=null;function Hs(e,t,s=!1){const r=on();if(r||zs){let n=zs?zs._context.provides:r?null==r.parent||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(n&&e in n)return n[e];if(arguments.length>1)return s&&g(t)?t.call(r&&r.proxy):t}}const Js=Symbol.for("v-scx"),Gs=()=>Hs(Js);function Ys(e,t,s){return Qs(e,t,s)}function Qs(e,t,r=s){const{immediate:i,deep:a,flush:o,once:c}=r,u=l({},r),d=t&&i||!t&&"post"!==o;let h;if(fn)if("sync"===o){const e=Gs();h=e.__watcherHandles||(e.__watcherHandles=[])}else if(!d){const e=()=>{};return e.stop=n,e.resume=n,e.pause=n,e}const f=an;u.call=(e,t,s)=>Pt(e,f,t,s);let p=!1;"post"===o?u.scheduler=e=>{Sr(e,f&&f.suspense)}:"sync"!==o&&(p=!0,u.scheduler=(e,t)=>{t?e():qt(e)}),u.augmentJob=e=>{t&&(e.flags|=4),p&&(e.flags|=2,f&&(e.id=f.uid,e.i=f))};const v=jt(e,t,u);return fn&&(h?h.push(v):d&&v()),v}function Xs(e,t,s){const r=this.proxy,n=y(e)?e.includes(".")?Zs(r,e):()=>r[e]:e.bind(r,r);let i;g(t)?i=t:(i=t.handler,s=t);const a=un(this),o=Qs(n,i.bind(r),s);return a(),o}function Zs(e,t){const s=t.split(".");return()=>{let t=e;for(let e=0;e<s.length&&t;e++)t=t[s[e]];return t}}function er(e,t,...r){if(e.isUnmounted)return;const n=e.vnode.props||s;let i=r;const a=t.startsWith("update:"),o=a&&((e,t)=>"modelValue"===t||"model-value"===t?e.modelModifiers:e[`${t}Modifiers`]||e[`${A(t)}Modifiers`]||e[`${x(t)}Modifiers`])(n,t.slice(7));let l;o&&(o.trim&&(i=r.map(e=>y(e)?e.trim():e)),o.number&&(i=r.map(U)));let c=n[l=P(t)]||n[l=P(A(t))];!c&&a&&(c=n[l=P(x(t))]),c&&Pt(c,e,6,i);const u=n[l+"Once"];if(u){if(e.emitted){if(e.emitted[l])return}else e.emitted={};e.emitted[l]=!0,Pt(u,e,6,i)}}const tr=new WeakMap;function sr(e,t,s=!1){const r=s?tr:t.emitsCache,n=r.get(e);if(void 0!==n)return n;const i=e.emits;let a={},o=!1;if(!g(e)){const r=e=>{const s=sr(e,t,!0);s&&(o=!0,l(a,s))};!s&&t.mixins.length&&t.mixins.forEach(r),e.extends&&r(e.extends),e.mixins&&e.mixins.forEach(r)}return i||o?(h(i)?i.forEach(e=>a[e]=null):l(a,i),_(e)&&r.set(e,a),a):(_(e)&&r.set(e,null),null)}function rr(e,t){return!(!e||!a(t))&&(t=t.slice(2).replace(/Once$/,""),d(e,t[0].toLowerCase()+t.slice(1))||d(e,x(t))||d(e,t))}function nr(e){const{type:t,vnode:s,proxy:r,withProxy:n,propsOptions:[i],slots:a,attrs:l,emit:c,render:u,renderCache:d,props:h,data:f,setupState:p,ctx:v,inheritAttrs:g}=e,y=Yt(e);let m,_;try{if(4&s.shapeFlag){const e=n||r,t=e;m=Zr(u.call(t,e,d,h,p,f,v)),_=l}else{const e=t;0,m=Zr(e.length>1?e(h,{attrs:l,slots:a,emit:c}):e(h,null)),_=t.props?l:ir(l)}}catch(w){Nr.length=0,It(w,e,1),m=Jr(Ir)}let b=m;if(_&&!1!==g){const e=Object.keys(_),{shapeFlag:t}=b;e.length&&7&t&&(i&&e.some(o)&&(_=ar(_,i)),b=Gr(b,_,!1,!0))}return s.dirs&&(b=Gr(b,null,!1,!0),b.dirs=b.dirs?b.dirs.concat(s.dirs):s.dirs),s.transition&&ts(b,s.transition),m=b,Yt(y),m}const ir=e=>{let t;for(const s in e)("class"===s||"style"===s||a(s))&&((t||(t={}))[s]=e[s]);return t},ar=(e,t)=>{const s={};for(const r in e)o(r)&&r.slice(9)in t||(s[r]=e[r]);return s};function or(e,t,s){const r=Object.keys(t);if(r.length!==Object.keys(e).length)return!0;for(let n=0;n<r.length;n++){const i=r[n];if(t[i]!==e[i]&&!rr(s,i))return!0}return!1}const lr={},cr=()=>Object.create(lr),ur=e=>Object.getPrototypeOf(e)===lr;function dr(e,t,s,r=!1){const n={},i=cr();e.propsDefaults=Object.create(null),hr(e,t,n,i);for(const a in e.propsOptions[0])a in n||(n[a]=void 0);s?e.props=r?n:dt(n,!1,Ge,st,it):e.type.props?e.props=n:e.props=i,e.attrs=i}function hr(e,t,r,n){const[i,a]=e.propsOptions;let o,l=!1;if(t)for(let s in t){if(O(s))continue;const c=t[s];let u;i&&d(i,u=A(s))?a&&a.includes(u)?(o||(o={}))[u]=c:r[u]=c:rr(e.emitsOptions,s)||s in n&&c===n[s]||(n[s]=c,l=!0)}if(a){const t=gt(r),n=o||s;for(let s=0;s<a.length;s++){const o=a[s];r[o]=fr(i,t,o,n[o],e,!d(n,o))}}return l}function fr(e,t,s,r,n,i){const a=e[s];if(null!=a){const e=d(a,"default");if(e&&void 0===r){const e=a.default;if(a.type!==Function&&!a.skipFactory&&g(e)){const{propsDefaults:i}=n;if(s in i)r=i[s];else{const a=un(n);r=i[s]=e.call(null,t),a()}}else r=e;n.ce&&n.ce._setProp(s,r)}a[0]&&(i&&!e?r=!1:!a[1]||""!==r&&r!==x(s)||(r=!0))}return r}const pr=new WeakMap;function vr(e,t,n=!1){const i=n?pr:t.propsCache,a=i.get(e);if(a)return a;const o=e.props,c={},u=[];let f=!1;if(!g(e)){const s=e=>{f=!0;const[s,r]=vr(e,t,!0);l(c,s),r&&u.push(...r)};!n&&t.mixins.length&&t.mixins.forEach(s),e.extends&&s(e.extends),e.mixins&&e.mixins.forEach(s)}if(!o&&!f)return _(e)&&i.set(e,r),r;if(h(o))for(let r=0;r<o.length;r++){const e=A(o[r]);gr(e)&&(c[e]=s)}else if(o)for(const s in o){const e=A(s);if(gr(e)){const t=o[s],r=c[e]=h(t)||g(t)?{type:t}:l({},t),n=r.type;let i=!1,a=!0;if(h(n))for(let e=0;e<n.length;++e){const t=n[e],s=g(t)&&t.name;if("Boolean"===s){i=!0;break}"String"===s&&(a=!1)}else i=g(n)&&"Boolean"===n.name;r[0]=i,r[1]=a,(i||d(r,"default"))&&u.push(e)}}const p=[c,u];return _(e)&&i.set(e,p),p}function gr(e){return"$"!==e[0]&&!O(e)}const yr=e=>"_"===e||"_ctx"===e||"$stable"===e,mr=e=>h(e)?e.map(Zr):[Zr(e)],_r=(e,t,s)=>{if(t._n)return t;const r=function(e,t=Jt){if(!t)return e;if(e._n)return e;const s=(...r)=>{s._d&&Br(-1);const n=Yt(t);let i;try{i=e(...r)}finally{Yt(n),s._d&&Br(1)}return i};return s._n=!0,s._c=!0,s._d=!0,s}((...e)=>mr(t(...e)),s);return r._c=!1,r},br=(e,t,s)=>{const r=e._ctx;for(const n in e){if(yr(n))continue;const s=e[n];if(g(s))t[n]=_r(0,s,r);else if(null!=s){const e=mr(s);t[n]=()=>e}}},wr=(e,t)=>{const s=mr(t);e.slots.default=()=>s},kr=(e,t,s)=>{for(const r in t)!s&&yr(r)||(e[r]=t[r])},Sr=function(e,t){t&&t.pendingBranch?h(e)?t.effects.push(...e):t.effects.push(e):(h(s=e)?Ut.push(...s):Lt&&-1===s.id?Lt.splice(Dt+1,0,s):1&s.flags||(Ut.push(s),s.flags|=1),Vt());var s};function Er(e){return function(e){D().__VUE__=!0;const{insert:t,remove:i,patchProp:a,createElement:o,createText:l,createComment:c,setText:u,setElementText:h,parentNode:f,nextSibling:p,setScopeId:v=n,insertStaticContent:g}=e,y=(e,t,s,r=null,n=null,i=null,a=void 0,o=null,l=!!t.dynamicChildren)=>{if(e===t)return;e&&!Wr(e,t)&&(r=X(e),H(e,n,i,!0),e=null),-2===t.patchFlag&&(l=!1,t.dynamicChildren=null);const{type:c,ref:u,shapeFlag:d}=t;switch(c){case Pr:m(e,t,s,r);break;case Ir:_(e,t,s,r);break;case $r:null==e&&w(t,s,r,a);break;case Rr:U(e,t,s,r,n,i,a,o,l);break;default:1&d?E(e,t,s,r,n,i,a,o,l):6&d?L(e,t,s,r,n,i,a,o,l):(64&d||128&d)&&c.process(e,t,s,r,n,i,a,o,l,se)}null!=u&&n?ns(u,e&&e.ref,i,t||e,!t):null==u&&e&&null!=e.ref&&ns(e.ref,null,i,e,!0)},m=(e,s,r,n)=>{if(null==e)t(s.el=l(s.children),r,n);else{const t=s.el=e.el;s.children!==e.children&&u(t,s.children)}},_=(e,s,r,n)=>{null==e?t(s.el=c(s.children||""),r,n):s.el=e.el},w=(e,t,s,r)=>{[e.el,e.anchor]=g(e.children,t,s,r,e.el,e.anchor)},k=({el:e,anchor:s},r,n)=>{let i;for(;e&&e!==s;)i=p(e),t(e,r,n),e=i;t(s,r,n)},S=({el:e,anchor:t})=>{let s;for(;e&&e!==t;)s=p(e),i(e),e=s;i(t)},E=(e,t,s,r,n,i,a,o,l)=>{if("svg"===t.type?a="svg":"math"===t.type&&(a="mathml"),null==e)T(t,s,r,n,i,a,o,l);else{const s=e.el&&e.el._isVueCE?e.el:null;try{s&&s._beginPatch(),R(e,t,n,i,a,o,l)}finally{s&&s._endPatch()}}},T=(e,s,r,n,i,l,c,u)=>{let d,f;const{props:p,shapeFlag:v,transition:g,dirs:y}=e;if(d=e.el=o(e.type,l,p&&p.is,p),8&v?h(d,e.children):16&v&&j(e.children,d,null,n,i,Or(e,l),c,u),y&&Xt(e,null,n,"created"),C(d,e,e.scopeId,c,n),p){for(const e in p)"value"===e||O(e)||a(d,e,null,p[e],l,n);"value"in p&&a(d,"value",null,p.value,l),(f=p.onVnodeBeforeMount)&&sn(f,n,e)}y&&Xt(e,null,n,"beforeMount");const m=function(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}(i,g);m&&g.beforeEnter(d),t(d,s,r),((f=p&&p.onVnodeMounted)||m||y)&&Sr(()=>{f&&sn(f,n,e),m&&g.enter(d),y&&Xt(e,null,n,"mounted")},i)},C=(e,t,s,r,n)=>{if(s&&v(e,s),r)for(let i=0;i<r.length;i++)v(e,r[i]);if(n){let s=n.subTree;if(t===s||xr(s.type)&&(s.ssContent===t||s.ssFallback===t)){const t=n.vnode;C(e,t,t.scopeId,t.slotScopeIds,n.parent)}}},j=(e,t,s,r,n,i,a,o,l=0)=>{for(let c=l;c<e.length;c++){const l=e[c]=o?en(e[c]):Zr(e[c]);y(null,l,t,s,r,n,i,a,o)}},R=(e,t,r,n,i,o,l)=>{const c=t.el=e.el;let{patchFlag:u,dynamicChildren:d,dirs:f}=t;u|=16&e.patchFlag;const p=e.props||s,v=t.props||s;let g;if(r&&Tr(r,!1),(g=v.onVnodeBeforeUpdate)&&sn(g,r,t,e),f&&Xt(t,e,r,"beforeUpdate"),r&&Tr(r,!0),(p.innerHTML&&null==v.innerHTML||p.textContent&&null==v.textContent)&&h(c,""),d?P(e.dynamicChildren,d,c,r,n,Or(t,i),o):l||V(e,t,c,null,r,n,Or(t,i),o,!1),u>0){if(16&u)I(c,p,v,r,i);else if(2&u&&p.class!==v.class&&a(c,"class",null,v.class,i),4&u&&a(c,"style",p.style,v.style,i),8&u){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const s=e[t],n=p[s],o=v[s];o===n&&"value"!==s||a(c,s,n,o,i,r)}}1&u&&e.children!==t.children&&h(c,t.children)}else l||null!=d||I(c,p,v,r,i);((g=v.onVnodeUpdated)||f)&&Sr(()=>{g&&sn(g,r,t,e),f&&Xt(t,e,r,"updated")},n)},P=(e,t,s,r,n,i,a)=>{for(let o=0;o<t.length;o++){const l=e[o],c=t[o],u=l.el&&(l.type===Rr||!Wr(l,c)||198&l.shapeFlag)?f(l.el):s;y(l,c,u,null,r,n,i,a,!0)}},I=(e,t,r,n,i)=>{if(t!==r){if(t!==s)for(const s in t)O(s)||s in r||a(e,s,t[s],null,i,n);for(const s in r){if(O(s))continue;const o=r[s],l=t[s];o!==l&&"value"!==s&&a(e,s,l,o,i,n)}"value"in r&&a(e,"value",t.value,r.value,i)}},U=(e,s,r,n,i,a,o,c,u)=>{const d=s.el=e?e.el:l(""),h=s.anchor=e?e.anchor:l("");let{patchFlag:f,dynamicChildren:p,slotScopeIds:v}=s;v&&(c=c?c.concat(v):v),null==e?(t(d,r,n),t(h,r,n),j(s.children||[],r,h,i,a,o,c,u)):f>0&&64&f&&p&&e.dynamicChildren?(P(e.dynamicChildren,p,r,i,a,o,c),(null!=s.key||i&&s===i.subTree)&&Cr(e,s,!0)):V(e,s,r,h,i,a,o,c,u)},L=(e,t,s,r,n,i,a,o,l)=>{t.slotScopeIds=o,null==e?512&t.shapeFlag?n.ctx.activate(t,s,r,a,l):B(t,s,r,n,i,a,l):F(e,t,l)},B=(e,t,r,n,i,a,o)=>{const l=e.component=function(e,t,r){const n=e.type,i=(t?t.appContext:e.appContext)||rn,a={uid:nn++,vnode:e,type:n,parent:t,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new te(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:vr(n,i),emitsOptions:sr(n,i),emit:null,emitted:null,propsDefaults:s,inheritAttrs:n.inheritAttrs,ctx:s,data:s,props:s,attrs:s,slots:s,refs:s,setupState:s,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};a.ctx={_:a},a.root=t?t.root:a,a.emit=er.bind(null,a),e.ce&&e.ce(a);return a}(e,n,i);if(os(e)&&(l.ctx.renderer=se),function(e,t=!1,s=!1){t&&cn(t);const{props:r,children:n}=e.vnode,i=hn(e);dr(e,r,i,t),((e,t,s)=>{const r=e.slots=cr();if(32&e.vnode.shapeFlag){const e=t._;e?(kr(r,t,s),s&&N(r,"_",e,!0)):br(t,r)}else t&&wr(e,t)})(e,n,s||t);const a=i?function(e,t){const s=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,js);const{setup:r}=s;if(r){me();const s=e.setupContext=r.length>1?function(e){const t=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,gn),slots:e.slots,emit:e.emit,expose:t}}(e):null,n=un(e),i=Rt(r,e,0,[e.props,s]),a=b(i);if(_e(),n(),!a&&!e.sp||as(e)||ss(e),a){if(i.then(dn,dn),t)return i.then(t=>{pn(e,t)}).catch(t=>{It(t,e,0)});e.asyncDep=i}else pn(e,i)}else vn(e)}(e,t):void 0;t&&cn(!1)}(l,!1,o),l.asyncDep){if(i&&i.registerDep(l,M,o),!e.el){const s=l.subTree=Jr(Ir);_(null,s,t,r),e.placeholder=s.el}}else M(l,e,t,r,i,a,o)},F=(e,t,s)=>{const r=t.component=e.component;if(function(e,t,s){const{props:r,children:n,component:i}=e,{props:a,children:o,patchFlag:l}=t,c=i.emitsOptions;if(t.dirs||t.transition)return!0;if(!(s&&l>=0))return!(!n&&!o||o&&o.$stable)||r!==a&&(r?!a||or(r,a,c):!!a);if(1024&l)return!0;if(16&l)return r?or(r,a,c):!!a;if(8&l){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const s=e[t];if(a[s]!==r[s]&&!rr(c,s))return!0}}return!1}(e,t,s)){if(r.asyncDep&&!r.asyncResolved)return void q(r,t,s);r.next=t,r.update()}else t.el=e.el,r.vnode=t},M=(e,t,s,r,n,i,a)=>{const o=()=>{if(e.isMounted){let{next:t,bu:s,u:r,parent:l,vnode:c}=e;{const s=Ar(e);if(s)return t&&(t.el=c.el,q(e,t,a)),void s.asyncDep.then(()=>{e.isUnmounted||o()})}let u,d=t;Tr(e,!1),t?(t.el=c.el,q(e,t,a)):t=c,s&&$(s),(u=t.props&&t.props.onVnodeBeforeUpdate)&&sn(u,l,t,c),Tr(e,!0);const h=nr(e),p=e.subTree;e.subTree=h,y(p,h,f(p.el),X(p),e,n,i),t.el=h.el,null===d&&function({vnode:e,parent:t},s){for(;t;){const r=t.subTree;if(r.suspense&&r.suspense.activeBranch===e&&(r.el=e.el),r!==e)break;(e=t.vnode).el=s,t=t.parent}}(e,h.el),r&&Sr(r,n),(u=t.props&&t.props.onVnodeUpdated)&&Sr(()=>sn(u,l,t,c),n)}else{let a;const{el:o,props:l}=t,{bm:c,m:u,parent:d,root:h,type:f}=e,p=as(t);Tr(e,!1),c&&$(c),!p&&(a=l&&l.onVnodeBeforeMount)&&sn(a,d,t),Tr(e,!0);{h.ce&&!1!==h.ce._def.shadowRoot&&h.ce._injectChildStyle(f);const a=e.subTree=nr(e);y(null,a,s,r,e,n,i),t.el=a.el}if(u&&Sr(u,n),!p&&(a=l&&l.onVnodeMounted)){const e=t;Sr(()=>sn(a,d,e),n)}(256&t.shapeFlag||d&&as(d.vnode)&&256&d.vnode.shapeFlag)&&e.a&&Sr(e.a,n),e.isMounted=!0,t=s=r=null}};e.scope.on();const l=e.effect=new re(o);e.scope.off();const c=e.update=l.run.bind(l),u=e.job=l.runIfDirty.bind(l);u.i=e,u.id=e.uid,l.scheduler=()=>qt(u),Tr(e,!0),c()},q=(e,t,r)=>{t.component=e;const n=e.vnode.props;e.vnode=t,e.next=null,function(e,t,s,r){const{props:n,attrs:i,vnode:{patchFlag:a}}=e,o=gt(n),[l]=e.propsOptions;let c=!1;if(!(r||a>0)||16&a){let r;hr(e,t,n,i)&&(c=!0);for(const i in o)t&&(d(t,i)||(r=x(i))!==i&&d(t,r))||(l?!s||void 0===s[i]&&void 0===s[r]||(n[i]=fr(l,o,i,void 0,e,!0)):delete n[i]);if(i!==o)for(const e in i)t&&d(t,e)||(delete i[e],c=!0)}else if(8&a){const s=e.vnode.dynamicProps;for(let r=0;r<s.length;r++){let a=s[r];if(rr(e.emitsOptions,a))continue;const u=t[a];if(l)if(d(i,a))u!==i[a]&&(i[a]=u,c=!0);else{const t=A(a);n[t]=fr(l,o,t,u,e,!1)}else u!==i[a]&&(i[a]=u,c=!0)}}c&&xe(e.attrs,"set","")}(e,t.props,n,r),((e,t,r)=>{const{vnode:n,slots:i}=e;let a=!0,o=s;if(32&n.shapeFlag){const e=t._;e?r&&1===e?a=!1:kr(i,t,r):(a=!t.$stable,br(t,i)),o=t}else t&&(wr(e,t),o={default:1});if(a)for(const s in i)yr(s)||null!=o[s]||delete i[s]})(e,t.children,r),me(),Wt(e),_e()},V=(e,t,s,r,n,i,a,o,l=!1)=>{const c=e&&e.children,u=e?e.shapeFlag:0,d=t.children,{patchFlag:f,shapeFlag:p}=t;if(f>0){if(128&f)return void K(c,d,s,r,n,i,a,o,l);if(256&f)return void W(c,d,s,r,n,i,a,o,l)}8&p?(16&u&&Q(c,n,i),d!==c&&h(s,d)):16&u?16&p?K(c,d,s,r,n,i,a,o,l):Q(c,n,i,!0):(8&u&&h(s,""),16&p&&j(d,s,r,n,i,a,o,l))},W=(e,t,s,n,i,a,o,l,c)=>{t=t||r;const u=(e=e||r).length,d=t.length,h=Math.min(u,d);let f;for(f=0;f<h;f++){const r=t[f]=c?en(t[f]):Zr(t[f]);y(e[f],r,s,null,i,a,o,l,c)}u>d?Q(e,i,a,!0,!1,h):j(t,s,n,i,a,o,l,c,h)},K=(e,t,s,n,i,a,o,l,c)=>{let u=0;const d=t.length;let h=e.length-1,f=d-1;for(;u<=h&&u<=f;){const r=e[u],n=t[u]=c?en(t[u]):Zr(t[u]);if(!Wr(r,n))break;y(r,n,s,null,i,a,o,l,c),u++}for(;u<=h&&u<=f;){const r=e[h],n=t[f]=c?en(t[f]):Zr(t[f]);if(!Wr(r,n))break;y(r,n,s,null,i,a,o,l,c),h--,f--}if(u>h){if(u<=f){const e=f+1,r=e<d?t[e].el:n;for(;u<=f;)y(null,t[u]=c?en(t[u]):Zr(t[u]),s,r,i,a,o,l,c),u++}}else if(u>f)for(;u<=h;)H(e[u],i,a,!0),u++;else{const p=u,v=u,g=new Map;for(u=v;u<=f;u++){const e=t[u]=c?en(t[u]):Zr(t[u]);null!=e.key&&g.set(e.key,u)}let m,_=0;const b=f-v+1;let w=!1,k=0;const S=new Array(b);for(u=0;u<b;u++)S[u]=0;for(u=p;u<=h;u++){const r=e[u];if(_>=b){H(r,i,a,!0);continue}let n;if(null!=r.key)n=g.get(r.key);else for(m=v;m<=f;m++)if(0===S[m-v]&&Wr(r,t[m])){n=m;break}void 0===n?H(r,i,a,!0):(S[n-v]=u+1,n>=k?k=n:w=!0,y(r,t[n],s,null,i,a,o,l,c),_++)}const E=w?function(e){const t=e.slice(),s=[0];let r,n,i,a,o;const l=e.length;for(r=0;r<l;r++){const l=e[r];if(0!==l){if(n=s[s.length-1],e[n]<l){t[r]=n,s.push(r);continue}for(i=0,a=s.length-1;i<a;)o=i+a>>1,e[s[o]]<l?i=o+1:a=o;l<e[s[i]]&&(i>0&&(t[r]=s[i-1]),s[i]=r)}}i=s.length,a=s[i-1];for(;i-- >0;)s[i]=a,a=t[a];return s}(S):r;for(m=E.length-1,u=b-1;u>=0;u--){const e=v+u,r=t[e],h=t[e+1],f=e+1<d?h.el||h.placeholder:n;0===S[u]?y(null,r,s,f,i,a,o,l,c):w&&(m<0||u!==E[m]?z(r,s,f,2):m--)}}},z=(e,s,r,n,a=null)=>{const{el:o,type:l,transition:c,children:u,shapeFlag:d}=e;if(6&d)return void z(e.component.subTree,s,r,n);if(128&d)return void e.suspense.move(s,r,n);if(64&d)return void l.move(e,s,r,se);if(l===Rr){t(o,s,r);for(let e=0;e<u.length;e++)z(u[e],s,r,n);return void t(e.anchor,s,r)}if(l===$r)return void k(e,s,r);if(2!==n&&1&d&&c)if(0===n)c.beforeEnter(o),t(o,s,r),Sr(()=>c.enter(o),a);else{const{leave:n,delayLeave:a,afterLeave:l}=c,u=()=>{e.ctx.isUnmounted?i(o):t(o,s,r)},d=()=>{o._isLeaving&&o[es](!0),n(o,()=>{u(),l&&l()})};a?a(o,u,d):d()}else t(o,s,r)},H=(e,t,s,r=!1,n=!1)=>{const{type:i,props:a,ref:o,children:l,dynamicChildren:c,shapeFlag:u,patchFlag:d,dirs:h,cacheIndex:f}=e;if(-2===d&&(n=!1),null!=o&&(me(),ns(o,null,s,e,!0),_e()),null!=f&&(t.renderCache[f]=void 0),256&u)return void t.ctx.deactivate(e);const p=1&u&&h,v=!as(e);let g;if(v&&(g=a&&a.onVnodeBeforeUnmount)&&sn(g,t,e),6&u)Y(e.component,s,r);else{if(128&u)return void e.suspense.unmount(s,r);p&&Xt(e,null,t,"beforeUnmount"),64&u?e.type.remove(e,t,s,se,r):c&&!c.hasOnce&&(i!==Rr||d>0&&64&d)?Q(c,t,s,!1,!0):(i===Rr&&384&d||!n&&16&u)&&Q(l,t,s),r&&J(e)}(v&&(g=a&&a.onVnodeUnmounted)||p)&&Sr(()=>{g&&sn(g,t,e),p&&Xt(e,null,t,"unmounted")},s)},J=e=>{const{type:t,el:s,anchor:r,transition:n}=e;if(t===Rr)return void G(s,r);if(t===$r)return void S(e);const a=()=>{i(s),n&&!n.persisted&&n.afterLeave&&n.afterLeave()};if(1&e.shapeFlag&&n&&!n.persisted){const{leave:t,delayLeave:r}=n,i=()=>t(s,a);r?r(e.el,a,i):i()}else a()},G=(e,t)=>{let s;for(;e!==t;)s=p(e),i(e),e=s;i(t)},Y=(e,t,s)=>{const{bum:r,scope:n,job:i,subTree:a,um:o,m:l,a:c}=e;jr(l),jr(c),r&&$(r),n.stop(),i&&(i.flags|=8,H(a,e,t,s)),o&&Sr(o,t),Sr(()=>{e.isUnmounted=!0},t)},Q=(e,t,s,r=!1,n=!1,i=0)=>{for(let a=i;a<e.length;a++)H(e[a],t,s,r,n)},X=e=>{if(6&e.shapeFlag)return X(e.component.subTree);if(128&e.shapeFlag)return e.suspense.next();const t=p(e.anchor||e.el),s=t&&t[Zt];return s?p(s):t};let Z=!1;const ee=(e,t,s)=>{null==e?t._vnode&&H(t._vnode,null,null,!0):y(t._vnode||null,e,t,null,null,null,s),t._vnode=e,Z||(Z=!0,Wt(),Kt(),Z=!1)},se={p:y,um:H,m:z,r:J,mt:B,mc:j,pc:V,pbc:P,n:X,o:e};let ne;return{render:ee,hydrate:ne,createApp:Ks(ee)}}(e)}function Or({type:e,props:t},s){return"svg"===s&&"foreignObject"===e||"mathml"===s&&"annotation-xml"===e&&t&&t.encoding&&t.encoding.includes("html")?void 0:s}function Tr({effect:e,job:t},s){s?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function Cr(e,t,s=!1){const r=e.children,n=t.children;if(h(r)&&h(n))for(let i=0;i<r.length;i++){const e=r[i];let t=n[i];1&t.shapeFlag&&!t.dynamicChildren&&((t.patchFlag<=0||32===t.patchFlag)&&(t=n[i]=en(n[i]),t.el=e.el),s||-2===t.patchFlag||Cr(e,t)),t.type===Pr&&-1!==t.patchFlag&&(t.el=e.el),t.type!==Ir||t.el||(t.el=e.el)}}function Ar(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:Ar(t)}function jr(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const xr=e=>e.__isSuspense;const Rr=Symbol.for("v-fgt"),Pr=Symbol.for("v-txt"),Ir=Symbol.for("v-cmt"),$r=Symbol.for("v-stc"),Nr=[];let Ur=null;function Lr(e=!1){Nr.push(Ur=e?null:[])}let Dr=1;function Br(e,t=!1){Dr+=e,e<0&&Ur&&t&&(Ur.hasOnce=!0)}function Fr(e){return e.dynamicChildren=Dr>0?Ur||r:null,Nr.pop(),Ur=Nr[Nr.length-1]||null,Dr>0&&Ur&&Ur.push(e),e}function Mr(e,t,s,r,n,i){return Fr(Hr(e,t,s,r,n,i,!0))}function qr(e,t,s,r,n){return Fr(Jr(e,t,s,r,n,!0))}function Vr(e){return!!e&&!0===e.__v_isVNode}function Wr(e,t){return e.type===t.type&&e.key===t.key}const Kr=({key:e})=>null!=e?e:null,zr=({ref:e,ref_key:t,ref_for:s})=>("number"==typeof e&&(e=""+e),null!=e?y(e)||_t(e)||g(e)?{i:Jt,r:e,k:t,f:!!s}:e:null);function Hr(e,t=null,s=null,r=0,n=null,i=(e===Rr?0:1),a=!1,o=!1){const l={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Kr(t),ref:t&&zr(t),scopeId:Gt,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:Jt};return o?(tn(l,s),128&i&&e.normalize(l)):s&&(l.shapeFlag|=y(s)?8:16),Dr>0&&!a&&Ur&&(l.patchFlag>0||6&i)&&32!==l.patchFlag&&Ur.push(l),l}const Jr=function(e,t=null,s=null,r=0,n=null,i=!1){e&&e!==Es||(e=Ir);if(Vr(e)){const r=Gr(e,t,!0);return s&&tn(r,s),Dr>0&&!i&&Ur&&(6&r.shapeFlag?Ur[Ur.indexOf(e)]=r:Ur.push(r)),r.patchFlag=-2,r}a=e,g(a)&&"__vccOpts"in a&&(e=e.__vccOpts);var a;if(t){t=function(e){return e?vt(e)||ur(e)?l({},e):e:null}(t);let{class:e,style:s}=t;e&&!y(e)&&(t.class=W(e)),_(s)&&(vt(s)&&!h(s)&&(s=l({},s)),t.style=B(s))}const o=y(e)?1:xr(e)?128:(e=>e.__isTeleport)(e)?64:_(e)?4:g(e)?2:0;return Hr(e,t,s,r,n,o,i,!0)};function Gr(e,t,s=!1,r=!1){const{props:n,ref:i,patchFlag:o,children:l,transition:c}=e,u=t?function(...e){const t={};for(let s=0;s<e.length;s++){const r=e[s];for(const e in r)if("class"===e)t.class!==r.class&&(t.class=W([t.class,r.class]));else if("style"===e)t.style=B([t.style,r.style]);else if(a(e)){const s=t[e],n=r[e];!n||s===n||h(s)&&s.includes(n)||(t[e]=s?[].concat(s,n):n)}else""!==e&&(t[e]=r[e])}return t}(n||{},t):n,d={__v_isVNode:!0,__v_skip:!0,type:e.type,props:u,key:u&&Kr(u),ref:t&&t.ref?s&&i?h(i)?i.concat(zr(t)):[i,zr(t)]:zr(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:l,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Rr?-1===o?16:16|o:o,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:c,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Gr(e.ssContent),ssFallback:e.ssFallback&&Gr(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return c&&r&&ts(d,c.clone(d)),d}function Yr(e=" ",t=0){return Jr(Pr,null,e,t)}function Qr(e,t){const s=Jr($r,null,e);return s.staticCount=t,s}function Xr(e="",t=!1){return t?(Lr(),qr(Ir,null,e)):Jr(Ir,null,e)}function Zr(e){return null==e||"boolean"==typeof e?Jr(Ir):h(e)?Jr(Rr,null,e.slice()):Vr(e)?en(e):Jr(Pr,null,String(e))}function en(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:Gr(e)}function tn(e,t){let s=0;const{shapeFlag:r}=e;if(null==t)t=null;else if(h(t))s=16;else if("object"==typeof t){if(65&r){const s=t.default;return void(s&&(s._c&&(s._d=!1),tn(e,s()),s._c&&(s._d=!0)))}{s=32;const r=t._;r||ur(t)?3===r&&Jt&&(1===Jt.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=Jt}}else g(t)?(t={default:t,_ctx:Jt},s=32):(t=String(t),64&r?(s=16,t=[Yr(t)]):s=8);e.children=t,e.shapeFlag|=s}function sn(e,t,s,r=null){Pt(e,t,7,[s,r])}const rn=Vs();let nn=0;let an=null;const on=()=>an||Jt;let ln,cn;{const e=D(),t=(t,s)=>{let r;return(r=e[t])||(r=e[t]=[]),r.push(s),e=>{r.length>1?r.forEach(t=>t(e)):r[0](e)}};ln=t("__VUE_INSTANCE_SETTERS__",e=>an=e),cn=t("__VUE_SSR_SETTERS__",e=>fn=e)}const un=e=>{const t=an;return ln(e),e.scope.on(),()=>{e.scope.off(),ln(t)}},dn=()=>{an&&an.scope.off(),ln(null)};function hn(e){return 4&e.vnode.shapeFlag}let fn=!1;function pn(e,t,s){g(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:_(t)&&(e.setupState=Et(t)),vn(e)}function vn(e,t,s){const r=e.type;e.render||(e.render=r.render||n);{const t=un(e);me();try{Ps(e)}finally{_e(),t()}}}const gn={get:(e,t)=>(je(e,0,""),e[t])};function yn(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(Et((t=e.exposed,!d(t,"__v_skip")&&Object.isExtensible(t)&&N(t,"__v_skip",!0),t)),{get:(t,s)=>s in t?t[s]:s in Cs?Cs[s](e):void 0,has:(e,t)=>t in e||t in Cs})):e.proxy;var t}const mn=(e,t)=>{const s=function(e,t,s=!1){let r,n;return g(e)?r=e:(r=e.get,n=e.set),new Ot(r,n,s)}(e,0,fn);return s},_n="3.5.25";
/**
  * @vue/runtime-dom v3.5.25
  * (c) 2018-present Yuxi (Evan) You and Vue contributors
  * @license MIT
  **/
let bn;const wn="undefined"!=typeof window&&window.trustedTypes;if(wn)try{bn=wn.createPolicy("vue",{createHTML:e=>e})}catch(cp){}const kn=bn?e=>bn.createHTML(e):e=>e,Sn="undefined"!=typeof document?document:null,En=Sn&&Sn.createElement("template"),On={insert:(e,t,s)=>{t.insertBefore(e,s||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,s,r)=>{const n="svg"===t?Sn.createElementNS("http://www.w3.org/2000/svg",e):"mathml"===t?Sn.createElementNS("http://www.w3.org/1998/Math/MathML",e):s?Sn.createElement(e,{is:s}):Sn.createElement(e);return"select"===e&&r&&null!=r.multiple&&n.setAttribute("multiple",r.multiple),n},createText:e=>Sn.createTextNode(e),createComment:e=>Sn.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Sn.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,s,r,n,i){const a=s?s.previousSibling:t.lastChild;if(n&&(n===i||n.nextSibling))for(;t.insertBefore(n.cloneNode(!0),s),n!==i&&(n=n.nextSibling););else{En.innerHTML=kn("svg"===r?`<svg>${e}</svg>`:"mathml"===r?`<math>${e}</math>`:e);const n=En.content;if("svg"===r||"mathml"===r){const e=n.firstChild;for(;e.firstChild;)n.appendChild(e.firstChild);n.removeChild(e)}t.insertBefore(n,s)}return[a?a.nextSibling:t.firstChild,s?s.previousSibling:t.lastChild]}},Tn=Symbol("_vtc");const Cn=Symbol("_vod"),An=Symbol("_vsh"),jn={name:"show",beforeMount(e,{value:t},{transition:s}){e[Cn]="none"===e.style.display?"":e.style.display,s&&t?s.beforeEnter(e):xn(e,t)},mounted(e,{value:t},{transition:s}){s&&t&&s.enter(e)},updated(e,{value:t,oldValue:s},{transition:r}){!t!=!s&&(r?t?(r.beforeEnter(e),xn(e,!0),r.enter(e)):r.leave(e,()=>{xn(e,!1)}):xn(e,t))},beforeUnmount(e,{value:t}){xn(e,t)}};function xn(e,t){e.style.display=t?e[Cn]:"none",e[An]=!t}const Rn=Symbol(""),Pn=/(?:^|;)\s*display\s*:/;const In=/\s*!important$/;function $n(e,t,s){if(h(s))s.forEach(s=>$n(e,t,s));else if(null==s&&(s=""),t.startsWith("--"))e.setProperty(t,s);else{const r=function(e,t){const s=Un[t];if(s)return s;let r=A(t);if("filter"!==r&&r in e)return Un[t]=r;r=R(r);for(let n=0;n<Nn.length;n++){const s=Nn[n]+r;if(s in e)return Un[t]=s}return t}(e,t);In.test(s)?e.setProperty(x(r),s.replace(In,""),"important"):e[r]=s}}const Nn=["Webkit","Moz","ms"],Un={};const Ln="http://www.w3.org/1999/xlink";function Dn(e,t,s,r,n,i=K(t)){r&&t.startsWith("xlink:")?null==s?e.removeAttributeNS(Ln,t.slice(6,t.length)):e.setAttributeNS(Ln,t,s):null==s||i&&!z(s)?e.removeAttribute(t):e.setAttribute(t,i?"":m(s)?String(s):s)}function Bn(e,t,s,r,n){if("innerHTML"===t||"textContent"===t)return void(null!=s&&(e[t]="innerHTML"===t?kn(s):s));const i=e.tagName;if("value"===t&&"PROGRESS"!==i&&!i.includes("-")){const r="OPTION"===i?e.getAttribute("value")||"":e.value,n=null==s?"checkbox"===e.type?"on":"":String(s);return r===n&&"_value"in e||(e.value=n),null==s&&e.removeAttribute(t),void(e._value=s)}let a=!1;if(""===s||null==s){const r=typeof e[t];"boolean"===r?s=z(s):null==s&&"string"===r?(s="",a=!0):"number"===r&&(s=0,a=!0)}try{e[t]=s}catch(cp){}a&&e.removeAttribute(n||t)}function Fn(e,t,s,r){e.addEventListener(t,s,r)}const Mn=Symbol("_vei");function qn(e,t,s,r,n=null){const i=e[Mn]||(e[Mn]={}),a=i[t];if(r&&a)a.value=r;else{const[s,o]=function(e){let t;if(Vn.test(e)){let s;for(t={};s=e.match(Vn);)e=e.slice(0,e.length-s[0].length),t[s[0].toLowerCase()]=!0}const s=":"===e[2]?e.slice(3):x(e.slice(2));return[s,t]}(t);if(r){const a=i[t]=function(e,t){const s=e=>{if(e._vts){if(e._vts<=s.attached)return}else e._vts=Date.now();Pt(function(e,t){if(h(t)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},t.map(e=>t=>!t._stopped&&e&&e(t))}return t}(e,s.value),t,5,[e])};return s.value=e,s.attached=zn(),s}(r,n);Fn(e,s,a,o)}else a&&(!function(e,t,s,r){e.removeEventListener(t,s,r)}(e,s,a,o),i[t]=void 0)}}const Vn=/(?:Once|Passive|Capture)$/;let Wn=0;const Kn=Promise.resolve(),zn=()=>Wn||(Kn.then(()=>Wn=0),Wn=Date.now());const Hn=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123;const Jn=e=>{const t=e.props["onUpdate:modelValue"]||!1;return h(t)?e=>$(t,e):t};function Gn(e){e.target.composing=!0}function Yn(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Qn=Symbol("_assign");function Xn(e,t,s){return t&&(e=e.trim()),s&&(e=U(e)),e}const Zn={created(e,{modifiers:{lazy:t,trim:s,number:r}},n){e[Qn]=Jn(n);const i=r||n.props&&"number"===n.props.type;Fn(e,t?"change":"input",t=>{t.target.composing||e[Qn](Xn(e.value,s,i))}),(s||i)&&Fn(e,"change",()=>{e.value=Xn(e.value,s,i)}),t||(Fn(e,"compositionstart",Gn),Fn(e,"compositionend",Yn),Fn(e,"change",Yn))},mounted(e,{value:t}){e.value=null==t?"":t},beforeUpdate(e,{value:t,oldValue:s,modifiers:{lazy:r,trim:n,number:i}},a){if(e[Qn]=Jn(a),e.composing)return;const o=null==t?"":t;if((!i&&"number"!==e.type||/^0\d/.test(e.value)?e.value:U(e.value))!==o){if(document.activeElement===e&&"range"!==e.type){if(r&&t===s)return;if(n&&e.value.trim()===o)return}e.value=o}}},ei={deep:!0,created(e,{value:t,modifiers:{number:s}},r){const n=p(t);Fn(e,"change",()=>{const t=Array.prototype.filter.call(e.options,e=>e.selected).map(e=>s?U(si(e)):si(e));e[Qn](e.multiple?n?new Set(t):t:t[0]),e._assigning=!0,Mt(()=>{e._assigning=!1})}),e[Qn]=Jn(r)},mounted(e,{value:t}){ti(e,t)},beforeUpdate(e,t,s){e[Qn]=Jn(s)},updated(e,{value:t}){e._assigning||ti(e,t)}};function ti(e,t){const s=e.multiple,r=h(t);if(!s||r||p(t)){for(let n=0,i=e.options.length;n<i;n++){const i=e.options[n],a=si(i);if(s)if(r){const e=typeof a;i.selected="string"===e||"number"===e?t.some(e=>String(e)===String(a)):J(t,a)>-1}else i.selected=t.has(a);else if(H(si(i),t))return void(e.selectedIndex!==n&&(e.selectedIndex=n))}s||-1===e.selectedIndex||(e.selectedIndex=-1)}}function si(e){return"_value"in e?e._value:e.value}const ri=["ctrl","shift","alt","meta"],ni={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(e,t)=>ri.some(s=>e[`${s}Key`]&&!t.includes(s))},ii=(e,t)=>{const s=e._withMods||(e._withMods={}),r=t.join(".");return s[r]||(s[r]=(s,...r)=>{for(let e=0;e<t.length;e++){const r=ni[t[e]];if(r&&r(s,t))return}return e(s,...r)})},ai=l({patchProp:(e,t,s,r,n,i)=>{const l="svg"===n;"class"===t?function(e,t,s){const r=e[Tn];r&&(t=(t?[t,...r]:[...r]).join(" ")),null==t?e.removeAttribute("class"):s?e.setAttribute("class",t):e.className=t}(e,r,l):"style"===t?function(e,t,s){const r=e.style,n=y(s);let i=!1;if(s&&!n){if(t)if(y(t))for(const e of t.split(";")){const t=e.slice(0,e.indexOf(":")).trim();null==s[t]&&$n(r,t,"")}else for(const e in t)null==s[e]&&$n(r,e,"");for(const e in s)"display"===e&&(i=!0),$n(r,e,s[e])}else if(n){if(t!==s){const e=r[Rn];e&&(s+=";"+e),r.cssText=s,i=Pn.test(s)}}else t&&e.removeAttribute("style");Cn in e&&(e[Cn]=i?r.display:"",e[An]&&(r.display="none"))}(e,s,r):a(t)?o(t)||qn(e,t,0,r,i):("."===t[0]?(t=t.slice(1),1):"^"===t[0]?(t=t.slice(1),0):function(e,t,s,r){if(r)return"innerHTML"===t||"textContent"===t||!!(t in e&&Hn(t)&&g(s));if("spellcheck"===t||"draggable"===t||"translate"===t||"autocorrect"===t)return!1;if("sandbox"===t&&"IFRAME"===e.tagName)return!1;if("form"===t)return!1;if("list"===t&&"INPUT"===e.tagName)return!1;if("type"===t&&"TEXTAREA"===e.tagName)return!1;if("width"===t||"height"===t){const t=e.tagName;if("IMG"===t||"VIDEO"===t||"CANVAS"===t||"SOURCE"===t)return!1}if(Hn(t)&&y(s))return!1;return t in e}(e,t,r,l))?(Bn(e,t,r),e.tagName.includes("-")||"value"!==t&&"checked"!==t&&"selected"!==t||Dn(e,t,r,l,0,"value"!==t)):!e._isVueCE||!/[A-Z]/.test(t)&&y(r)?("true-value"===t?e._trueValue=r:"false-value"===t&&(e._falseValue=r),Dn(e,t,r,l)):Bn(e,A(t),r,0,t)}},On);let oi;const li=(...e)=>{const t=(oi||(oi=Er(ai))).createApp(...e),{mount:s}=t;return t.mount=e=>{const r=function(e){if(y(e)){return document.querySelector(e)}return e}(e);if(!r)return;const n=t._component;g(n)||n.render||n.template||(n.template=r.innerHTML),1===r.nodeType&&(r.textContent="");const i=s(r,!1,function(e){if(e instanceof SVGElement)return"svg";if("function"==typeof MathMLElement&&e instanceof MathMLElement)return"mathml"}(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),i},t};var ci=function(e,t){return(ci=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(e,t)};function ui(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}ci(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}var di=function(){return di=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++)for(var n in t=arguments[s])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},di.apply(this,arguments)};function hi(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]])}return s}function fi(e,t,s,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,s,a):n(t,s))||a);return i>3&&a&&Object.defineProperty(t,s,a),a}function pi(e,t){return function(s,r){t(s,r,e)}}function vi(e,t,s,r,n,i){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=r.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?r.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),h=!1,f=s.length-1;f>=0;f--){var p={};for(var v in r)p[v]="access"===v?{}:r[v];for(var v in r.access)p.access[v]=r.access[v];p.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(e||null))};var g=(0,s[f])("accessor"===l?{get:d.get,set:d.set}:d[c],p);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=a(g.get))&&(d.get=o),(o=a(g.set))&&(d.set=o),(o=a(g.init))&&n.unshift(o)}else(o=a(g))&&("field"===l?n.unshift(o):d[c]=o)}u&&Object.defineProperty(u,r.name,d),h=!0}function gi(e,t,s){for(var r=arguments.length>2,n=0;n<t.length;n++)s=r?t[n].call(e,s):t[n].call(e);return r?s:void 0}function yi(e){return"symbol"==typeof e?e:"".concat(e)}function mi(e,t,s){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:s?"".concat(s," ",t):t})}function _i(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function bi(e,t,s,r){return new(s||(s=Promise))(function(n,i){function a(e){try{l(r.next(e))}catch(cp){i(cp)}}function o(e){try{l(r.throw(e))}catch(cp){i(cp)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})}function wi(e,t){var s,r,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(s)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(i=0)),i;)try{if(s=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(cp){o=[6,cp],r=0}finally{s=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}var ki=Object.create?function(e,t,s,r){void 0===r&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]};function Si(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||ki(t,e,s)}function Ei(e){var t="function"==typeof Symbol&&Symbol.iterator,s=t&&e[t],r=0;if(s)return s.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Oi(e,t){var s="function"==typeof Symbol&&e[Symbol.iterator];if(!s)return e;var r,n,i=s.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(o){n={error:o}}finally{try{r&&!r.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}return a}function Ti(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Oi(arguments[t]));return e}function Ci(){for(var e=0,t=0,s=arguments.length;t<s;t++)e+=arguments[t].length;var r=Array(e),n=0;for(t=0;t<s;t++)for(var i=arguments[t],a=0,o=i.length;a<o;a++,n++)r[n]=i[a];return r}function Ai(e,t,s){if(s||2===arguments.length)for(var r,n=0,i=t.length;n<i;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}function ji(e){return this instanceof ji?(this.v=e,this):new ji(e)}function xi(e,t,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=s.apply(e,t||[]),i=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(e,t){n[e]&&(r[e]=function(t){return new Promise(function(s,r){i.push([e,t,s,r])>1||o(e,t)})},t&&(r[e]=t(r[e])))}function o(e,t){try{(s=n[e](t)).value instanceof ji?Promise.resolve(s.value.v).then(l,c):u(i[0][2],s)}catch(cp){u(i[0][3],cp)}var s}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),i.shift(),i.length&&o(i[0][0],i[0][1])}}function Ri(e){var t,s;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,n){t[r]=e[r]?function(t){return(s=!s)?{value:ji(e[r](t)),done:!1}:n?n(t):t}:n}}function Pi(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,s=e[Symbol.asyncIterator];return s?s.call(e):(e=Ei(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=e[s]&&function(t){return new Promise(function(r,n){(function(e,t,s,r){Promise.resolve(r).then(function(t){e({value:t,done:s})},t)})(r,n,(t=e[s](t)).done,t.value)})}}}function Ii(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var $i=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},Ni=function(e){return(Ni=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t})(e)};function Ui(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=Ni(e),r=0;r<s.length;r++)"default"!==s[r]&&ki(t,e,s[r]);return $i(t,e),t}function Li(e){return e&&e.__esModule?e:{default:e}}function Di(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}function Bi(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function Fi(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function Mi(e,t,s){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var r,n;if(s){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],s&&(n=r)}if("function"!=typeof r)throw new TypeError("Object not disposable.");n&&(r=function(){try{n.call(this)}catch(cp){return Promise.reject(cp)}}),e.stack.push({value:t,dispose:r,async:s})}else s&&e.stack.push({async:!0});return t}var qi="function"==typeof SuppressedError?SuppressedError:function(e,t,s){var r=new Error(s);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function Vi(e){function t(t){e.error=e.hasError?new qi(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var s,r=0;return function n(){for(;s=e.stack.pop();)try{if(!s.async&&1===r)return r=0,e.stack.push(s),Promise.resolve().then(n);if(s.dispose){var i=s.dispose.call(s.value);if(s.async)return r|=2,Promise.resolve(i).then(n,function(e){return t(e),n()})}else r|=1}catch(cp){t(cp)}if(1===r)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function Wi(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,s,r,n,i){return s?t?".jsx":".js":!r||n&&i?r+n+"."+i.toLowerCase()+"js":e}):e}const Ki={__extends:ui,__assign:di,__rest:hi,__decorate:fi,__param:pi,__esDecorate:vi,__runInitializers:gi,__propKey:yi,__setFunctionName:mi,__metadata:_i,__awaiter:bi,__generator:wi,__createBinding:ki,__exportStar:Si,__values:Ei,__read:Oi,__spread:Ti,__spreadArrays:Ci,__spreadArray:Ai,__await:ji,__asyncGenerator:xi,__asyncDelegator:Ri,__asyncValues:Pi,__makeTemplateObject:Ii,__importStar:Ui,__importDefault:Li,__classPrivateFieldGet:Di,__classPrivateFieldSet:Bi,__classPrivateFieldIn:Fi,__addDisposableResource:Mi,__disposeResources:Vi,__rewriteRelativeImportExtension:Wi},zi=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Mi,get __assign(){return di},__asyncDelegator:Ri,__asyncGenerator:xi,__asyncValues:Pi,__await:ji,__awaiter:bi,__classPrivateFieldGet:Di,__classPrivateFieldIn:Fi,__classPrivateFieldSet:Bi,__createBinding:ki,__decorate:fi,__disposeResources:Vi,__esDecorate:vi,__exportStar:Si,__extends:ui,__generator:wi,__importDefault:Li,__importStar:Ui,__makeTemplateObject:Ii,__metadata:_i,__param:pi,__propKey:yi,__read:Oi,__rest:hi,__rewriteRelativeImportExtension:Wi,__runInitializers:gi,__setFunctionName:mi,__spread:Ti,__spreadArray:Ai,__spreadArrays:Ci,__values:Ei,default:Ki},Symbol.toStringTag,{value:"Module"}));class Hi extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Ji extends Hi{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Gi extends Hi{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Yi extends Hi{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Qi,Xi;(Xi=Qi||(Qi={})).Any="any",Xi.ApNortheast1="ap-northeast-1",Xi.ApNortheast2="ap-northeast-2",Xi.ApSouth1="ap-south-1",Xi.ApSoutheast1="ap-southeast-1",Xi.ApSoutheast2="ap-southeast-2",Xi.CaCentral1="ca-central-1",Xi.EuCentral1="eu-central-1",Xi.EuWest1="eu-west-1",Xi.EuWest2="eu-west-2",Xi.EuWest3="eu-west-3",Xi.SaEast1="sa-east-1",Xi.UsEast1="us-east-1",Xi.UsWest1="us-west-1",Xi.UsWest2="us-west-2";class Zi{constructor(e,{headers:t={},customFetch:s,region:r=Qi.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return bi(this,arguments,void 0,function*(e,t={}){var s;let r,n;try{const{headers:i,method:a,body:o,signal:l,timeout:c}=t;let u={},{region:d}=t;d||(d=this.region);const h=new URL(`${this.url}/${e}`);let f;d&&"any"!==d&&(u["x-region"]=d,h.searchParams.set("forceFunctionRegion",d)),o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?"undefined"!=typeof Blob&&o instanceof Blob||o instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",f=o):"string"==typeof o?(u["Content-Type"]="text/plain",f=o):"undefined"!=typeof FormData&&o instanceof FormData?f=o:(u["Content-Type"]="application/json",f=JSON.stringify(o)):f=o;let p=l;c&&(n=new AbortController,r=setTimeout(()=>n.abort(),c),l?(p=n.signal,l.addEventListener("abort",()=>n.abort())):p=n.signal);const v=yield this.fetch(h.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),i),body:f,signal:p}).catch(e=>{throw new Ji(e)}),g=v.headers.get("x-relay-error");if(g&&"true"===g)throw new Gi(v);if(!v.ok)throw new Yi(v);let y,m=(null!==(s=v.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return y="application/json"===m?yield v.json():"application/octet-stream"===m||"application/pdf"===m?yield v.blob():"text/event-stream"===m?v:"multipart/form-data"===m?yield v.formData():yield v.text(),{data:y,error:null,response:v}}catch(i){return{data:null,error:i,response:i instanceof Yi||i instanceof Gi?i.context:void 0}}finally{r&&clearTimeout(r)}})}}function ea(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var s=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(s,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}),s}var ta={};const sa=ea(zi);var ra,na,ia,aa,oa,la,ca={},ua={},da={},ha={},fa={},pa={};function va(){if(ra)return pa;ra=1,Object.defineProperty(pa,"__esModule",{value:!0});class e extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}return pa.default=e,pa}function ga(){if(na)return fa;na=1,Object.defineProperty(fa,"__esModule",{value:!0});const e=sa.__importDefault(va());return fa.default=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(s=e.isMaybeSingle)&&void 0!==s&&s,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(t,s){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async t=>{var s,r,n,i;let a=null,o=null,l=null,c=t.status,u=t.statusText;if(t.ok){if("HEAD"!==this.method){const e=await t.text();""===e||(o="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(s=this.headers.get("Accept"))||void 0===s?void 0:s.includes("application/vnd.pgrst.plan+text"))?e:JSON.parse(e))}const e=null===(r=this.headers.get("Prefer"))||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),i=null===(n=t.headers.get("content-range"))||void 0===n?void 0:n.split("/");e&&i&&i.length>1&&(l=parseInt(i[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(a={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,c=406,u="Not Acceptable"):o=1===o.length?o[0]:null)}else{const s=await t.text();try{a=JSON.parse(s),Array.isArray(a)&&404===t.status&&(o=[],a=null,c=200,u="OK")}catch(d){404===t.status&&""===s?(c=204,u="No Content"):a={message:s}}if(a&&this.isMaybeSingle&&(null===(i=null==a?void 0:a.details)||void 0===i?void 0:i.includes("0 rows"))&&(a=null,c=200,u="OK"),a&&this.shouldThrowOnError)throw new e.default(a)}return{error:a,data:o,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,s,r,n,i,a;let o="";const l=null==e?void 0:e.cause;if(l){const i=null!==(t=null==l?void 0:l.message)&&void 0!==t?t:"",a=null!==(s=null==l?void 0:l.code)&&void 0!==s?s:"";o=`${null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"FetchError"}: ${null==e?void 0:e.message}`,o+=`\n\nCaused by: ${null!==(n=null==l?void 0:l.name)&&void 0!==n?n:"Error"}: ${i}`,a&&(o+=` (${a})`),(null==l?void 0:l.stack)&&(o+=`\n${l.stack}`)}else o=null!==(i=null==e?void 0:e.stack)&&void 0!==i?i:"";return{error:{message:`${null!==(a=null==e?void 0:e.name)&&void 0!==a?a:"FetchError"}: ${null==e?void 0:e.message}`,details:o,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),r.then(t,s)}returns(){return this}overrideTypes(){return this}},fa}function ya(){if(ia)return ha;ia=1,Object.defineProperty(ha,"__esModule",{value:!0});const e=sa.__importDefault(ga());class t extends e.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:n=r}={}){const i=n?`${n}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const n=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:n=!1,format:i="text"}={}){var a;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(a=this.headers.get("Accept"))&&void 0!==a?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}}return ha.default=t,ha}function ma(){if(aa)return da;aa=1,Object.defineProperty(da,"__esModule",{value:!0});const e=sa.__importDefault(ya()),t=new RegExp("[,()]");class s extends e.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,s){const r=Array.from(new Set(s)).map(e=>"string"==typeof e&&t.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let n="";"plain"===r?n="pl":"phrase"===r?n="ph":"websearch"===r&&(n="w");const i=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}return da.default=s,da}function _a(){if(oa)return ua;oa=1,Object.defineProperty(ua,"__esModule",{value:!0});const e=sa.__importDefault(ma());return ua.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=r}select(t,s){const{head:r=!1,count:n}=null!=s?s:{},i=r?"HEAD":"GET";let a=!1;const o=(null!=t?t:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:s,defaultToNull:r=!0}={}){var n;if(s&&this.headers.append("Prefer",`count=${s}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(e.length>0){const t=[...new Set(e)].map(e=>`"${e}"`);this.url.searchParams.set("columns",t.join(","))}}return new e.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(t,{onConflict:s,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){var a;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==s&&this.url.searchParams.set("on_conflict",s),n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(e.length>0){const t=[...new Set(e)].map(e=>`"${e}"`);this.url.searchParams.set("columns",t.join(","))}}return new e.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(a=this.fetch)&&void 0!==a?a:fetch})}update(t,{count:s}={}){var r;return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:t}={}){var s;return t&&this.headers.append("Prefer",`count=${t}`),new e.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}},ua}Object.defineProperty(ta,"__esModule",{value:!0});var ba=ta.PostgrestError=ta.PostgrestBuilder=ta.PostgrestTransformBuilder=ta.PostgrestFilterBuilder=ta.PostgrestQueryBuilder=ta.PostgrestClient=void 0;const wa=sa,ka=wa.__importDefault(function(){if(la)return ca;la=1,Object.defineProperty(ca,"__esModule",{value:!0});const e=sa,t=e.__importDefault(_a()),s=e.__importDefault(ma());class r{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=r}from(e){if(!e||"string"!=typeof e||""===e.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");const s=new URL(`${this.url}/${e}`);return new t.default(s,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new r(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:i}={}){var a;let o;const l=new URL(`${this.url}/rpc/${e}`);let c;r||n?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(o="POST",c=t);const u=new Headers(this.headers);return i&&u.set("Prefer",`count=${i}`),new s.default({method:o,url:l,headers:u,schema:this.schemaName,body:c,fetch:null!==(a=this.fetch)&&void 0!==a?a:fetch})}}return ca.default=r,ca}());var Sa=ta.PostgrestClient=ka.default;const Ea=wa.__importDefault(_a());var Oa=ta.PostgrestQueryBuilder=Ea.default;const Ta=wa.__importDefault(ma());var Ca=ta.PostgrestFilterBuilder=Ta.default;const Aa=wa.__importDefault(ya());var ja=ta.PostgrestTransformBuilder=Aa.default;const xa=wa.__importDefault(ga());var Ra=ta.PostgrestBuilder=xa.default;const Pa=wa.__importDefault(va());ba=ta.PostgrestError=Pa.default;var Ia=ta.default={PostgrestClient:ka.default,PostgrestQueryBuilder:Ea.default,PostgrestFilterBuilder:Ta.default,PostgrestTransformBuilder:Aa.default,PostgrestBuilder:xa.default,PostgrestError:Pa.default};const $a=e({__proto__:null,get PostgrestBuilder(){return Ra},get PostgrestClient(){return Sa},get PostgrestError(){return ba},get PostgrestFilterBuilder(){return Ca},get PostgrestQueryBuilder(){return Oa},get PostgrestTransformBuilder(){return ja},default:Ia},[ta]),{PostgrestClient:Na,PostgrestQueryBuilder:Ua,PostgrestFilterBuilder:La,PostgrestTransformBuilder:Da,PostgrestBuilder:Ba,PostgrestError:Fa}=Ia||$a;class Ma{constructor(){}static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,s=parseInt(t.replace(/^v/,"").split(".")[0]);return s>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const qa="1.0.0",Va=qa,Wa=1e4;var Ka,za,Ha,Ja,Ga,Ya,Qa,Xa,Za,eo,to;(za=Ka||(Ka={}))[za.connecting=0]="connecting",za[za.open=1]="open",za[za.closing=2]="closing",za[za.closed=3]="closed",(Ja=Ha||(Ha={})).closed="closed",Ja.errored="errored",Ja.joined="joined",Ja.joining="joining",Ja.leaving="leaving",(Ya=Ga||(Ga={})).close="phx_close",Ya.error="phx_error",Ya.join="phx_join",Ya.reply="phx_reply",Ya.leave="phx_leave",Ya.access_token="access_token",(Qa||(Qa={})).websocket="websocket",(Za=Xa||(Xa={})).Connecting="connecting",Za.Open="open",Za.Closing="closing",Za.Closed="closed";class so{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=e?e:[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&"string"==typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;const r=null!==(s=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==s?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(e){var t,s;const r=null!==(s=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==s?s:{},n=(new TextEncoder).encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,n)}_encodeUserBroadcastPush(e,t,s){var r,n;const i=e.topic,a=null!==(r=e.ref)&&void 0!==r?r:"",o=null!==(n=e.join_ref)&&void 0!==n?n:"",l=e.payload.event,c=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},u=0===Object.keys(c).length?"":JSON.stringify(c);if(o.length>255)throw new Error(`joinRef length ${o.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`userEvent length ${l.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+o.length+a.length+i.length+l.length+u.length,h=new ArrayBuffer(this.HEADER_LENGTH+d);let f=new DataView(h),p=0;f.setUint8(p++,this.KINDS.userBroadcastPush),f.setUint8(p++,o.length),f.setUint8(p++,a.length),f.setUint8(p++,i.length),f.setUint8(p++,l.length),f.setUint8(p++,u.length),f.setUint8(p++,t),Array.from(o,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(a,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(i,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(l,e=>f.setUint8(p++,e.charCodeAt(0))),Array.from(u,e=>f.setUint8(p++,e.charCodeAt(0)));var v=new Uint8Array(h.byteLength+s.byteLength);return v.set(new Uint8Array(h),0),v.set(new Uint8Array(s),h.byteLength),v.buffer}decode(e,t){if(this._isArrayBuffer(e)){return t(this._binaryDecode(e))}if("string"==typeof e){const s=JSON.parse(e),[r,n,i,a,o]=s;return t({join_ref:r,ref:n,topic:i,event:a,payload:o})}return t({})}_binaryDecode(e){const t=new DataView(e),s=t.getUint8(0),r=new TextDecoder;if(s===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,r)}_decodeUserBroadcast(e,t,s){const r=t.getUint8(1),n=t.getUint8(2),i=t.getUint8(3),a=t.getUint8(4);let o=this.HEADER_LENGTH+4;const l=s.decode(e.slice(o,o+r));o+=r;const c=s.decode(e.slice(o,o+n));o+=n;const u=s.decode(e.slice(o,o+i));o+=i;const d=e.slice(o,e.byteLength),h=a===this.JSON_ENCODING?JSON.parse(s.decode(d)):d,f={type:this.BROADCAST_EVENT,event:c,payload:h};return i>0&&(f.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)}_pick(e,t){return e&&"object"==typeof e?Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e))):{}}}class ro{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(to=eo||(eo={})).abstime="abstime",to.bool="bool",to.date="date",to.daterange="daterange",to.float4="float4",to.float8="float8",to.int2="int2",to.int4="int4",to.int4range="int4range",to.int8="int8",to.int8range="int8range",to.json="json",to.jsonb="jsonb",to.money="money",to.numeric="numeric",to.oid="oid",to.reltime="reltime",to.text="text",to.time="time",to.timestamp="timestamp",to.timestamptz="timestamptz",to.timetz="timetz",to.tsrange="tsrange",to.tstzrange="tstzrange";const no=(e,t,s={})=>{var r;const n=null!==(r=s.skipTypes)&&void 0!==r?r:[];return t?Object.keys(t).reduce((s,r)=>(s[r]=io(r,e,t,n),s),{}):{}},io=(e,t,s,r)=>{const n=t.find(t=>t.name===e),i=null==n?void 0:n.type,a=s[e];return i&&!r.includes(i)?ao(i,a):oo(a)},ao=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return ho(t,s)}switch(e){case eo.bool:return lo(t);case eo.float4:case eo.float8:case eo.int2:case eo.int4:case eo.int8:case eo.numeric:case eo.oid:return co(t);case eo.json:case eo.jsonb:return uo(t);case eo.timestamp:return fo(t);case eo.abstime:case eo.date:case eo.daterange:case eo.int4range:case eo.int8range:case eo.money:case eo.reltime:case eo.text:case eo.time:case eo.timestamptz:case eo.timetz:case eo.tsrange:case eo.tstzrange:default:return oo(t)}},oo=e=>e,lo=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},co=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},uo=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},ho=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const i=e.slice(1,s);try{r=JSON.parse("["+i+"]")}catch(n){r=i?i.split(","):[]}return r.map(e=>ao(t,e))}return e},fo=e=>"string"==typeof e?e.replace(" ","T"):e,po=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class vo{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var go,yo,mo,_o,bo,wo,ko,So;(yo=go||(go={})).SYNC="sync",yo.JOIN="join",yo.LEAVE="leave";class Eo{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Eo.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=Eo.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Eo.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const n=this.cloneDeep(e),i=this.transformState(t),a={},o={};return this.map(n,(e,t)=>{i[e]||(o[e]=t)}),this.map(i,(e,t)=>{const s=n[e];if(s){const r=t.map(e=>e.presence_ref),n=s.map(e=>e.presence_ref),i=t.filter(e=>n.indexOf(e.presence_ref)<0),l=s.filter(e=>r.indexOf(e.presence_ref)<0);i.length>0&&(a[e]=i),l.length>0&&(o[e]=l)}else a[e]=t}),this.syncDiff(n,{joins:a,leaves:o},s,r)}static syncDiff(e,t,s,r){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(n,(t,r)=>{var n;const i=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(r),i.length>0){const s=e[t].map(e=>e.presence_ref),r=i.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...r)}s(t,i,r)}),this.map(i,(t,s)=>{let n=e[t];if(!n)return;const i=s.map(e=>e.presence_ref);n=n.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=n,r(t,n,s),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(_o=mo||(mo={})).ALL="*",_o.INSERT="INSERT",_o.UPDATE="UPDATE",_o.DELETE="DELETE",(wo=bo||(bo={})).BROADCAST="broadcast",wo.PRESENCE="presence",wo.POSTGRES_CHANGES="postgres_changes",wo.SYSTEM="system",(So=ko||(ko={})).SUBSCRIBED="SUBSCRIBED",So.TIMED_OUT="TIMED_OUT",So.CLOSED="CLOSED",So.CHANNEL_ERROR="CHANNEL_ERROR";class Oo{constructor(e,t={config:{}},s){var r,n;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Ha.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new vo(this,Ga.join,this.params,this.timeout),this.rejoinTimer=new ro(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ha.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ha.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Ha.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ha.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Ha.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ga.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Eo(this),this.broadcastEndpointURL=po(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(n=null===(r=this.params.config)||void 0===r?void 0:r.broadcast)||void 0===n?void 0:n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==Ha.closed){const{config:{broadcast:i,presence:a,private:o}}=this.params,l=null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==r?r:[],c=!!this.bindings[bo.PRESENCE]&&this.bindings[bo.PRESENCE].length>0||!0===(null===(n=this.params.config.presence)||void 0===n?void 0:n.enabled),u={},d={broadcast:i,presence:Object.assign(Object.assign({},a),{enabled:c}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(ko.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(ko.CLOSED)),this.updateJoinPayload(Object.assign({config:d},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,n=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,i=[];for(let s=0;s<n;s++){const n=r[s],{filter:{event:a,schema:o,table:l,filter:c}}=n,u=t&&t[s];if(!u||u.event!==a||u.schema!==o||u.table!==l||u.filter!==c)return this.unsubscribe(),this.state=Ha.errored,void(null==e||e(ko.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},n),{id:u.id}))}return this.bindings.postgres_changes=i,void(e&&e(ko.SUBSCRIBED))}null==e||e(ko.SUBSCRIBED)}).receive("error",t=>{this.state=Ha.errored,null==e||e(ko.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(ko.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===Ha.joined&&e===bo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var r;const n=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(null==t)return Promise.reject("Payload is required for httpSend()");const i={method:"POST",headers:{Authorization:n,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(r=s.timeout)&&void 0!==r?r:this.timeout);if(202===a.status)return{success:!0};let o=a.statusText;try{const e=await a.json();o=e.error||e.message||o}catch(l){}return Promise.reject(new Error(o))}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,n,i;const a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(n=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.ack)||s("ok"),a.receive("ok",()=>s("ok")),a.receive("error",()=>s("error")),a.receive("timeout",()=>s("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:a}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ha.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ga.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new vo(this,Ga.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ha.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const r=new AbortController,n=setTimeout(()=>r.abort(),s),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(n),i}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new vo(this,e,t,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,n;const i=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:c}=Ga;if(s&&[a,o,l,c].indexOf(i)>=0&&s!==this._joinRef())return;let u=this._onMessage(i,t,s);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===i}).map(e=>e.callback(u,s)):null===(n=this.bindings[i])||void 0===n||n.filter(e=>{var s,r,n,a,o,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,a=null===(s=e.filter)||void 0===s?void 0:s.event;return i&&(null===(r=t.ids)||void 0===r?void 0:r.includes(i))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const s=null===(o=null===(a=null==e?void 0:e.filter)||void 0===a?void 0:a.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:s,commit_timestamp:r,type:n,errors:i}=e,a={schema:t,table:s,commit_timestamp:r,eventType:n,new:{},old:{},errors:i};u=Object.assign(Object.assign({},a),this._getPayloadRecords(e))}e.callback(u,s)})}_isClosed(){return this.state===Ha.closed}_isJoined(){return this.state===Ha.joined}_isJoining(){return this.state===Ha.joining}_isLeaving(){return this.state===Ha.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),n={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(n):this.bindings[r]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&Oo.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ga.close,{},e)}_onError(e){this._on(Ga.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ha.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=no(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=no(e.columns,e.old_record)),t}}const To=()=>{},Co=25e3,Ao=10,jo=100,xo=[1e3,2e3,5e3,1e4];class Ro{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Wa,this.transport=null,this.heartbeatIntervalMs=Co,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=To,this.ref=0,this.reconnectTimer=null,this.vsn=Va,this.logger=To,this.conn=null,this.sendBuffer=[],this.serializer=new so,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Qa.websocket}`,this.httpEndpoint=po(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Ma.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Ka.connecting:return Xa.Connecting;case Ka.open:return Xa.Open;case Ka.closing:return Xa.Closing;default:return Xa.Closed}}isConnected(){return this.connectionState()===Xa.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{const s=new Oo(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${n})`,r),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(cp){this.log("error","error in heartbeat callback",cp)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},jo)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(cp){this.log("error","error in heartbeat callback",cp)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(cp){this.log("error","error in heartbeat callback",cp)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(cp){this.log("error","error in heartbeat callback",cp)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:s,payload:r,ref:n}=e,i=n?`(${n})`:"",a=r.status||"";this.log("receive",`${a} ${t} ${s} ${i}`.trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ka.open||this.conn.readyState===Ka.connecting)try{this.conn.close()}catch(cp){this.log("error","Error closing connection",cp)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`);(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ga.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const s={access_token:t,version:"realtime-js/2.86.0"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(Ga.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(cp){this.log("error",`error in ${e} callback`,cp)}})}catch(cp){this.log("error",`error triggering ${e} callbacks`,cp)}}_setupReconnectionTimer(){this.reconnectTimer=new ro(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ao)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,r,n,i,a,o,l,c,u,d,h;switch(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:Wa,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:Co,this.worker=null!==(n=null==e?void 0:e.worker)&&void 0!==n&&n,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(a=null==e?void 0:e.heartbeatCallback)&&void 0!==a?a:To,this.vsn=null!==(o=null==e?void 0:e.vsn)&&void 0!==o?o:Va,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null==e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>xo[e-1]||1e4,this.vsn){case qa:this.encode=null!==(c=null==e?void 0:e.encode)&&void 0!==c?c:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(u=null==e?void 0:e.decode)&&void 0!==u?u:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!==(d=null==e?void 0:e.encode)&&void 0!==d?d:this.serializer.encode.bind(this.serializer),this.decode=null!==(h=null==e?void 0:e.decode)&&void 0!==h?h:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class Po extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Io(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class $o extends Po{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class No extends Po{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const Uo=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),Lo=e=>{if(Array.isArray(e))return e.map(e=>Lo(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=Lo(s)}),t},Do=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)},Bo=(e,t,s)=>bi(void 0,void 0,void 0,function*(){const r=yield Response;e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{const r=e.status||500,n=(null==s?void 0:s.statusCode)||r+"";t(new $o(Do(s),r,n))}).catch(e=>{t(new No(Do(e),e))}):t(new No(Do(e),e))}),Fo=(e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(r)):n.body=r,(null==t?void 0:t.duplex)&&(n.duplex=t.duplex),Object.assign(Object.assign({},n),s)):n};function Mo(e,t,s,r,n,i){return bi(this,void 0,void 0,function*(){return new Promise((a,o)=>{e(s,Fo(t,r,n,i)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>a(e)).catch(e=>Bo(e,o,r))})})}function qo(e,t,s,r){return bi(this,void 0,void 0,function*(){return Mo(e,"GET",t,s,r)})}function Vo(e,t,s,r,n){return bi(this,void 0,void 0,function*(){return Mo(e,"POST",t,r,n,s)})}function Wo(e,t,s,r,n){return bi(this,void 0,void 0,function*(){return Mo(e,"PUT",t,r,n,s)})}function Ko(e,t,s,r,n){return bi(this,void 0,void 0,function*(){return Mo(e,"DELETE",t,r,n,s)})}class zo{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return bi(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Io(e))return{data:null,error:e};throw e}})}}var Ho;class Jo{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Ho]="BlobDownloadBuilder",this.promise=null}asStream(){return new zo(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return bi(this,void 0,void 0,function*(){try{const e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Io(e))return{data:null,error:e};throw e}})}}Ho=Symbol.toStringTag;const Go={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Yo={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Qo{constructor(e,t={},s,r){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=Uo(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,r){return bi(this,void 0,void 0,function*(){try{let n;const i=Object.assign(Object.assign({},Yo),r);let a=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const o=i.metadata;if("undefined"!=typeof Blob&&s instanceof Blob)n=new FormData,n.append("cacheControl",i.cacheControl),o&&n.append("metadata",this.encodeMetadata(o)),n.append("",s);else if("undefined"!=typeof FormData&&s instanceof FormData)n=s,n.has("cacheControl")||n.append("cacheControl",i.cacheControl),o&&!n.has("metadata")&&n.append("metadata",this.encodeMetadata(o));else{n=s,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,o&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(o)));("undefined"!=typeof ReadableStream&&n instanceof ReadableStream||n&&"object"==typeof n&&"pipe"in n&&"function"==typeof n.pipe)&&!i.duplex&&(i.duplex="half")}(null==r?void 0:r.headers)&&(a=Object.assign(Object.assign({},a),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield("PUT"==e?Wo:Vo)(this.fetch,`${this.url}/object/${c}`,n,Object.assign({headers:a},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Io(n))return{data:null,error:n};throw n}})}upload(e,t,s){return bi(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return bi(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),i=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Yo.upsert},r),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);return{data:{path:n,fullPath:(yield Wo(this.fetch,a.toString(),e,{headers:i})).Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(Io(o))return{data:null,error:o};throw o}})}createSignedUploadUrl(e,t){return bi(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const n=yield Vo(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),i=new URL(this.url+n.url),a=i.searchParams.get("token");if(!a)throw new Po("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Io(s))return{data:null,error:s};throw s}})}update(e,t,s){return bi(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return bi(this,void 0,void 0,function*(){try{return{data:yield Vo(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Io(r))return{data:null,error:r};throw r}})}copy(e,t,s){return bi(this,void 0,void 0,function*(){try{return{data:{path:(yield Vo(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Io(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return bi(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),n=yield Vo(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},{data:n,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Io(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return bi(this,void 0,void 0,function*(){try{const r=yield Vo(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Io(r))return{data:null,error:r};throw r}})}download(e,t){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=r?`?${r}`:"",i=this._getFinalPath(e);return new Jo(()=>qo(this.fetch,`${this.url}/${s}/${i}${n}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return bi(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield qo(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Lo(e),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Io(s))return{data:null,error:s};throw s}})}exists(e){return bi(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return bi(this,void 0,void 0,function*(){return Mo(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Io(s)&&s instanceof No){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&r.push(n);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&r.push(a);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${s}${o}`)}}}remove(e){return bi(this,void 0,void 0,function*(){try{return{data:yield Ko(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Io(t))return{data:null,error:t};throw t}})}list(e,t,s){return bi(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},Go),t),{prefix:e||""});return{data:yield Vo(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Io(r))return{data:null,error:r};throw r}})}listV2(e,t){return bi(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield Vo(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Io(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Xo="2.86.0",Zo={"X-Client-Info":`storage-js/${Xo}`};class el{constructor(e,t={},s,r){this.shouldThrowOnError=!1;const n=new URL(e);if(null==r?void 0:r.useNewHostname){/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."))}this.url=n.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zo),t),this.fetch=Uo(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return bi(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield qo(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Io(t))return{data:null,error:t};throw t}})}getBucket(e){return bi(this,void 0,void 0,function*(){try{return{data:yield qo(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Io(t))return{data:null,error:t};throw t}})}createBucket(e){return bi(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield Vo(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Io(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return bi(this,void 0,void 0,function*(){try{return{data:yield Wo(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Io(s))return{data:null,error:s};throw s}})}emptyBucket(e){return bi(this,void 0,void 0,function*(){try{return{data:yield Vo(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Io(t))return{data:null,error:t};throw t}})}deleteBucket(e){return bi(this,void 0,void 0,function*(){try{return{data:yield Ko(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Io(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}var tl=class extends Error{constructor(e,t){var s;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&!0===(null==(s=t.icebergType)?void 0:s.includes("CommitState"))}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};function sl(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:s,path:r,query:n,body:i,headers:a}){const o=function(e,t,s){const r=new URL(t,e);if(s)for(const[n,i]of Object.entries(s))void 0!==i&&r.searchParams.set(n,i);return r.toString()}(e.baseUrl,r,n),l=await async function(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:`Bearer ${e.token}`}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}(e.auth),c=await t(o,{method:s,headers:{...i?{"Content-Type":"application/json"}:{},...l,...a},body:i?JSON.stringify(i):void 0}),u=await c.text(),d=(c.headers.get("content-type")||"").includes("application/json"),h=d&&u?JSON.parse(u):u;if(!c.ok){const e=d?h:void 0,t=null==e?void 0:e.error;throw new tl((null==t?void 0:t.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:null==t?void 0:t.type,icebergCode:null==t?void 0:t.code,details:e})}return{status:c.status,headers:c.headers,data:h}}}}function rl(e){return e.join("")}var nl=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:rl(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){const s={namespace:e.namespace,properties:null==t?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${rl(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${rl(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${rl(e.namespace)}`}),!0}catch(t){if(t instanceof tl&&404===t.status)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(s){if(s instanceof tl&&409===s.status)return;throw s}}};function il(e){return e.join("")}var al=class{constructor(e,t="",s){this.client=e,this.prefix=t,this.accessDelegation=s}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${il(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const s={};this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${il(e.namespace)}/tables`,body:t,headers:s})).data.metadata}async updateTable(e,t){const s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${il(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${il(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((null==t?void 0:t.purge)??!1)}})}async loadTable(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${il(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${il(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(s){if(s instanceof tl&&404===s.status)return!1;throw s}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(s){if(s instanceof tl&&409===s.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw s}}},ol=class{constructor(e){var t;let s="v1";e.catalogName&&(s+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=sl({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=null==(t=e.accessDelegation)?void 0:t.join(","),this.namespaceOps=new nl(this.client,s),this.tableOps=new al(this.client,s,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}};class ll{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zo),t),this.fetch=Uo(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return bi(this,void 0,void 0,function*(){try{return{data:yield Vo(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Io(t))return{data:null,error:t};throw t}})}listBuckets(e){return bi(this,void 0,void 0,function*(){try{const t=new URLSearchParams;void 0!==(null==e?void 0:e.limit)&&t.set("limit",e.limit.toString()),void 0!==(null==e?void 0:e.offset)&&t.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&t.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&t.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&t.set("search",e.search);const s=t.toString(),r=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield qo(this.fetch,r,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Io(t))return{data:null,error:t};throw t}})}deleteBucket(e){return bi(this,void 0,void 0,function*(){try{return{data:yield Ko(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Io(t))return{data:null,error:t};throw t}})}from(e){if(!(e=>!(!e||"string"!=typeof e)&&(!(0===e.length||e.length>100)&&(e.trim()===e&&(!e.includes("/")&&!e.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e)))))(e))throw new Po("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");return new ol({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:()=>bi(this,void 0,void 0,function*(){return this.headers})},fetch:this.fetch})}}const cl={"X-Client-Info":`storage-js/${Xo}`,"Content-Type":"application/json"};class ul extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function dl(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}class hl extends ul{constructor(e,t,s){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class fl extends ul{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var pl,vl;(vl=pl||(pl={})).InternalError="InternalError",vl.S3VectorConflictException="S3VectorConflictException",vl.S3VectorNotFoundException="S3VectorNotFoundException",vl.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",vl.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",vl.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded";const gl=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),yl=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ml=(e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(r)):n.body=r,Object.assign(Object.assign({},n),s)):n};function _l(e,t,s,r,n,i){return bi(this,void 0,void 0,function*(){return new Promise((a,o)=>{e(s,ml(t,r,n,i)).then(e=>{if(!e.ok)throw e;if(null==r?void 0:r.noResolveJson)return e;const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>a(e)).catch(e=>((e,t,s)=>bi(void 0,void 0,void 0,function*(){if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==s?void 0:s.noResolveJson)){const s=e.status||500,r=e;if("function"==typeof r.json)r.json().then(e=>{const r=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||s+"";t(new hl(yl(e),s,r))}).catch(()=>{const e=s+"",n=r.statusText||`HTTP ${s} error`;t(new hl(n,s,e))});else{const e=s+"",n=r.statusText||`HTTP ${s} error`;t(new hl(n,s,e))}}else t(new fl(yl(e),e))}))(e,o,r))})})}function bl(e,t,s,r,n){return bi(this,void 0,void 0,function*(){return _l(e,"POST",t,r,n,s)})}class wl{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cl),t),this.fetch=gl(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return bi(this,void 0,void 0,function*(){try{return{data:(yield bl(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}getIndex(e,t){return bi(this,void 0,void 0,function*(){try{return{data:yield bl(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(dl(s))return{data:null,error:s};throw s}})}listIndexes(e){return bi(this,void 0,void 0,function*(){try{return{data:yield bl(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return bi(this,void 0,void 0,function*(){try{return{data:(yield bl(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(dl(s))return{data:null,error:s};throw s}})}}class kl{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cl),t),this.fetch=gl(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return bi(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield bl(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}getVectors(e){return bi(this,void 0,void 0,function*(){try{return{data:yield bl(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}listVectors(e){return bi(this,void 0,void 0,function*(){try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and "+(e.segmentCount-1))}return{data:yield bl(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}queryVectors(e){return bi(this,void 0,void 0,function*(){try{return{data:yield bl(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}deleteVectors(e){return bi(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield bl(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}}class Sl{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cl),t),this.fetch=gl(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return bi(this,void 0,void 0,function*(){try{return{data:(yield bl(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}getBucket(e){return bi(this,void 0,void 0,function*(){try{return{data:yield bl(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}listBuckets(){return bi(this,arguments,void 0,function*(e={}){try{return{data:yield bl(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}deleteBucket(e){return bi(this,void 0,void 0,function*(){try{return{data:(yield bl(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(dl(t))return{data:null,error:t};throw t}})}}class El extends Sl{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Ol(this.url,this.headers,e,this.fetch)}createBucket(e){const t=Object.create(null,{createBucket:{get:()=>super.createBucket}});return bi(this,void 0,void 0,function*(){return t.createBucket.call(this,e)})}getBucket(e){const t=Object.create(null,{getBucket:{get:()=>super.getBucket}});return bi(this,void 0,void 0,function*(){return t.getBucket.call(this,e)})}listBuckets(){const e=Object.create(null,{listBuckets:{get:()=>super.listBuckets}});return bi(this,arguments,void 0,function*(t={}){return e.listBuckets.call(this,t)})}deleteBucket(e){const t=Object.create(null,{deleteBucket:{get:()=>super.deleteBucket}});return bi(this,void 0,void 0,function*(){return t.deleteBucket.call(this,e)})}}class Ol extends wl{constructor(e,t,s,r){super(e,t,r),this.vectorBucketName=s}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return bi(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return bi(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return bi(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return bi(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Tl(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class Tl extends kl{constructor(e,t,s,r,n){super(e,t,n),this.vectorBucketName=s,this.indexName=r}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return bi(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return bi(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return bi(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return bi(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return bi(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Cl extends el{constructor(e,t={},s,r){super(e,t,s,r)}from(e){return new Qo(this.url,this.headers,e,this.fetch)}get vectors(){return new El(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new ll(this.url+"/iceberg",this.headers,this.fetch)}}let Al="";Al="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const jl={headers:{"X-Client-Info":`supabase-js-${Al}/2.86.0`}},xl={schema:"public"},Rl={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Pl={},Il=(e,t,s)=>{const r=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(s),n=Headers;return async(s,i)=>{var a;const o=null!==(a=await t())&&void 0!==a?a:e;let l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},i),{headers:l}))}};const $l="2.86.0",Nl=3e4,Ul=9e4,Ll={"X-Client-Info":`gotrue-js/${$l}`},Dl="X-Supabase-Api-Version",Bl={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Fl=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Ml extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function ql(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Vl extends Ml{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class Wl extends Ml{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Kl extends Ml{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class zl extends Kl{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Hl extends Kl{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Jl extends Kl{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Gl extends Kl{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Yl extends Kl{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ql extends Kl{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Xl(e){return ql(e)&&"AuthRetryableFetchError"===e.name}class Zl extends Kl{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class ec extends Kl{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const tc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),sc=" \t\n\r=".split(""),rc=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<sc.length;t+=1)e[sc[t].charCodeAt(0)]=-2;for(let t=0;t<tc.length;t+=1)e[tc[t].charCodeAt(0)]=t;return e})();function nc(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(tc[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(tc[e]),t.queuedBits-=6}}function ic(e,t,s){const r=rc[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function ac(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let a=0;a<e.length;a+=1)ic(e.charCodeAt(a),n,i);return t.join("")}function oc(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function lc(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let n=0;n<e.length;n+=1)ic(e.charCodeAt(n),s,r);return new Uint8Array(t)}function cc(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}oc(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function uc(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>nc(e,s,r)),nc(null,s,r),t.join("")}const dc=()=>"undefined"!=typeof window&&"undefined"!=typeof document,hc={tested:!1,writable:!1},fc=()=>{if(!dc())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(cp){return!1}if(hc.tested)return hc.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),hc.tested=!0,hc.writable=!0}catch(cp){hc.tested=!0,hc.writable=!1}return hc.writable};const pc=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),vc=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},gc=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(r){return s}},yc=async(e,t)=>{await e.removeItem(t)};class mc{constructor(){this.promise=new mc.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function _c(e){const t=e.split(".");if(3!==t.length)throw new ec("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!Fl.test(t[s]))throw new ec("JWT not in base64url format");return{header:JSON.parse(ac(t[0])),payload:JSON.parse(ac(t[1])),signature:lc(t[2]),raw:{header:t[0],payload:t[1]}}}function bc(e){return("0"+e.toString(16)).substr(-2)}async function wc(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function kc(e,t,s=!1){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,bc).join("")}();let n=r;s&&(n+="/PASSWORD_RECOVERY"),await vc(e,`${t}-code-verifier`,n);const i=await wc(r);return[i,r===i?"plain":"s256"]}mc.promiseConstructor=Promise;const Sc=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Ec=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Oc(e){if(!Ec.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Tc(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Cc(e){return JSON.parse(JSON.stringify(e))}const Ac=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),jc=[502,503,504];async function xc(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Ql(Ac(e),0);if(jc.includes(e.status))throw new Ql(Ac(e),e.status);let r,n;try{r=await e.json()}catch(cp){throw new Wl(Ac(cp),cp)}const i=function(e){const t=e.headers.get(Dl);if(!t)return null;if(!t.match(Sc))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(cp){return null}}(e);if(i&&i.getTime()>=Bl.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?n=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(n=r.error_code),n){if("weak_password"===n)throw new Zl(Ac(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new zl}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new Zl(Ac(r),e.status,r.weak_password.reasons);throw new Vl(Ac(r),e.status||500,n)}async function Rc(e,t,s,r){var n;const i=Object.assign({},null==r?void 0:r.headers);i[Dl]||(i[Dl]=Bl.name),(null==r?void 0:r.jwt)&&(i.Authorization=`Bearer ${r.jwt}`);const a=null!==(n=null==r?void 0:r.query)&&void 0!==n?n:{};(null==r?void 0:r.redirectTo)&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await async function(e,t,s,r,n,i){const a=((e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),s))})(t,r,n,i);let o;try{o=await e(s,Object.assign({},a))}catch(cp){throw console.error(cp),new Ql(Ac(cp),0)}o.ok||await xc(o);if(null==r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(cp){await xc(cp)}}(e,t,s+o,{headers:i,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function Pc(e){var t;let s=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Ic(e){const t=Pc(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function $c(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Nc(e){return{data:e,error:null}}function Uc(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i}=e,a=hi(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i},user:Object.assign({},a)},error:null}}function Lc(e){return e}const Dc=["global","local","others"];class Bc{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=pc(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Dc[0]){if(Dc.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Dc.join(", ")}`);try{return await Rc(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(ql(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Rc(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:$c})}catch(s){if(ql(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=hi(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await Rc(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:Uc,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(ql(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Rc(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:$c})}catch(t){if(ql(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,n,i,a,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Rc(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(n=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==n?n:""},xform:Lc});if(c.error)throw c.error;const u=await c.json(),d=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(o=null===(a=c.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(ql(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Oc(e);try{return await Rc(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:$c})}catch(t){if(ql(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Oc(e);try{return await Rc(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:$c})}catch(s){if(ql(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){Oc(e);try{return await Rc(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:$c})}catch(s){if(ql(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Oc(e.userId);try{const{data:t,error:s}=await Rc(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(ql(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Oc(e.userId),Oc(e.id);try{return{data:await Rc(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ql(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,r,n,i,a,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Rc(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(n=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==n?n:""},xform:Lc});if(c.error)throw c.error;const u=await c.json(),d=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(o=null===(a=c.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(ql(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await Rc(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(ql(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await Rc(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(ql(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await Rc(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(s){if(ql(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await Rc(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(ql(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await Rc(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(ql(t))return{data:null,error:t};throw t}}}function Fc(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Mc=!!(globalThis&&fc()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class qc extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Vc extends qc{}async function Wc(e,t,s){Mc&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Mc&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw Mc&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Vc(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Mc)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(cp){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",cp)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}Mc&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await s()}finally{Mc&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))}function Kc(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function zc(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class Hc extends Error{constructor({message:e,code:t,cause:s,name:r}){var n;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=null!==(n=null!=r?r:s instanceof Error?s.name:void 0)&&void 0!==n?n:"Unknown Error",this.code=t}}class Jc extends Hc{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Gc({error:e,options:t}){var s,r,n;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Hc({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.requireResidentKey))return new Hc({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.userVerification))return new Hc({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(n=i.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new Hc({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new Hc({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new Hc({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name){return 0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new Hc({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Hc({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e})}if("SecurityError"===e.name){const t=window.location.hostname;if(!su(t))return new Hc({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new Hc({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Hc({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new Hc({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Hc({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Yc({error:e,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Hc({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new Hc({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!su(t))return new Hc({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(s.rpId!==t)return new Hc({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new Hc({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Hc({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}const Qc=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Xc(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:s,excludeCredentials:r}=e,n=hi(e,["challenge","user","excludeCredentials"]),i=lc(t).buffer,a=Object.assign(Object.assign({},s),{id:lc(s.id).buffer}),o=Object.assign(Object.assign({},n),{challenge:i,user:a});if(r&&r.length>0){o.excludeCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:lc(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}function Zc(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:s}=e,r=hi(e,["challenge","allowCredentials"]),n=lc(t).buffer,i=Object.assign(Object.assign({},r),{challenge:n});if(s&&s.length>0){i.allowCredentials=new Array(s.length);for(let e=0;e<s.length;e++){const t=s[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:lc(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}function eu(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e;return{id:e.id,rawId:e.id,response:{attestationObject:uc(new Uint8Array(e.response.attestationObject)),clientDataJSON:uc(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function tu(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e,r=e.getClientExtensionResults(),n=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:uc(new Uint8Array(n.authenticatorData)),clientDataJSON:uc(new Uint8Array(n.clientDataJSON)),signature:uc(new Uint8Array(n.signature)),userHandle:n.userHandle?uc(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function su(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function ru(){var e,t;return!!(dc()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const nu={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},iu={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function au(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),s=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),r={};for(const n of e)if(n)for(const e in n){const i=n[e];if(void 0!==i)if(Array.isArray(i))r[e]=i;else if(s(i))r[e]=i;else if(t(i)){const s=r[e];t(s)?r[e]=au(s,i):r[e]=au(i)}else r[e]=i}return r}class ou{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:r},n){try{const{data:i,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!i)return{data:null,error:a};const o=null!=r?r:Qc.createNewAbortSignal();if("create"===i.webauthn.type){const{user:e}=i.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${s}`),e.displayName||(e.displayName=e.name)}switch(i.webauthn.type){case"create":{const t=function(e,t){return au(nu,e,t||{})}(i.webauthn.credential_options.publicKey,null==n?void 0:n.create),{data:s,error:r}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Jc("Browser returned unexpected credential type",t)}:{data:null,error:new Jc("Empty credential response",t)}}catch(t){return{data:null,error:Gc({error:t,options:e})}}}({publicKey:t,signal:o});return s?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:s}},error:null}:{data:null,error:r}}case"request":{const t=function(e,t){return au(iu,e,t||{})}(i.webauthn.credential_options.publicKey,null==n?void 0:n.request),{data:s,error:r}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Jc("Browser returned unexpected credential type",t)}:{data:null,error:new Jc("Empty credential response",t)}}catch(t){return{data:null,error:Yc({error:t,options:e})}}}(Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:t,signal:o}));return s?{data:{factorId:e,challengeId:i.id,webauthn:{type:i.webauthn.type,credential_response:s}},error:null}:{data:null,error:r}}}}catch(i){return ql(i)?{data:null,error:i}:{data:null,error:new Wl("Unexpected error in challenge",i)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r}={}},n){if(!t)return{data:null,error:new Ml("rpId is required for WebAuthn authentication")};try{if(!ru())return{data:null,error:new Wl("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:r},{request:n});if(!i)return{data:null,error:a};const{webauthn:o}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:o.type,rpId:t,rpOrigins:s,credential_response:o.credential_response}})}catch(i){return ql(i)?{data:null,error:i}:{data:null,error:new Wl("Unexpected error in authenticate",i)}}}async _register({friendlyName:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r}={}},n){if(!t)return{data:null,error:new Ml("rpId is required for WebAuthn registration")};try{if(!ru())return{data:null,error:new Wl("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var s;return null===(s=t.data)||void 0===s?void 0:s.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:a};const{data:o,error:l}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:r},{create:n});return o?this._verify({factorId:i.id,challengeId:o.challengeId,webauthn:{rpId:t,rpOrigins:s,type:o.webauthn.type,credential_response:o.webauthn.credential_response}}):{data:null,error:l}}catch(i){return ql(i)?{data:null,error:i}:{data:null,error:new Wl("Unexpected error in register",i)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(cp){"undefined"!=typeof self&&(self.globalThis=self)}}();const lu={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ll,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function cu(e,t,s){return await s()}const uu={};class du{get jwks(){var e,t;return null!==(t=null===(e=uu[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){uu[this.storageKey]=Object.assign(Object.assign({},uu[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=uu[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){uu[this.storageKey]=Object.assign(Object.assign({},uu[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const n=Object.assign(Object.assign({},lu),e);if(this.storageKey=n.storageKey,this.instanceID=null!==(t=du.nextInstanceID[this.storageKey])&&void 0!==t?t:0,du.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!n.debug,"function"==typeof n.debug&&(this.logger=n.debug),this.instanceID>0&&dc()){const e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=n.persistSession,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Bc({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=pc(n.fetch),this.lock=n.lock||cu,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,this.throwOnError=n.throwOnError,n.lock?this.lock=n.lock:dc()&&(null===(s=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===s?void 0:s.locks)?this.lock=Wc:this.lock=cu,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ou(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:fc()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Fc(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Fc(this.memoryStorage)),dc()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(cp){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",cp)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${$l}) ${(new Date).toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},s="none";if(dc()&&(t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(cp){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),dc()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:n}=await this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),function(e){return ql(e)&&"AuthImplicitGrantRedirectError"===e.name}(n)){const t=null===(e=n.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return await this._removeSession(),{error:n}}const{session:i,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ql(t)?this._returnResult({error:t}):this._returnResult({error:new Wl("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const n=await Rc(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:Pc}),{data:i,error:a}=n;if(a||!i)return this._returnResult({data:{user:null,session:null},error:a});const o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(n){if(ql(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signUp(e){var t,s,r;try{let n;if("email"in e){const{email:s,password:r,options:i}=e;let a=null,o=null;"pkce"===this.flowType&&([a,o]=await kc(this.storage,this.storageKey)),n=await Rc(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:a,code_challenge_method:o},xform:Pc})}else{if(!("phone"in e))throw new Jl("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:a}=e;n=await Rc(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(s=null==a?void 0:a.data)&&void 0!==s?s:{},channel:null!==(r=null==a?void 0:a.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:Pc})}}const{data:i,error:a}=n;if(a||!i)return this._returnResult({data:{user:null,session:null},error:a});const o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(n){if(ql(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:r,options:n}=e;t=await Rc(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Ic})}else{if(!("phone"in e))throw new Jl("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:n}=e;t=await Rc(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Ic})}}const{data:s,error:r}=t;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!s||!s.session||!s.user){const e=new Hl;return this._returnResult({data:{user:null,session:null},error:e})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r})}catch(t){if(ql(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,s,r,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,r,n,i,a,o,l,c,u,d;let h,f;if("message"in e)h=e.message,f=e.signature;else{const{chain:u,wallet:d,statement:p,options:v}=e;let g;if(dc())if("object"==typeof d)g=d;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");g=e.ethereum}else{if("object"!=typeof d||!(null==v?void 0:v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=d}const y=new URL(null!==(t=null==v?void 0:v.url)&&void 0!==t?t:window.location.href),m=await g.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!m||0===m.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const _=Kc(m[0]);let b=null===(s=null==v?void 0:v.signInWithEthereum)||void 0===s?void 0:s.chainId;if(!b){const e=await g.request({method:"eth_chainId"});b=parseInt(e,16)}h=function(e){var t;const{chainId:s,domain:r,expirationTime:n,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:l,resources:c,scheme:u,uri:d,version:h}=e;if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const f=`${u?`${u}://${r}`:r} wants you to sign in with your Ethereum account:\n${Kc(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let p=`URI: ${d}\nVersion: ${h}\nChain ID: ${s}${a?`\nNonce: ${a}`:""}\nIssued At: ${i.toISOString()}`;if(n&&(p+=`\nExpiration Time: ${n.toISOString()}`),o&&(p+=`\nNot Before: ${o.toISOString()}`),l&&(p+=`\nRequest ID: ${l}`),c){let e="\nResources:";for(const t of c){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}p+=e}return`${f}\n${p}`}({domain:y.host,address:_,statement:p,uri:y.href,version:"1",chainId:b,nonce:null===(r=null==v?void 0:v.signInWithEthereum)||void 0===r?void 0:r.nonce,issuedAt:null!==(i=null===(n=null==v?void 0:v.signInWithEthereum)||void 0===n?void 0:n.issuedAt)&&void 0!==i?i:new Date,expirationTime:null===(a=null==v?void 0:v.signInWithEthereum)||void 0===a?void 0:a.expirationTime,notBefore:null===(o=null==v?void 0:v.signInWithEthereum)||void 0===o?void 0:o.notBefore,requestId:null===(l=null==v?void 0:v.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null==v?void 0:v.signInWithEthereum)||void 0===c?void 0:c.resources}),f=await g.request({method:"personal_sign",params:[zc(h),_]})}try{const{data:t,error:s}=await Rc(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:f},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:Pc});if(s)throw s;if(!t||!t.session||!t.user){const e=new Hl;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:s})}catch(p){if(ql(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(e){var t,s,r,n,i,a,o,l,c,u,d,h;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:d,wallet:h,statement:v,options:g}=e;let y;if(dc())if("object"==typeof h)y=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=e.solana}else{if("object"!=typeof h||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=h}const m=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href);if("signIn"in y&&y.signIn){const e=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==g?void 0:g.signInWithSolana),{version:"1",domain:m.host,uri:m.href}),v?{statement:v}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${m.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${m.href}`,`Issued At: ${null!==(r=null===(s=null==g?void 0:g.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(n=null==g?void 0:g.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...(null===(i=null==g?void 0:g.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...(null===(a=null==g?void 0:g.signInWithSolana)||void 0===a?void 0:a.chainId)?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...(null===(o=null==g?void 0:g.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...(null===(l=null==g?void 0:g.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==g?void 0:g.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...g.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await y.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:s}=await Rc(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:uc(p)},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Pc});if(s)throw s;if(!t||!t.session||!t.user){const e=new Hl;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:s})}catch(v){if(ql(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(e){const t=await gc(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:n}=await Rc(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Pc});if(await yc(this.storage,`${this.storageKey}-code-verifier`),n)throw n;if(!t||!t.session||!t.user){const e=new Hl;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:n})}catch(n){if(ql(n))return this._returnResult({data:{user:null,session:null,redirectType:null},error:n});throw n}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:n,nonce:i}=e,a=await Rc(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Pc}),{data:o,error:l}=a;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o||!o.session||!o.user){const e=new Hl;return this._returnResult({data:{user:null,session:null},error:e})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:o,error:l})}catch(t){if(ql(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,s,r,n,i;try{if("email"in e){const{email:r,options:n}=e;let i=null,a=null;"pkce"===this.flowType&&([i,a]=await kc(this.storage,this.storageKey));const{error:o}=await Rc(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(s=null==n?void 0:n.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:a},redirectTo:null==n?void 0:n.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){const{phone:t,options:s}=e,{data:a,error:o}=await Rc(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(n=null==s?void 0:s.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(i=null==s?void 0:s.channel)&&void 0!==i?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o})}throw new Jl("You must provide either an email or phone number.")}catch(a){if(ql(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,s;try{let r,n;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:i,error:a}=await Rc(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:r,xform:Pc});if(a)throw a;if(!i){throw new Error("An error occurred on token verification.")}const o=i.session,l=i.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(r){if(ql(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(e){var t,s,r,n,i;try{let a=null,o=null;"pkce"===this.flowType&&([a,o]=await kc(this.storage,this.storageKey));const l=await Rc(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:o}),headers:this.headers,xform:Nc});return(null===(n=l.data)||void 0===n?void 0:n.url)&&dc()&&!(null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(a){if(ql(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new zl;const{error:r}=await Rc(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(ql(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:n}=e,{error:i}=await Rc(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}if("phone"in e){const{phone:s,type:r,options:n}=e,{data:i,error:a}=await Rc(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:a})}throw new Jl("You must provide either an email or phone number and a type")}catch(t){if(ql(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(cp){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(cp){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await gc(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<Ul;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=await gc(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=Tc()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,s,r)=>{if("__isInsecureUserWarningProxy"===s)return!0;if("symbol"==typeof s){const t=s.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t||"Symbol(nodejs.util.inspect.custom)"===t)return Reflect.get(e,s,r)}return t.value||"string"!=typeof s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,s,r)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:r,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{session:null},error:n}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Rc(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$c}):await this._useSession(async e=>{var t,s,r;const{data:n,error:i}=e;if(i)throw i;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Rc(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=n.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:$c}):{data:{user:null},error:new zl}})}catch(t){if(ql(t))return function(e){return ql(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await yc(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:n}=s;if(n)throw n;if(!r.session)throw new zl;const i=r.session;let a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await kc(this.storage,this.storageKey));const{data:l,error:c}=await Rc(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:i.access_token,xform:$c});if(c)throw c;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(s){if(ql(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new zl;const t=Date.now()/1e3;let s=t,r=!0,n=null;const{payload:i}=_c(e.access_token);if(i.exp&&(s=i.exp,r=s<=t),r){const{data:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:r,error:i}=await this._getUser(e.access_token);if(i)throw i;n={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return this._returnResult({data:{user:n.user,session:n},error:null})}catch(t){if(ql(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:r,error:n}=t;if(n)throw n;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new zl;const{data:r,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{user:null,session:null},error:n}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(ql(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!dc())throw new Gl("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Gl(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Yl("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Gl("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Yl("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:n,refresh_token:i,expires_in:a,expires_at:o,token_type:l}=e;if(!(n&&a&&i&&l))throw new Gl("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(a);let d=c+u;o&&(d=parseInt(o));const h=d-c;1e3*h<=Nl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${u}s`);const f=d-u;c-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,d,c):c-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,d,c);const{data:p,error:v}=await this._getUser(n);if(v)throw v;const g={provider_token:s,provider_refresh_token:r,access_token:n,expires_in:u,expires_at:d,refresh_token:i,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(s){if(ql(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await gc(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:n}=t;if(n)return this._returnResult({error:n});const i=null===(s=r.session)||void 0===s?void 0:s.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return ql(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await yc(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Symbol("auth-callback"),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:r},error:n}=t;if(n)throw n;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(n){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await kc(this.storage,this.storageKey,!0));try{return await Rc(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(ql(n))return this._returnResult({data:null,error:n});throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(t){if(ql(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:s,error:r}=await this._useSession(async t=>{var s,r,n,i,a;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await Rc(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(a=null===(i=o.session)||void 0===i?void 0:i.access_token)&&void 0!==a?a:void 0})});if(r)throw r;return dc()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),this._returnResult({data:{provider:e.provider,url:null==s?void 0:s.url},error:null})}catch(s){if(ql(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{const{error:r,data:{session:n}}=t;if(r)throw r;const{options:i,provider:a,token:o,access_token:l,nonce:c}=e,u=await Rc(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(s=null==n?void 0:n.access_token)&&void 0!==s?s:void 0,body:{provider:a,id_token:o,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Pc}),{data:d,error:h}=u;return h?this._returnResult({data:{user:null,session:null},error:h}):d&&d.session&&d.user?(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:h})):this._returnResult({data:{user:null,session:null},error:new Hl})}catch(r){if(ql(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:n,error:i}=t;if(i)throw i;return await Rc(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=n.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})})}catch(t){if(ql(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Rc(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Pc})),r=(e,t)=>{const s=200*Math.pow(2,e);return t&&Xl(t)&&Date.now()+s-n<Nl},new Promise((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{const t=await s(n);if(!r(n,null,t))return void e(t)}catch(cp){if(!r(n,cp))return void t(cp)}})()}))}catch(n){if(this._debug(t,"error",n),ql(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(t,"end")}var s,r}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),dc()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await gc(this.storage,this.storageKey);if(n&&this.userStorage){let t=await gc(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:n.user},await vc(this.userStorage,this.storageKey+"-user",t)),n.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:Tc()}else if(n&&!n.user&&!n.user){const e=await gc(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(n.user=e.user,await yc(this.storage,this.storageKey+"-user"),await vc(this.storage,this.storageKey,n)):n.user=Tc()}if(this._debug(s,"session from storage",n),!this._isValidSession(n))return this._debug(s,"session is not valid"),void(null!==n&&await this._removeSession());const i=1e3*(null!==(t=n.expires_at)&&void 0!==t?t:1/0)-Date.now()<Ul;if(this._debug(s,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=await this._callRefreshToken(n.refresh_token);e&&(console.error(e),Xl(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(n.user&&!0===n.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(n.access_token);!t&&(null==e?void 0:e.user)?(n.user=e.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){return this._debug(s,"error",n),void console.error(n)}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new zl;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new mc;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new zl;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={data:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(n){if(this._debug(r,"error",n),ql(n)){const e={data:null,error:n};return Xl(n)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],n=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,t)}catch(cp){r.push(cp)}});if(await Promise.all(n),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&await vc(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=Cc(e);await vc(this.storage,this.storageKey,r)}else{const e=Cc(t);await vc(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await yc(this.storage,this.storageKey),await yc(this.storage,this.storageKey+"-code-verifier"),await yc(this.storage,this.storageKey+"-user"),this.userStorage&&await yc(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&dc()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(cp){console.error("removing visibilitychange callback failed",cp)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Nl);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-e)/Nl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)})}catch(cp){console.error("Auto refresh tick failed with error. This is likely a transient error.",cp)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(cp){if(!(cp.isAcquireTimeout||cp instanceof qc))throw cp;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!dc()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await kc(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:n}=t;return n?this._returnResult({data:null,error:n}):await Rc(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})})}catch(t){if(ql(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await Rc(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:null===(s=null==n?void 0:n.session)||void 0===s?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===o.type&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),this._returnResult({data:o,error:null}))})}catch(t){if(ql(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:n}=t;if(n)return this._returnResult({data:null,error:n});const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?eu(e.webauthn.credential_response):tu(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:o}=await Rc(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return o?this._returnResult({data:null,error:o}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:o}))})}catch(t){if(ql(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:n}=t;if(n)return this._returnResult({data:null,error:n});const i=await Rc(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});if(i.error)return i;const{data:a}=i;if("webauthn"!==a.type)return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Xc(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Zc(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(ql(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const r={all:[],phone:[],totp:[],webauthn:[]};for(const n of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])r.all.push(n),"verified"===n.status&&r[n.factor_type].push(n);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:s},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=_c(s.access_token);let i=null;n.aal&&(i=n.aal);let a=i;(null!==(t=null===(e=s.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==t?t:[]).length>0&&(a="aal2");return{data:{currentLevel:i,nextLevel:a,currentAuthenticationMethods:n.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:s},error:r}=t;return r?this._returnResult({data:null,error:r}):s?await Rc(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new zl})})}catch(t){if(ql(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:r},error:n}=s;if(n)return this._returnResult({data:null,error:n});if(!r)return this._returnResult({data:null,error:new zl});const i=await Rc(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&dc()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(s){if(ql(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:r},error:n}=s;if(n)return this._returnResult({data:null,error:n});if(!r)return this._returnResult({data:null,error:new zl});const i=await Rc(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&dc()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(s){if(ql(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;return s?this._returnResult({data:null,error:s}):t?await Rc(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new zl})})}catch(e){if(ql(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:s},error:r}=t;return r?this._returnResult({data:null,error:r}):s?(await Rc(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new zl})})}catch(t){if(ql(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>r)return s;const{data:n,error:i}=await Rc(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=r,s=n.keys.find(t=>t.kid===e),s||null):null}async getClaims(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});s=e.session.access_token}const{header:r,payload:n,signature:i,raw:{header:a,payload:o}}=_c(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(n.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:n,header:r,signature:i},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),u=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(await crypto.subtle.verify(c,u,i,cc(`${a}.${o}`))))throw new ec("Invalid JWT signature");return{data:{claims:n,header:r,signature:i},error:null}}catch(s){if(ql(s))return this._returnResult({data:null,error:s});throw s}}}du.nextInstanceID={};const hu=du;class fu extends hu{constructor(e){super(e)}}class pu{constructor(e,t,s){var r,n,i;this.supabaseUrl=e,this.supabaseKey=t;const a=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((s=t).endsWith("/")?s:s+"/")}catch(r){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var s}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const o=`sb-${a.hostname.split(".")[0]}-auth-token`,l=function(e,t){var s,r;const{db:n,auth:i,realtime:a,global:o}=e,{db:l,auth:c,realtime:u,global:d}=t,h={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),a),storage:{},global:Object.assign(Object.assign(Object.assign({},d),o),{headers:Object.assign(Object.assign({},null!==(s=null==d?void 0:d.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:async()=>""};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:xl,realtime:Pl,auth:Object.assign(Object.assign({},Rl),{storageKey:o}),global:jl});this.storageKey=null!==(r=l.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(n=l.global.headers)&&void 0!==n?n:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=l.auth)&&void 0!==i?i:{},this.headers,l.global.fetch),this.fetch=Il(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new Na(new URL("rest/v1",a).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new Cl(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Zi(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:s}=await this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:n,storageKey:i,flowType:a,lock:o,debug:l,throwOnError:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new fu({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:n,flowType:a,lock:o,debug:l,throwOnError:c,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Ro(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=s,this.realtime.setAuth(s))}}(function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const vu=new pu("https://qcdcdzfanrlvdcagmwmg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjZGNkemZhbnJsdmRjYWdtd21nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MDc4MjYsImV4cCI6MjA2OTQ4MzgyNn0.ahntO4OGSBfR2vnP_gMxfaRggP4eD5mejzq5sZegmME",{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1},realtime:{params:{eventsPerSecond:10}}});console.log(" Supabase client initialized for Staff Dashboard");const gu=bt([]),yu=bt(!1),mu=async(e,t,s,r)=>{try{const{data:n,error:i}=await vu.from("activity_responses").update({status:"completed",completed_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(i)throw i;return await vu.from("activity_history").insert({student_email:t,activity_id:s,action:"marked_complete",triggered_by:"staff",triggered_by_email:r,metadata:{note:"Staff override - marked complete"}}),console.log(" Activity marked complete by staff:",e),n}catch(n){throw console.error("Failed to mark activity complete:",n),n}},_u=async(e,t,s,r)=>{try{const{data:n,error:i}=await vu.from("activity_responses").update({status:"in_progress",completed_at:null,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(i)throw i;return await vu.from("activity_history").insert({student_email:t,activity_id:s,action:"marked_incomplete",triggered_by:"staff",triggered_by_email:r,metadata:{note:"Staff override - marked incomplete"}}),console.log(" Activity marked incomplete by staff:",e),n}catch(n){throw console.error("Failed to mark activity incomplete:",n),n}};function bu(){return{allActivities:gu,isLoadingActivities:yu,loadAllActivities:async()=>{if(gu.value.length>0)return gu.value;yu.value=!0;try{const{data:e,error:t}=await vu.from("activities").select("*").eq("is_active",!0).order("vespa_category, level, display_order");if(t)throw t;return gu.value=e||[],console.log(` Loaded ${gu.value.length} activities`),gu.value}catch(e){throw console.error("Failed to load activities:",e),e}finally{yu.value=!1}},assignActivity:async(e,t,s,r=1,n)=>{try{console.log(" Assigning activity:",{studentEmail:e,activityId:t,staffEmail:s,schoolId:n,cycleNumber:r});const{data:i,error:a}=await vu.rpc("assign_activity_to_student",{p_student_email:e,p_activity_id:t,p_staff_email:s,p_school_id:n,p_cycle_number:r});if(a)throw console.error(" RPC Error:",a),a;return console.log(" Activity assigned successfully:",i),i}catch(i){throw console.error(" Failed to assign activity:",i),i}},bulkAssignActivities:async(e,t,s,r,n=1)=>{try{console.log(" Bulk assigning:",{studentEmails:e,activityIds:t,staffEmail:s,schoolId:r});const{data:i,error:a}=await vu.rpc("bulk_assign_activities",{p_student_emails:e,p_activity_ids:t,p_staff_email:s,p_school_id:r,p_cycle_number:n});if(a)throw console.error(" Bulk RPC Error:",a),a;return console.log(` Bulk assigned ${t.length} activities to ${e.length} students (${i} total assignments)`),i}catch(i){throw console.error(" Failed to bulk assign:",i),i}},removeActivity:async(e,t,s,r)=>{try{const{error:n}=await vu.from("activity_responses").update({status:"removed",updated_at:(new Date).toISOString()}).eq("student_email",e).eq("activity_id",t).eq("cycle_number",s);if(n)throw n;await vu.from("activity_history").insert({student_email:e,activity_id:t,action:"removed",triggered_by:"staff",triggered_by_email:r,cycle_number:s}),console.log(" Activity removed:",{studentEmail:e,activityId:t})}catch(n){throw console.error("Failed to remove activity:",n),n}},loadActivityQuestions:async e=>{try{const{data:t,error:s}=await vu.from("activity_questions").select("*").eq("activity_id",e).eq("is_active",!0).order("display_order");if(s)throw s;return t||[]}catch(t){return console.error("Failed to load questions:",t),[]}},getActivitiesByCategory:()=>{const e={};return["Vision","Effort","Systems","Practice","Attitude"].forEach(t=>{e[t]=gu.value.filter(e=>e.vespa_category===t)}),e},filterActivities:(e={})=>{let t=gu.value;if(e.search){const s=e.search.toLowerCase();t=t.filter(e=>{var t;return e.name.toLowerCase().includes(s)||(null==(t=e.curriculum_tags)?void 0:t.some(e=>e.toLowerCase().includes(s)))})}return e.category&&"all"!==e.category&&(t=t.filter(t=>t.vespa_category===e.category)),e.level&&"all"!==e.level&&(t=t.filter(t=>t.level===e.level)),t},markActivityComplete:mu,markActivityIncomplete:_u}}const wu=bt(!0),ku=bt(null),Su=bt(null),Eu=bt(!1),Ou=bt(null);function Tu(){return{isAuthenticated:wu,isLoading:Eu,error:Ou,staffContext:ku,currentUser:Su,checkAuth:async()=>{var e,t,s,r,n,i,a;try{const o=Knack.session.user,l=o.email||(null==(t=null==(e=o.values)?void 0:e.field_70)?void 0:t.email)||(null==(r=null==(s=o.values)?void 0:s.email)?void 0:r.email);console.log(" Logged in as:",l);const c=o.profile_keys||[],u=[];c.includes("profile_5")&&u.push("staff_admin"),c.includes("profile_7")&&u.push("tutor"),c.includes("profile_18")&&u.push("head_of_year"),c.includes("profile_78")&&u.push("subject_teacher");const d=c.includes("profile_21")||"tony@vespa.academy"===l;console.log(" Calling auth check endpoint...");const h=await fetch(`https://vespa-upload-api-07e11c285370.herokuapp.com/api/v3/accounts/auth/check?userEmail=${encodeURIComponent(l)}&userId=${o.id}`);if(!h.ok)throw new Error(`Auth check failed: ${h.status}`);const f=await h.json();if(!f.success)throw new Error("Auth check returned unsuccessful");console.log(" Auth check response:",f),Su.value={email:l,userId:o.id,profiles:u,isSuperUser:f.isSuperUser||d},ku.value={schoolId:(null==(n=f.schoolContext)?void 0:n.schoolId)||null,customerId:(null==(i=f.schoolContext)?void 0:i.customerId)||null,schoolName:(null==(a=f.schoolContext)?void 0:a.customerName)||"Unknown School",isSuperUser:f.isSuperUser||d,roles:u},wu.value=!0,console.log(" Ready to load data for:",l,"School:",ku.value.schoolName)}catch(o){throw console.error(" Error getting auth context:",o),wu.value=!1,o}},hasRole:e=>{var t,s,r;return(null==(s=null==(t=ku.value)?void 0:t.roles)?void 0:s.includes(e))||(null==(r=ku.value)?void 0:r.isSuperUser)},getStaffEmail:()=>{var e;return null==(e=Su.value)?void 0:e.email}}}const Cu=(e,t)=>{const s=e.__vccOpts||e;for(const[r,n]of t)s[r]=n;return s},Au={class:"modal"},ju={class:"modal-header"},xu={class:"modal-title"},Ru={class:"modal-body"},Pu={class:"selected-students-list"},Iu={class:"student-chips"},$u={class:"activity-filters"},Nu=["value"],Uu={key:0,class:"selection-summary"},Lu={key:1,class:"loading-state"},Du={key:2,class:"activities-grid"},Bu=["onClick"],Fu=["checked","onChange"],Mu={class:"activity-info"},qu={class:"activity-name"},Vu={class:"activity-badges"},Wu={class:"level-badge"},Ku={key:0,class:"time-badge"},zu={key:3,class:"empty-state"},Hu={class:"modal-footer"},Ju=["disabled"],Gu=Cu({__name:"BulkAssignModal",props:{selectedStudents:{type:Array,required:!0},students:{type:Array,required:!0},staffContext:{type:Object,required:!0}},emits:["close","assigned"],setup(e,{emit:t}){const s=e,r=t,{allActivities:n,isLoadingActivities:i,loadAllActivities:a,bulkAssignActivities:o}=bu(),{getStaffEmail:l}=Tu(),c=bt(""),u=bt("all"),d=bt("all"),h=bt(new Set),f=bt(!1),p=["Vision","Effort","Systems","Practice","Attitude"],v=mn(()=>{let e=n.value;if(c.value){const t=c.value.toLowerCase();e=e.filter(e=>{var s;return e.name.toLowerCase().includes(t)||(null==(s=e.curriculum_tags)?void 0:s.some(e=>e.toLowerCase().includes(t)))})}return"all"!==u.value&&(e=e.filter(e=>e.vespa_category===u.value)),"all"!==d.value&&(e=e.filter(e=>e.level===d.value)),e});vs(async()=>{await a()});const g=e=>{h.value.has(e)?h.value.delete(e):h.value.add(e)},y=()=>{h.value.clear()},m=async()=>{if(0!==h.value.size&&confirm(`Assign ${h.value.size} activities to ${s.selectedStudents.length} students?`)){f.value=!0;try{const e=l(),t=Array.from(h.value),n=s.selectedStudents.map(e=>{const t=s.students.find(t=>t.id===e);return null==t?void 0:t.email}).filter(Boolean);await o(n,t,e,s.staffContext.schoolId),alert(`Successfully assigned ${t.length} activities to ${n.length} students!`),r("assigned")}catch(e){console.error("Failed to bulk assign:",e),alert("Failed to assign activities. Please try again.")}finally{f.value=!1}}};return(t,r)=>(Lr(),Mr("div",{class:"modal-overlay",onClick:r[6]||(r[6]=ii(e=>t.$emit("close"),["self"]))},[Hr("div",Au,[Hr("div",ju,[Hr("h3",xu,[r[7]||(r[7]=Hr("i",{class:"fas fa-users"},null,-1)),Yr(" Bulk Assign Activities to "+Y(e.selectedStudents.length)+" Student"+Y(1!==e.selectedStudents.length?"s":""),1)]),Hr("button",{class:"modal-close",onClick:r[0]||(r[0]=e=>t.$emit("close"))},[...r[8]||(r[8]=[Hr("i",{class:"fas fa-times"},null,-1)])])]),Hr("div",Ru,[Hr("div",Pu,[r[9]||(r[9]=Hr("h4",null,"Selected Students:",-1)),Hr("div",Iu,[(Lr(!0),Mr(Rr,null,Os(e.selectedStudents,e=>(Lr(),Mr("span",{key:e,class:"student-chip"},Y((e=>{const t=s.students.find(t=>t.id===e);return(null==t?void 0:t.full_name)||"Unknown Student"})(e)),1))),128))])]),Hr("div",$u,[Qt(Hr("input",{type:"search","onUpdate:modelValue":r[1]||(r[1]=e=>c.value=e),placeholder:"Search activities...",class:"search-input"},null,512),[[Zn,c.value]]),Qt(Hr("select",{"onUpdate:modelValue":r[2]||(r[2]=e=>u.value=e),class:"filter-select"},[r[10]||(r[10]=Hr("option",{value:"all"},"All Categories",-1)),(Lr(),Mr(Rr,null,Os(p,e=>Hr("option",{key:e,value:e},Y(e),9,Nu)),64))],512),[[ei,u.value]]),Qt(Hr("select",{"onUpdate:modelValue":r[3]||(r[3]=e=>d.value=e),class:"filter-select"},[...r[11]||(r[11]=[Hr("option",{value:"all"},"All Levels",-1),Hr("option",{value:"Level 2"},"Level 2",-1),Hr("option",{value:"Level 3"},"Level 3",-1)])],512),[[ei,d.value]])]),h.value.size>0?(Lr(),Mr("div",Uu,[Hr("span",null,[r[12]||(r[12]=Hr("i",{class:"fas fa-check-circle"},null,-1)),Yr(" "+Y(h.value.size)+" activity(ies) selected ",1)]),Hr("button",{class:"btn btn-sm btn-secondary",onClick:y}," Clear Selection ")])):Xr("",!0),kt(i)?(Lr(),Mr("div",Lu,[...r[13]||(r[13]=[Hr("div",{class:"spinner"},null,-1),Hr("p",null,"Loading activities...",-1)])])):(Lr(),Mr("div",Du,[(Lr(!0),Mr(Rr,null,Os(v.value,e=>(Lr(),Mr("div",{key:e.id,class:W(["activity-item",{selected:h.value.has(e.id)}]),onClick:t=>g(e.id)},[Hr("input",{type:"checkbox",checked:h.value.has(e.id),onClick:r[4]||(r[4]=ii(()=>{},["stop"])),onChange:t=>g(e.id)},null,40,Fu),Hr("div",Mu,[Hr("h4",qu,Y(e.name),1),Hr("div",Vu,[Hr("span",{class:W(["category-badge",e.vespa_category.toLowerCase()])},Y(e.vespa_category),3),Hr("span",Wu,Y(e.level),1),e.time_minutes?(Lr(),Mr("span",Ku,[r[14]||(r[14]=Hr("i",{class:"fas fa-clock"},null,-1)),Yr(" "+Y(e.time_minutes)+"m ",1)])):Xr("",!0)])])],10,Bu))),128))])),kt(i)||0!==v.value.length?Xr("",!0):(Lr(),Mr("div",zu,[...r[15]||(r[15]=[Hr("i",{class:"fas fa-search empty-icon"},null,-1),Hr("p",null,"No activities found matching your filters",-1)])]))]),Hr("div",Hu,[Hr("button",{class:"btn btn-secondary",onClick:r[5]||(r[5]=e=>t.$emit("close"))}," Cancel "),Hr("button",{class:"btn btn-primary",onClick:m,disabled:0===h.value.size||f.value},[r[16]||(r[16]=Hr("i",{class:"fas fa-check"},null,-1)),Yr(" "+Y(f.value?"Assigning...":`Assign to ${e.selectedStudents.length} Students`),1)],8,Ju)])])]))}},[["__scopeId","data-v-49ece9f3"]]),Yu={class:"student-list-view"},Qu={class:"dashboard-header"},Xu={class:"header-top"},Zu={class:"header-actions"},ed={class:"header-info"},td={class:"info-badge"},sd={class:"info-badge"},rd={class:"info-badge"},nd={class:"filter-bar"},id={class:"search-box"},ad=["value"],od={class:"display-toggle"},ld={key:0,class:"bulk-toolbar"},cd={class:"selection-count"},ud={key:1,class:"loading-overlay"},dd={key:2,class:"table-container"},hd={class:"students-table"},fd={style:{width:"40px"}},pd=["checked"],vd={class:"vespa-column-header"},gd={class:"category-letter"},yd={class:"category-name"},md=["checked","onChange"],_d={class:"student-info-cell"},bd={class:"student-name"},wd={class:"student-email"},kd={class:"student-meta"},Sd={key:0,class:"meta-badge"},Ed={key:1,class:"meta-badge"},Od=["title"],Td={style:{"text-align":"center"}},Cd=["onClick"],Ad={class:"activity-ratio"},jd={key:0,class:"pagination"},xd=["disabled"],Rd={class:"pagination-info"},Pd=["disabled"],Id={key:3,class:"empty-state"},$d=Cu({__name:"StudentListView",props:{students:{type:Array,required:!0},isLoading:{type:Boolean,default:!1},staffContext:{type:Object,required:!0}},emits:["view-student","refresh"],setup(e,{emit:t}){const s=e,r=t,n=bt(""),i=bt("all"),a=bt("all"),o=bt("activities"),l=bt(new Set),c=bt(!1),u=bt("name"),d=bt("asc"),h=bt(1),f=["Vision","Effort","Systems","Practice","Attitude"],p=mn(()=>{const e=new Set(s.students.map(e=>e.current_year_group).filter(Boolean));return Array.from(e).sort()}),v=mn(()=>{let e=s.students;if(n.value){const t=n.value.toLowerCase();e=e.filter(e=>{var s,r,n;return(null==(s=e.full_name)?void 0:s.toLowerCase().includes(t))||(null==(r=e.email)?void 0:r.toLowerCase().includes(t))||(null==(n=e.student_group)?void 0:n.toLowerCase().includes(t))})}return"all"!==i.value&&(e=e.filter(e=>e.current_year_group===i.value)),"all"!==a.value&&(e=e.filter(e=>"not-started"===a.value?0===e.progress:"in-progress"===a.value?e.progress>0&&e.progress<100:"completed"!==a.value||100===e.progress)),e.sort((e,t)=>{var s,r;let n,i;"name"===u.value?(n=(null==(s=e.full_name)?void 0:s.toLowerCase())||"",i=(null==(r=t.full_name)?void 0:r.toLowerCase())||""):"progress"===u.value&&(n=e.progress,i=t.progress);const a=n>i?1:-1;return"asc"===d.value?a:-a}),e}),g=mn(()=>{const e=50*(h.value-1),t=e+50;return v.value.slice(e,t)}),y=mn(()=>Math.ceil(v.value.length/50)),m=mn(()=>{if(0===v.value.length)return 0;const e=v.value.reduce((e,t)=>e+t.progress,0);return Math.round(e/v.value.length)}),_=mn(()=>g.value.length>0&&g.value.every(e=>l.value.has(e.id))),b=mn(()=>"asc"===d.value?"fas fa-sort-up":"fas fa-sort-down"),w=e=>{e.target.checked?g.value.forEach(e=>l.value.add(e.id)):g.value.forEach(e=>l.value.delete(e.id))},k=()=>{l.value.clear()},S=()=>{n.value="",i.value="all",a.value="all",h.value=1},E=()=>{0!==l.value.size?c.value=!0:alert("Please select at least one student")},O=()=>{c.value=!1,k(),r("refresh")},T=(e,t)=>{var s;const r=t.toLowerCase(),n=null==(s=e.latest_vespa_scores)?void 0:s[r];return n?Math.round(n):0},C=(e,t)=>{var s,r,n;return(null==(n=null==(r=null==(s=e.categoryBreakdown)?void 0:s[t.toLowerCase()])?void 0:r.prescribed)?void 0:n.length)||0},A=(e,t)=>{var s,r,n;return(null==(n=null==(r=null==(s=e.categoryBreakdown)?void 0:s[t.toLowerCase()])?void 0:r.completed)?void 0:n.length)||0},j=()=>{const e=[["Student Name","Email","Year Group","Group","Progress %","Prescribed","Completed","Vision","Effort","Systems","Practice","Attitude"],...v.value.map(e=>[e.full_name,e.email,e.current_year_group||"",e.student_group||"",e.progress,e.prescribedCount,e.completedCount,T(e,"Vision"),T(e,"Effort"),T(e,"Systems"),T(e,"Practice"),T(e,"Attitude")])].map(e=>e.join(",")).join("\n"),t=new Blob([e],{type:"text/csv"}),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=`vespa-progress-${(new Date).toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(s)};return Ys([n,i,a],()=>{h.value=1}),(t,s)=>(Lr(),Mr("div",Yu,[Hr("div",Qu,[Hr("div",Xu,[s[12]||(s[12]=Hr("h1",{class:"dashboard-title"},"VESPA Activities - Staff Dashboard",-1)),Hr("div",Zu,[Hr("button",{class:"btn btn-secondary",onClick:j},[...s[10]||(s[10]=[Hr("i",{class:"fas fa-download"},null,-1),Yr(" Export Report ",-1)])]),Hr("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=e=>t.$emit("refresh"))},[...s[11]||(s[11]=[Hr("i",{class:"fas fa-sync"},null,-1),Yr(" Refresh ",-1)])])])]),Hr("div",ed,[Hr("span",td,[s[13]||(s[13]=Hr("i",{class:"fas fa-school"},null,-1)),Yr(" "+Y(e.staffContext.schoolName),1)]),Hr("span",sd,[s[14]||(s[14]=Hr("i",{class:"fas fa-users"},null,-1)),Yr(" "+Y(v.value.length)+" Student"+Y(1!==v.value.length?"s":""),1)]),Hr("span",rd,[s[15]||(s[15]=Hr("i",{class:"fas fa-chart-line"},null,-1)),Yr(" Avg Progress: "+Y(m.value)+"% ",1)])])]),Hr("div",nd,[Hr("div",id,[s[16]||(s[16]=Hr("i",{class:"fas fa-search search-icon"},null,-1)),Qt(Hr("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=e=>n.value=e),placeholder:"Search students by name or email...",class:"search-input"},null,512),[[Zn,n.value]])]),Qt(Hr("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>i.value=e),class:"filter-select"},[s[17]||(s[17]=Hr("option",{value:"all"},"All Year Groups",-1)),(Lr(!0),Mr(Rr,null,Os(p.value,e=>(Lr(),Mr("option",{key:e,value:e},Y(e),9,ad))),128))],512),[[ei,i.value]]),Qt(Hr("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>a.value=e),class:"filter-select"},[...s[18]||(s[18]=[Hr("option",{value:"all"},"All Progress",-1),Hr("option",{value:"not-started"},"Not Started (0%)",-1),Hr("option",{value:"in-progress"},"In Progress (1-99%)",-1),Hr("option",{value:"completed"},"Completed (100%)",-1)])],512),[[ei,a.value]]),Hr("div",od,[Hr("button",{class:W(["toggle-btn",{active:"activities"===o.value}]),onClick:s[4]||(s[4]=e=>o.value="activities")},[...s[19]||(s[19]=[Hr("i",{class:"fas fa-tasks"},null,-1),Yr(" Activities ",-1)])],2),Hr("button",{class:W(["toggle-btn",{active:"scores"===o.value}]),onClick:s[5]||(s[5]=e=>o.value="scores")},[...s[20]||(s[20]=[Hr("i",{class:"fas fa-chart-bar"},null,-1),Yr(" Scores ",-1)])],2)]),Hr("button",{class:"btn btn-secondary",onClick:S},[...s[21]||(s[21]=[Hr("i",{class:"fas fa-times"},null,-1),Yr(" Clear ",-1)])])]),l.value.size>0?(Lr(),Mr("div",ld,[Hr("span",cd,Y(l.value.size)+" student"+Y(1!==l.value.size?"s":"")+" selected ",1),Hr("button",{class:"btn btn-primary",onClick:E},[...s[22]||(s[22]=[Hr("i",{class:"fas fa-plus-circle"},null,-1),Yr(" Assign Activities ",-1)])]),Hr("button",{class:"btn btn-secondary",onClick:k},[...s[23]||(s[23]=[Hr("i",{class:"fas fa-times"},null,-1),Yr(" Clear Selection ",-1)])])])):Xr("",!0),e.isLoading?(Lr(),Mr("div",ud,[...s[24]||(s[24]=[Hr("div",{class:"spinner"},null,-1)])])):v.value.length>0?(Lr(),Mr("div",dd,[Hr("table",hd,[Hr("thead",null,[Hr("tr",null,[Hr("th",fd,[Hr("input",{type:"checkbox",onChange:w,checked:_.value},null,40,pd)]),Hr("th",{onClick:s[6]||(s[6]=e=>{return t="name",void(u.value===t?d.value="asc"===d.value?"desc":"asc":(u.value=t,d.value="asc"));var t}),class:"sortable"},[s[25]||(s[25]=Yr(" Student Name ",-1)),"name"===u.value?(Lr(),Mr("i",{key:0,class:W(b.value)},null,2)):Xr("",!0)]),s[26]||(s[26]=Hr("th",{style:{width:"80px","text-align":"center"}},"View",-1)),(Lr(),Mr(Rr,null,Os(f,e=>Hr("th",{key:e,class:W(`vespa-column ${e.toLowerCase()}`)},[Hr("div",vd,[Hr("span",gd,Y(e[0]),1),Hr("span",yd,Y(e),1)])],2)),64))])]),Hr("tbody",null,[(Lr(!0),Mr(Rr,null,Os(g.value,e=>(Lr(),Mr("tr",{key:e.id,class:W({selected:l.value.has(e.id)})},[Hr("td",null,[Hr("input",{type:"checkbox",checked:l.value.has(e.id),onChange:t=>{return s=e.id,void(l.value.has(s)?l.value.delete(s):l.value.add(s));var s}},null,40,md)]),Hr("td",_d,[Hr("div",bd,Y(e.full_name),1),Hr("div",wd,Y(e.email),1),Hr("div",kd,[e.current_year_group?(Lr(),Mr("span",Sd,Y(e.current_year_group),1)):Xr("",!0),e.student_group?(Lr(),Mr("span",Ed,Y(e.student_group),1)):Xr("",!0)]),Hr("div",{class:"progress-bar-mini",title:`${e.completedCount}/${e.prescribedCount} completed`},[Hr("div",{class:"progress-fill",style:B({width:e.progress+"%"})},null,4)],8,Od)]),Hr("td",Td,[Hr("button",{class:"btn-view",onClick:s=>t.$emit("view-student",e.id),title:"View student workspace"},[...s[27]||(s[27]=[Hr("span",{class:"view-text"},"VIEW",-1),Hr("i",{class:"fas fa-arrow-right"},null,-1)])],8,Cd)]),(Lr(),Mr(Rr,null,Os(f,t=>Hr("td",{key:t,class:"vespa-data-cell"},["scores"===o.value?(Lr(),Mr("div",{key:0,class:W(["vespa-score-display",t.toLowerCase()])},Y(T(e,t)),3)):(Lr(),Mr("div",{key:1,class:W(["vespa-activity-display",t.toLowerCase()])},[Hr("span",Ad,Y(A(e,t))+"/"+Y(C(e,t)),1)],2))])),64))],2))),128))])]),y.value>1?(Lr(),Mr("div",jd,[Hr("button",{class:"btn btn-sm",onClick:s[7]||(s[7]=e=>h.value--),disabled:1===h.value},[...s[28]||(s[28]=[Hr("i",{class:"fas fa-chevron-left"},null,-1),Yr(" Previous ",-1)])],8,xd),Hr("span",Rd," Page "+Y(h.value)+" of "+Y(y.value)+" ("+Y(v.value.length)+" students) ",1),Hr("button",{class:"btn btn-sm",onClick:s[8]||(s[8]=e=>h.value++),disabled:h.value===y.value},[...s[29]||(s[29]=[Yr(" Next ",-1),Hr("i",{class:"fas fa-chevron-right"},null,-1)])],8,Pd)])):Xr("",!0)])):(Lr(),Mr("div",Id,[s[30]||(s[30]=Hr("i",{class:"fas fa-users empty-icon"},null,-1)),s[31]||(s[31]=Hr("h3",null,"No Students Found",-1)),Hr("p",null,Y(n.value?"Try adjusting your search or filters":"No students available"),1)])),c.value?(Lr(),qr(Gu,{key:4,"selected-students":Array.from(l.value),students:e.students,"staff-context":e.staffContext,onClose:s[9]||(s[9]=e=>c.value=!1),onAssigned:O},null,8,["selected-students","students","staff-context"])):Xr("",!0)]))}},[["__scopeId","data-v-8b82d2a0"]]),Nd={class:"card-indicators"},Ud={key:0,class:"source-indicator questionnaire",title:"Added via questionnaire"},Ld={key:1,class:"source-indicator staff",title:"Staff assigned"},Dd={key:2,class:"source-indicator student",title:"Student choice"},Bd={key:3,class:"feedback-indicator",title:"Unread feedback"},Fd={key:4,class:"completion-indicator",title:"Completed"},Md={class:"card-content"},qd={class:"activity-name"},Vd={class:"activity-meta"},Wd={class:"level-badge"},Kd={key:0,class:"time-badge"},zd={key:0,class:"completion-info"},Hd={key:1,class:"feedback-preview"},Jd={class:"feedback-text"},Gd=Cu({__name:"ActivityCard",props:{activity:{type:Object,required:!0},student:{type:Object,required:!0},isAssigned:{type:Boolean,default:!1}},emits:["click","remove"],setup(e){const t=e,s=mn(()=>!!t.activity.completed_at),r=mn(()=>t.activity.staff_feedback&&!t.activity.feedback_read_by_student),n=mn(()=>{var e,s;return(null==(s=null==(e=t.activity.activities)?void 0:e.vespa_category)?void 0:s.toLowerCase())||""}),i=mn(()=>{if(!t.activity.staff_feedback)return"";const e=t.activity.staff_feedback;return e.length>50?e.substring(0,50)+"...":e}),a=e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})};return(t,o)=>{var l,c,u;return Lr(),Mr("div",{class:W(["activity-card",n.value,{completed:s.value,"has-feedback":r.value}]),onClick:o[2]||(o[2]=e=>t.$emit("click"))},[Hr("div",Nd,["questionnaire"===e.activity.selected_via?(Lr(),Mr("span",Ud,[...o[3]||(o[3]=[Hr("i",{class:"fas fa-file-alt"},null,-1)])])):"staff_assigned"===e.activity.selected_via?(Lr(),Mr("span",Ld,[...o[4]||(o[4]=[Hr("i",{class:"fas fa-user-tie"},null,-1)])])):(Lr(),Mr("span",Dd,[...o[5]||(o[5]=[Hr("i",{class:"fas fa-user"},null,-1)])])),r.value?(Lr(),Mr("span",Bd,[...o[6]||(o[6]=[Hr("i",{class:"fas fa-comment-dots"},null,-1)])])):Xr("",!0),s.value?(Lr(),Mr("span",Fd,[...o[7]||(o[7]=[Hr("i",{class:"fas fa-check"},null,-1)])])):Xr("",!0)]),Hr("div",Md,[Hr("h4",qd,Y(null==(l=e.activity.activities)?void 0:l.name),1),Hr("div",Vd,[Hr("span",Wd,Y(null==(c=e.activity.activities)?void 0:c.level),1),(null==(u=e.activity.activities)?void 0:u.time_minutes)?(Lr(),Mr("span",Kd,[o[8]||(o[8]=Hr("i",{class:"fas fa-clock"},null,-1)),Yr(" "+Y(e.activity.activities.time_minutes)+"m ",1)])):Xr("",!0)]),s.value&&e.activity.completed_at?(Lr(),Mr("div",zd,[o[9]||(o[9]=Hr("i",{class:"fas fa-check-circle"},null,-1)),Yr(" Completed "+Y(a(e.activity.completed_at)),1)])):Xr("",!0),e.activity.staff_feedback?(Lr(),Mr("div",Hd,[o[10]||(o[10]=Hr("i",{class:"fas fa-comment"},null,-1)),Hr("span",Jd,Y(i.value),1)])):Xr("",!0)]),Hr("div",{class:"card-actions",onClick:o[1]||(o[1]=ii(()=>{},["stop"]))},[e.isAssigned?(Lr(),Mr("button",{key:0,class:"btn-action btn-remove",onClick:o[0]||(o[0]=e=>t.$emit("remove")),title:"Remove activity"},[...o[11]||(o[11]=[Hr("i",{class:"fas fa-times"},null,-1)])])):Xr("",!0)])],2)}}},[["__scopeId","data-v-475d298d"]]),Yd={class:"modal"},Qd={class:"modal-header"},Xd={class:"modal-title"},Zd={class:"modal-body"},eh={class:"activity-info-grid"},th={class:"info-card"},sh={class:"info-value"},rh={class:"info-card"},nh={class:"info-value"},ih={class:"info-card"},ah={class:"info-value"},oh={class:"info-card"},lh={class:"info-value"},ch={class:"content-preview"},uh={key:0,class:"content-section"},dh=["innerHTML"],hh={key:1,class:"content-section"},fh=["innerHTML"],ph={key:2,class:"empty-content"},vh={class:"modal-footer"},gh=Cu({__name:"ActivityPreviewModal",props:{activity:{type:Object,required:!0}},emits:["close"],setup:e=>(t,s)=>(Lr(),Mr("div",{class:"modal-overlay",onClick:s[2]||(s[2]=ii(e=>t.$emit("close"),["self"]))},[Hr("div",Yd,[Hr("div",Qd,[Hr("h3",Xd,Y(e.activity.name),1),Hr("button",{class:"modal-close",onClick:s[0]||(s[0]=e=>t.$emit("close"))},[...s[3]||(s[3]=[Hr("i",{class:"fas fa-times"},null,-1)])])]),Hr("div",Zd,[Hr("div",eh,[Hr("div",th,[s[5]||(s[5]=Hr("i",{class:"fas fa-tag info-icon"},null,-1)),Hr("div",null,[s[4]||(s[4]=Hr("div",{class:"info-label"},"Category",-1)),Hr("div",sh,Y(e.activity.vespa_category),1)])]),Hr("div",rh,[s[7]||(s[7]=Hr("i",{class:"fas fa-layer-group info-icon"},null,-1)),Hr("div",null,[s[6]||(s[6]=Hr("div",{class:"info-label"},"Level",-1)),Hr("div",nh,Y(e.activity.level),1)])]),Hr("div",ih,[s[9]||(s[9]=Hr("i",{class:"fas fa-clock info-icon"},null,-1)),Hr("div",null,[s[8]||(s[8]=Hr("div",{class:"info-label"},"Time",-1)),Hr("div",ah,Y(e.activity.time_minutes||20)+"min",1)])]),Hr("div",oh,[s[11]||(s[11]=Hr("i",{class:"fas fa-signal info-icon"},null,-1)),Hr("div",null,[s[10]||(s[10]=Hr("div",{class:"info-label"},"Difficulty",-1)),Hr("div",lh,Y(e.activity.difficulty||2)+"/3",1)])])]),Hr("div",ch,[e.activity.do_section_html?(Lr(),Mr("div",uh,[s[12]||(s[12]=Hr("h4",null,[Hr("i",{class:"fas fa-tasks"}),Yr(" DO")],-1)),Hr("div",{class:"html-content",innerHTML:e.activity.do_section_html},null,8,dh)])):Xr("",!0),e.activity.learn_section_html?(Lr(),Mr("div",hh,[s[13]||(s[13]=Hr("h4",null,[Hr("i",{class:"fas fa-graduation-cap"}),Yr(" LEARN")],-1)),Hr("div",{class:"html-content",innerHTML:e.activity.learn_section_html},null,8,fh)])):Xr("",!0),e.activity.do_section_html||e.activity.learn_section_html?Xr("",!0):(Lr(),Mr("div",ph,[...s[14]||(s[14]=[Hr("i",{class:"fas fa-file-alt empty-icon"},null,-1),Hr("p",null,"Activity content will be shown to students when they start this activity",-1)])]))])]),Hr("div",vh,[Hr("button",{class:"btn btn-secondary",onClick:s[1]||(s[1]=e=>t.$emit("close"))}," Close ")])])]))},[["__scopeId","data-v-40a2612e"]]),yh={class:"modal"},mh={class:"modal-header"},_h={class:"modal-title"},bh={class:"modal-body"},wh={class:"activity-filters"},kh=["value"],Sh={key:0,class:"selection-summary"},Eh={key:1,class:"loading-state"},Oh={key:2,class:"activities-grid"},Th=["onClick"],Ch=["checked","disabled","onChange"],Ah={class:"activity-info"},jh={class:"activity-name"},xh={class:"activity-badges"},Rh={class:"level-badge"},Ph={key:0,class:"time-badge"},Ih={key:1,class:"assigned-badge"},$h=["onClick"],Nh={key:3,class:"empty-state"},Uh={class:"modal-footer"},Lh=["disabled"],Dh=Cu({__name:"AssignModal",props:{student:{type:Object,required:!0},staffContext:{type:Object,required:!0}},emits:["close","assigned"],setup(e,{emit:t}){const s=e,r=t,{allActivities:n,isLoadingActivities:i,loadAllActivities:a,assignActivity:o}=bu(),{getStaffEmail:l}=Tu(),c=bt(""),u=bt("all"),d=bt("all"),h=bt(new Set),f=bt(!1),p=bt(null),v=["Vision","Effort","Systems","Practice","Attitude"],g=mn(()=>new Set((s.student.activity_responses||[]).filter(e=>"removed"!==e.status).map(e=>e.activity_id))),y=mn(()=>{let e=n.value;if(c.value){const t=c.value.toLowerCase();e=e.filter(e=>{var s;return e.name.toLowerCase().includes(t)||(null==(s=e.curriculum_tags)?void 0:s.some(e=>e.toLowerCase().includes(t)))})}return"all"!==u.value&&(e=e.filter(e=>e.vespa_category===u.value)),"all"!==d.value&&(e=e.filter(e=>e.level===d.value)),e});vs(async()=>{await a()});const m=e=>g.value.has(e),_=e=>{m(e)||(h.value.has(e)?h.value.delete(e):h.value.add(e))},b=()=>{h.value.clear()},w=()=>{c.value="",u.value="all",d.value="all"},k=async()=>{if(0!==h.value.size){f.value=!0;try{const e=l(),t=Array.from(h.value);for(const r of t)await o(s.student.email,r,e,s.student.current_cycle||1,s.staffContext.schoolId);alert(`Successfully assigned ${t.length} activity(ies) to ${s.student.full_name}`),r("assigned")}catch(e){console.error("Failed to assign activities:",e),alert("Failed to assign activities. Please try again.")}finally{f.value=!1}}};return(t,s)=>(Lr(),Mr("div",{class:"modal-overlay",onClick:s[7]||(s[7]=ii(e=>t.$emit("close"),["self"]))},[Hr("div",yh,[Hr("div",mh,[Hr("h3",_h,[s[8]||(s[8]=Hr("i",{class:"fas fa-plus-circle"},null,-1)),Yr(" Assign Activities to "+Y(e.student.full_name),1)]),Hr("button",{class:"modal-close",onClick:s[0]||(s[0]=e=>t.$emit("close"))},[...s[9]||(s[9]=[Hr("i",{class:"fas fa-times"},null,-1)])])]),Hr("div",bh,[Hr("div",wh,[Qt(Hr("input",{type:"search","onUpdate:modelValue":s[1]||(s[1]=e=>c.value=e),placeholder:"Search activities...",class:"search-input"},null,512),[[Zn,c.value]]),Qt(Hr("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>u.value=e),class:"filter-select"},[s[10]||(s[10]=Hr("option",{value:"all"},"All Categories",-1)),(Lr(),Mr(Rr,null,Os(v,e=>Hr("option",{key:e,value:e},Y(e),9,kh)),64))],512),[[ei,u.value]]),Qt(Hr("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>d.value=e),class:"filter-select"},[...s[11]||(s[11]=[Hr("option",{value:"all"},"All Levels",-1),Hr("option",{value:"Level 2"},"Level 2",-1),Hr("option",{value:"Level 3"},"Level 3",-1)])],512),[[ei,d.value]]),Hr("button",{class:"btn btn-sm btn-secondary",onClick:w},[...s[12]||(s[12]=[Hr("i",{class:"fas fa-times"},null,-1),Yr(" Clear ",-1)])])]),h.value.size>0?(Lr(),Mr("div",Sh,[Hr("span",null,Y(h.value.size)+" activity(ies) selected",1),Hr("button",{class:"btn btn-sm btn-secondary",onClick:b}," Clear Selection ")])):Xr("",!0),kt(i)?(Lr(),Mr("div",Eh,[...s[13]||(s[13]=[Hr("div",{class:"spinner"},null,-1),Hr("p",null,"Loading activities...",-1)])])):(Lr(),Mr("div",Oh,[(Lr(!0),Mr(Rr,null,Os(y.value,e=>(Lr(),Mr("div",{key:e.id,class:W(["activity-item",{selected:h.value.has(e.id),"already-assigned":m(e.id)}]),onClick:t=>_(e.id)},[Hr("input",{type:"checkbox",checked:h.value.has(e.id),disabled:m(e.id),onClick:s[4]||(s[4]=ii(()=>{},["stop"])),onChange:t=>_(e.id)},null,40,Ch),Hr("div",Ah,[Hr("h4",jh,Y(e.name),1),Hr("div",xh,[Hr("span",{class:W(["category-badge",e.vespa_category.toLowerCase()])},Y(e.vespa_category),3),Hr("span",Rh,Y(e.level),1),e.time_minutes?(Lr(),Mr("span",Ph,[s[14]||(s[14]=Hr("i",{class:"fas fa-clock"},null,-1)),Yr(" "+Y(e.time_minutes)+"m ",1)])):Xr("",!0),m(e.id)?(Lr(),Mr("span",Ih,[...s[15]||(s[15]=[Hr("i",{class:"fas fa-check"},null,-1),Yr(" Already Assigned ",-1)])])):Xr("",!0)])]),Hr("button",{class:"btn-preview",onClick:ii(t=>(e=>{p.value=e})(e),["stop"]),title:"Preview activity"},[...s[16]||(s[16]=[Hr("i",{class:"fas fa-eye"},null,-1)])],8,$h)],10,Th))),128))])),kt(i)||0!==y.value.length?Xr("",!0):(Lr(),Mr("div",Nh,[...s[17]||(s[17]=[Hr("i",{class:"fas fa-search empty-icon"},null,-1),Hr("p",null,"No activities found matching your filters",-1)])]))]),Hr("div",Uh,[Hr("button",{class:"btn btn-secondary",onClick:s[5]||(s[5]=e=>t.$emit("close"))}," Cancel "),Hr("button",{class:"btn btn-primary",onClick:k,disabled:0===h.value.size||f.value},[s[18]||(s[18]=Hr("i",{class:"fas fa-check"},null,-1)),Yr(" "+Y(f.value?"Assigning...":`Assign ${h.value.size} Activity(ies)`),1)],8,Lh)])]),p.value?(Lr(),qr(gh,{key:0,activity:p.value,onClose:s[6]||(s[6]=e=>p.value=null)},null,8,["activity"])):Xr("",!0)]))}},[["__scopeId","data-v-fc75fce2"]]);const Bh={class:"modal modal-large"},Fh={class:"modal-header"},Mh={class:"header-content"},qh={class:"modal-title"},Vh={class:"activity-meta-header"},Wh={class:"student-badge"},Kh={class:"level-badge"},zh={key:0,class:"status-badge completed"},Hh={key:1,class:"status-badge incomplete"},Jh={class:"modal-body"},Gh={class:"content-tabs"},Yh={key:0,class:"notification-dot"},Qh={class:"tab-content"},Xh={key:0,class:"responses-section"},Zh={class:"response-question"},ef={class:"response-answer"},tf={key:1,class:"empty-responses"},sf={class:"tab-content"},rf={class:"activity-content-preview"},nf={key:0,class:"content-section"},af=["innerHTML"],of={key:1,class:"content-section"},lf=["innerHTML"],cf={key:2,class:"content-section"},uf=["innerHTML"],df={key:3,class:"content-section"},hf=["innerHTML"],ff={key:4,class:"empty-content"},pf={class:"tab-content"},vf={class:"feedback-section"},gf={key:0,class:"existing-feedback"},yf={class:"feedback-meta"},mf={key:0,class:"read-status read"},_f={key:1,class:"read-status unread"},bf={class:"feedback-display"},wf={class:"feedback-editor"},kf={for:"feedback-input"},Sf={class:"modal-footer"},Ef={class:"footer-actions-left"},Of=["disabled"],Tf=["disabled"],Cf={class:"footer-actions-right"},Af=["disabled"],jf=Cu({__name:"ActivityDetailModal",props:{activity:{type:Object,required:!0},student:{type:Object,required:!0},staffContext:{type:Object,required:!0}},emits:["close","feedback-saved","status-changed"],setup(e,{emit:t}){const s=e,r=t,{loadActivityQuestions:n,markActivityComplete:i,markActivityIncomplete:a}=bu(),{saveFeedback:o}={allActivities:allActivities,isLoadingActivities:isLoadingActivities,loadAllActivities:loadAllActivities,saveFeedback:async(e,t,s)=>{try{if(!t||!t.trim())throw new Error("Feedback text is required");const{data:r,error:n}=await vu.from("activity_responses").update({staff_feedback:t.trim(),staff_feedback_by:s,staff_feedback_at:(new Date).toISOString(),feedback_read_by_student:!1,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(n)throw n;return await vu.from("activity_history").insert({student_email:r.student_email,activity_id:r.activity_id,action:"feedback_given",triggered_by:"staff",triggered_by_email:s,cycle_number:r.cycle_number,metadata:{feedback_length:t.length}}),console.log(" Feedback saved:",{responseId:e,feedbackLength:t.length}),r}catch(r){throw console.error("Failed to save feedback:",r),r}},getUnreadFeedbackCount:async e=>{try{const{count:t,error:s}=await vu.from("activity_responses").select("*",{count:"exact",head:!0}).eq("student_email",e).not("staff_feedback","is",null).eq("feedback_read_by_student",!1);if(s)throw s;return t||0}catch(t){return console.error("Failed to get unread feedback count:",t),0}},getStudentsAwaitingFeedbackRead:async e=>{try{const{data:t,error:s}=await vu.from("vespa_students").select("\n          id,\n          email,\n          full_name,\n          current_year_group,\n          activity_responses!inner (\n            id,\n            staff_feedback,\n            feedback_read_by_student,\n            staff_feedback_at\n          )\n        ").eq("school_id",e).not("activity_responses.staff_feedback","is",null).eq("activity_responses.feedback_read_by_student",!1);if(s)throw s;const r=new Map;return(t||[]).forEach(e=>{r.has(e.id)||r.set(e.id,{...e,unreadFeedbackCount:0}),r.get(e.id).unreadFeedbackCount+=e.activity_responses.length}),Array.from(r.values())}catch(t){return console.error("Failed to get students awaiting feedback read:",t),[]}},markActivityComplete:async(e,t,s,r)=>{try{const{data:n,error:i}=await vu.from("activity_responses").update({status:"completed",completed_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(i)throw i;return await vu.from("activity_history").insert({student_email:t,activity_id:s,action:"marked_complete",triggered_by:"staff",triggered_by_email:r,metadata:{note:"Staff override - marked complete"}}),console.log(" Activity marked complete by staff:",e),n}catch(n){throw console.error("Failed to mark activity complete:",n),n}},markActivityIncomplete:async(e,t,s,r)=>{try{const{data:n,error:i}=await vu.from("activity_responses").update({status:"assigned",completed_at:null,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(i)throw i;return await vu.from("activity_history").insert({student_email:t,activity_id:s,action:"marked_incomplete",triggered_by:"staff",triggered_by_email:r,metadata:{note:"Staff override - marked incomplete"}}),console.log(" Activity marked incomplete by staff:",e),n}catch(n){throw console.error("Failed to mark activity incomplete:",n),n}}},{getStaffEmail:l}=Tu(),c=bt("responses"),u=bt(s.activity.staff_feedback||""),d=bt([]),h=bt(!1),f=bt(!1),p=mn(()=>!!s.activity.completed_at),v=mn(()=>s.activity.staff_feedback&&!s.activity.feedback_read_by_student),g=mn(()=>{var e,t;return(null==(t=null==(e=s.activity.activities)?void 0:e.vespa_category)?void 0:t.toLowerCase())||""}),y=mn(()=>{var e,t,r,n;return(null==(e=s.activity.activities)?void 0:e.do_section_html)||(null==(t=s.activity.activities)?void 0:t.think_section_html)||(null==(r=s.activity.activities)?void 0:r.learn_section_html)||(null==(n=s.activity.activities)?void 0:n.reflect_section_html)}),m=mn(()=>{if(!s.activity.responses)return[];try{const e="string"==typeof s.activity.responses?JSON.parse(s.activity.responses):s.activity.responses;return Object.entries(e).map(([e,t])=>{const s=d.value.find(t=>t.id===e);return{question:(null==s?void 0:s.question_text)||"Question not found",answer:"object"==typeof t?t.value||JSON.stringify(t):t}})}catch(cp){return console.error("Error parsing responses:",cp),[]}});vs(async()=>{if(s.activity.activity_id){h.value=!0;try{d.value=await n(s.activity.activity_id)}catch(e){console.error("Failed to load questions:",e)}finally{h.value=!1}}});const _=async()=>{if(u.value.trim()){f.value=!0;try{await o(s.activity.id,u.value,l()),alert("Feedback saved successfully! Student will be notified."),r("feedback-saved")}catch(e){console.error("Failed to save feedback:",e),alert("Failed to save feedback. Please try again.")}finally{f.value=!1}}else alert("Please enter feedback before saving")},b=async()=>{if(confirm("Mark this activity as complete for the student?")){f.value=!0;try{await i(s.activity.id,s.activity.student_email,s.activity.activity_id,l()),alert("Activity marked as complete"),r("status-changed")}catch(e){console.error("Failed to mark complete:",e),alert("Failed to update status. Please try again.")}finally{f.value=!1}}},w=async()=>{if(confirm("Mark this activity as incomplete? Student will need to complete it again.")){f.value=!0;try{await a(s.activity.id,s.activity.student_email,s.activity.activity_id,l()),alert("Activity marked as incomplete"),r("status-changed")}catch(e){console.error("Failed to mark incomplete:",e),alert("Failed to update status. Please try again.")}finally{f.value=!1}}},k=e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})};return(t,s)=>{var r,n,i,a,o,l,d;return Lr(),Mr("div",{class:"modal-overlay",onClick:s[6]||(s[6]=ii(e=>t.$emit("close"),["self"]))},[Hr("div",Bh,[Hr("div",Fh,[Hr("div",Mh,[Hr("h3",qh,Y(null==(r=e.activity.activities)?void 0:r.name),1),Hr("div",Vh,[Hr("span",Wh,[s[7]||(s[7]=Hr("i",{class:"fas fa-user"},null,-1)),Yr(" "+Y(e.student.full_name),1)]),Hr("span",{class:W(["category-badge",g.value])},Y(null==(n=e.activity.activities)?void 0:n.vespa_category),3),Hr("span",Kh,Y(null==(i=e.activity.activities)?void 0:i.level),1),p.value?(Lr(),Mr("span",zh,[...s[8]||(s[8]=[Hr("i",{class:"fas fa-check-circle"},null,-1),Yr(" Completed ",-1)])])):(Lr(),Mr("span",Hh,[s[9]||(s[9]=Hr("i",{class:"fas fa-clock"},null,-1)),Yr(" "+Y(e.activity.status||"Assigned"),1)]))])]),Hr("button",{class:"modal-close",onClick:s[0]||(s[0]=e=>t.$emit("close"))},[...s[10]||(s[10]=[Hr("i",{class:"fas fa-times"},null,-1)])])]),Hr("div",Jh,[Hr("div",Gh,[Hr("button",{class:W(["tab-btn",{active:"responses"===c.value}]),onClick:s[1]||(s[1]=e=>c.value="responses")},[...s[11]||(s[11]=[Hr("i",{class:"fas fa-comments"},null,-1),Yr(" Student Responses ",-1)])],2),Hr("button",{class:W(["tab-btn",{active:"content"===c.value}]),onClick:s[2]||(s[2]=e=>c.value="content")},[...s[12]||(s[12]=[Hr("i",{class:"fas fa-book"},null,-1),Yr(" Activity Content ",-1)])],2),Hr("button",{class:W(["tab-btn",{active:"feedback"===c.value}]),onClick:s[3]||(s[3]=e=>c.value="feedback")},[s[13]||(s[13]=Hr("i",{class:"fas fa-comment-alt"},null,-1)),s[14]||(s[14]=Yr(" Feedback ",-1)),v.value?(Lr(),Mr("span",Yh)):Xr("",!0)],2)]),Qt(Hr("div",Qh,[p.value&&m.value.length>0?(Lr(),Mr("div",Xh,[(Lr(!0),Mr(Rr,null,Os(m.value,(e,t)=>(Lr(),Mr("div",{key:t,class:"response-item"},[Hr("div",Zh,[Hr("strong",null,"Q"+Y(t+1)+":",1),Yr(" "+Y(e.question),1)]),Hr("div",ef,Y(e.answer),1)]))),128))])):(Lr(),Mr("div",tf,[s[15]||(s[15]=Hr("i",{class:"fas fa-inbox empty-icon"},null,-1)),Hr("p",null,Y(p.value?"No responses recorded":"Student has not completed this activity yet"),1)]))],512),[[jn,"responses"===c.value]]),Qt(Hr("div",sf,[Hr("div",rf,[(null==(a=e.activity.activities)?void 0:a.do_section_html)?(Lr(),Mr("div",nf,[s[16]||(s[16]=Hr("h4",null,[Hr("i",{class:"fas fa-tasks"}),Yr(" DO")],-1)),Hr("div",{class:"html-content",innerHTML:e.activity.activities.do_section_html},null,8,af)])):Xr("",!0),(null==(o=e.activity.activities)?void 0:o.think_section_html)?(Lr(),Mr("div",of,[s[17]||(s[17]=Hr("h4",null,[Hr("i",{class:"fas fa-lightbulb"}),Yr(" THINK")],-1)),Hr("div",{class:"html-content",innerHTML:e.activity.activities.think_section_html},null,8,lf)])):Xr("",!0),(null==(l=e.activity.activities)?void 0:l.learn_section_html)?(Lr(),Mr("div",cf,[s[18]||(s[18]=Hr("h4",null,[Hr("i",{class:"fas fa-graduation-cap"}),Yr(" LEARN")],-1)),Hr("div",{class:"html-content",innerHTML:e.activity.activities.learn_section_html},null,8,uf)])):Xr("",!0),(null==(d=e.activity.activities)?void 0:d.reflect_section_html)?(Lr(),Mr("div",df,[s[19]||(s[19]=Hr("h4",null,[Hr("i",{class:"fas fa-mirror"}),Yr(" REFLECT")],-1)),Hr("div",{class:"html-content",innerHTML:e.activity.activities.reflect_section_html},null,8,hf)])):Xr("",!0),y.value?Xr("",!0):(Lr(),Mr("div",ff,[...s[20]||(s[20]=[Hr("i",{class:"fas fa-file-alt empty-icon"},null,-1),Hr("p",null,"No detailed content available for this activity",-1)])]))])],512),[[jn,"content"===c.value]]),Qt(Hr("div",pf,[Hr("div",vf,[e.activity.staff_feedback?(Lr(),Mr("div",gf,[Hr("div",yf,[Hr("span",null,[s[21]||(s[21]=Hr("i",{class:"fas fa-user"},null,-1)),Yr(" "+Y(e.activity.staff_feedback_by||"Staff"),1)]),Hr("span",null,[s[22]||(s[22]=Hr("i",{class:"fas fa-calendar"},null,-1)),Yr(" "+Y(k(e.activity.staff_feedback_at)),1)]),e.activity.feedback_read_by_student?(Lr(),Mr("span",mf,[...s[23]||(s[23]=[Hr("i",{class:"fas fa-check-double"},null,-1),Yr(" Read by student ",-1)])])):(Lr(),Mr("span",_f,[...s[24]||(s[24]=[Hr("i",{class:"fas fa-envelope"},null,-1),Yr(" Unread ",-1)])]))]),Hr("div",bf,Y(e.activity.staff_feedback),1)])):Xr("",!0),Hr("div",wf,[Hr("label",kf,[s[25]||(s[25]=Hr("i",{class:"fas fa-comment-alt"},null,-1)),Yr(" "+Y(e.activity.staff_feedback?"Update Feedback":"Provide Feedback"),1)]),Qt(Hr("textarea",{id:"feedback-input","onUpdate:modelValue":s[4]||(s[4]=e=>u.value=e),placeholder:"Enter your feedback for the student...",rows:"6",class:"feedback-textarea"},null,512),[[Zn,u.value]]),s[26]||(s[26]=Hr("div",{class:"feedback-hint"},[Hr("i",{class:"fas fa-info-circle"}),Yr(" Student will be notified of new feedback ")],-1))])])],512),[[jn,"feedback"===c.value]])]),Hr("div",Sf,[Hr("div",Ef,[p.value?(Lr(),Mr("button",{key:0,class:"btn btn-warning",onClick:w,disabled:f.value},[...s[27]||(s[27]=[Hr("i",{class:"fas fa-undo"},null,-1),Yr(" Mark Incomplete ",-1)])],8,Of)):(Lr(),Mr("button",{key:1,class:"btn btn-success",onClick:b,disabled:f.value},[...s[28]||(s[28]=[Hr("i",{class:"fas fa-check"},null,-1),Yr(" Mark Complete ",-1)])],8,Tf))]),Hr("div",Cf,[Hr("button",{class:"btn btn-secondary",onClick:s[5]||(s[5]=e=>t.$emit("close"))}," Cancel "),Hr("button",{class:"btn btn-primary",onClick:_,disabled:!u.value.trim()||f.value},[s[29]||(s[29]=Hr("i",{class:"fas fa-save"},null,-1)),Yr(" "+Y(f.value?"Saving...":"Save Feedback"),1)],8,Af)])])])])}}},[["__scopeId","data-v-70b179bf"]]),xf={class:"student-workspace"},Rf={class:"workspace-header"},Pf={class:"student-info"},If={class:"student-name"},$f={class:"student-meta"},Nf={class:"meta-badge"},Uf={key:0,class:"meta-badge"},Lf={key:1,class:"meta-badge"},Df={class:"meta-badge progress-badge"},Bf={class:"header-actions"},Ff={class:"workspace-content"},Mf={class:"section-header"},qf={class:"activities-by-category"},Vf={class:"category-icon"},Wf={class:"category-name"},Kf={class:"activity-count"},zf={class:"category-activities"},Hf={class:"level-section"},Jf={key:0,class:"empty-level"},Gf={class:"level-section"},Yf={key:0,class:"empty-level"},Qf=Cu({__name:"StudentWorkspace",props:{student:{type:Object,required:!0},staffContext:{type:Object,required:!0}},emits:["back","refresh"],setup(e,{emit:t}){const s=e,r=t,{removeActivity:n}=bu(),{getStaffEmail:i}=Tu(),a=bt(""),o=bt(!1),l=bt(null),c=["Vision","Effort","Systems","Practice","Attitude"],u=mn(()=>{var e;return(null==(e=s.student.activity_responses)?void 0:e.filter(e=>"removed"!==e.status))||[]}),d=mn(()=>{if(!a.value)return u.value;const e=a.value.toLowerCase();return u.value.filter(t=>{var s,r;return null==(r=null==(s=t.activities)?void 0:s.name)?void 0:r.toLowerCase().includes(e)})}),h=(e,t=!0)=>(t?d.value:[]).filter(t=>{var s;return(null==(s=t.activities)?void 0:s.vespa_category)===e}),f=e=>{l.value=e},p=async e=>{if(confirm(`Remove "${e.activities.name}" from ${s.student.full_name}?`))try{await n(e.student_email,e.activity_id,e.cycle_number,i()),r("refresh")}catch(t){console.error("Failed to remove activity:",t),alert("Failed to remove activity. Please try again.")}},v=()=>{o.value=!1,r("refresh")},g=()=>{l.value=null,r("refresh")},y=()=>{l.value=null,r("refresh")};return(t,s)=>(Lr(),Mr("div",xf,[Hr("div",Rf,[Hr("button",{class:"btn btn-secondary",onClick:s[0]||(s[0]=e=>t.$emit("back"))},[...s[6]||(s[6]=[Hr("i",{class:"fas fa-arrow-left"},null,-1),Yr(" Back to List ",-1)])]),Hr("div",Pf,[Hr("h2",If,Y(e.student.full_name),1),Hr("div",$f,[Hr("span",Nf,[s[7]||(s[7]=Hr("i",{class:"fas fa-envelope"},null,-1)),Yr(" "+Y(e.student.email),1)]),e.student.current_year_group?(Lr(),Mr("span",Uf,[s[8]||(s[8]=Hr("i",{class:"fas fa-graduation-cap"},null,-1)),Yr(" "+Y(e.student.current_year_group),1)])):Xr("",!0),e.student.student_group?(Lr(),Mr("span",Lf,[s[9]||(s[9]=Hr("i",{class:"fas fa-users"},null,-1)),Yr(" "+Y(e.student.student_group),1)])):Xr("",!0),Hr("span",Df,[s[10]||(s[10]=Hr("i",{class:"fas fa-chart-line"},null,-1)),Yr(" "+Y(e.student.progress)+"% Complete ",1)])])]),Hr("div",Bf,[Qt(Hr("input",{type:"search","onUpdate:modelValue":s[1]||(s[1]=e=>a.value=e),placeholder:"Search activities...",class:"search-input-compact"},null,512),[[Zn,a.value]]),Hr("button",{class:"btn btn-primary",onClick:s[2]||(s[2]=e=>o.value=!0)},[...s[11]||(s[11]=[Hr("i",{class:"fas fa-plus"},null,-1),Yr(" Assign Activities ",-1)])]),Hr("button",{class:"btn btn-secondary",onClick:s[3]||(s[3]=e=>t.$emit("refresh"))},[...s[12]||(s[12]=[Hr("i",{class:"fas fa-sync"},null,-1),Yr(" Refresh ",-1)])])])]),Hr("div",Ff,[Hr("div",Mf,[Hr("h3",null,[s[13]||(s[13]=Hr("i",{class:"fas fa-clipboard-check"},null,-1)),Yr(" Assigned Activities ("+Y(u.value.length)+") ",1)]),s[14]||(s[14]=Qr('<div class="legend" data-v-f7345965><span class="legend-item" data-v-f7345965><span class="source-dot questionnaire" data-v-f7345965></span> Questionnaire </span><span class="legend-item" data-v-f7345965><span class="source-dot staff" data-v-f7345965></span> Staff Assigned </span><span class="legend-item" data-v-f7345965><span class="source-dot student" data-v-f7345965></span> Student Choice </span><span class="legend-item" data-v-f7345965><span class="source-dot feedback" data-v-f7345965></span> Unread Feedback </span></div>',1))]),Hr("div",qf,[(Lr(),Mr(Rr,null,Os(c,t=>{return Hr("div",{key:t,class:"category-column"},[Hr("div",{class:W(["category-header",t.toLowerCase()])},[Hr("span",Vf,Y((r=t,{Vision:"",Effort:"",Systems:"",Practice:"",Attitude:""}[r]||r[0])),1),Hr("span",Wf,Y(t),1),Hr("span",Kf,Y(h(t,!0).filter(e=>e.completed_at).length)+"/"+Y(h(t,!0).length),1)],2),Hr("div",zf,[Hr("div",Hf,[s[15]||(s[15]=Hr("div",{class:"level-label"},"Level 2",-1)),(Lr(!0),Mr(Rr,null,Os(h(t,!0).filter(e=>"Level 2"===e.activities.level),t=>(Lr(),qr(Gd,{key:t.id,activity:t,student:e.student,"is-assigned":!0,onClick:e=>f(t),onRemove:e=>p(t)},null,8,["activity","student","onClick","onRemove"]))),128)),0===h(t,!0).filter(e=>"Level 2"===e.activities.level).length?(Lr(),Mr("div",Jf," No Level 2 activities ")):Xr("",!0)]),Hr("div",Gf,[s[16]||(s[16]=Hr("div",{class:"level-label"},"Level 3",-1)),(Lr(!0),Mr(Rr,null,Os(h(t,!0).filter(e=>"Level 3"===e.activities.level),t=>(Lr(),qr(Gd,{key:t.id,activity:t,student:e.student,"is-assigned":!0,onClick:e=>f(t),onRemove:e=>p(t)},null,8,["activity","student","onClick","onRemove"]))),128)),0===h(t,!0).filter(e=>"Level 3"===e.activities.level).length?(Lr(),Mr("div",Yf," No Level 3 activities ")):Xr("",!0)])])]);var r}),64))])]),o.value?(Lr(),qr(Dh,{key:0,student:e.student,"staff-context":e.staffContext,onClose:s[4]||(s[4]=e=>o.value=!1),onAssigned:v},null,8,["student","staff-context"])):Xr("",!0),l.value?(Lr(),qr(jf,{key:1,activity:l.value,student:e.student,"staff-context":e.staffContext,onClose:s[5]||(s[5]=e=>l.value=null),onFeedbackSaved:g,onStatusChanged:y},null,8,["activity","student","staff-context"])):Xr("",!0)]))}},[["__scopeId","data-v-f7345965"]]),Xf=bt([]),Zf=bt(!1),ep=bt(null);const tp={id:"vespa-staff-app",class:"staff-app"},sp={key:0,class:"loading-screen"},rp={class:"loading-content"},np={class:"loading-text"},ip={key:1,class:"error-screen"},ap={class:"error-content"},op={key:2,class:"dashboard-container"},lp={__name:"App",setup(e){const t=bt(!0),s=bt("Initializing..."),r=bt(null),n=bt("list"),i=bt(null),{isAuthenticated:a,staffContext:o,checkAuth:l}=Tu(),{students:c,isLoadingStudents:u,loadStudents:d,getStudent:h}=function(){const{staffContext:e,currentUser:t,hasRole:s}=Tu();return{students:Xf,isLoadingStudents:Zf,studentsError:ep,loadStudents:async()=>{Zf.value=!0,ep.value=null;try{let r,n;if(console.log(" Loading students via RPC for school:",e.value.schoolId),console.log(" Staff email:",t.value.email),e.value.isSuperUser||s("staff_admin")){console.log(" Admin access - loading ALL students via RPC");const s=await vu.rpc("get_students_for_staff",{staff_email_param:t.value.email,school_id_param:e.value.schoolId});r=s.data,n=s.error}else{console.log(" Regular staff - loading CONNECTED students via RPC");const s=await vu.rpc("get_connected_students_for_staff",{staff_email_param:t.value.email,school_id_param:e.value.schoolId,connection_type_filter:null});r=s.data,n=s.error}if(n)throw n;Xf.value=(r||[]).map(e=>({...e,prescribedCount:e.total_activities||0,completedCount:e.completed_activities||0,totalCompletedCount:e.completed_activities||0,progress:e.total_activities>0?Math.round(e.completed_activities/e.total_activities*100):0,categoryBreakdown:{vision:{prescribed:Array(e.vision_total||0).fill(null),completed:Array(e.vision_completed||0).fill(null)},effort:{prescribed:Array(e.effort_total||0).fill(null),completed:Array(e.effort_completed||0).fill(null)},systems:{prescribed:Array(e.systems_total||0).fill(null),completed:Array(e.systems_completed||0).fill(null)},practice:{prescribed:Array(e.practice_total||0).fill(null),completed:Array(e.practice_completed||0).fill(null)},attitude:{prescribed:Array(e.attitude_total||0).fill(null),completed:Array(e.attitude_completed||0).fill(null)}},unreadFeedbackCount:0})),console.log(` Loaded ${Xf.value.length} students via RPC`)}catch(r){throw console.error(" Failed to load students:",r),ep.value=r.message,r}finally{Zf.value=!1}},getStudent:async s=>{try{console.log(" Getting student:",s);const r=Xf.value.find(e=>e.id===s);if(!r)return console.warn(" Student not found in cache"),null;console.log(" Found student in cache:",r.full_name),console.log(" Fetching activity_responses for:",r.email);const{data:n,error:i}=await vu.rpc("get_student_activity_responses",{student_email_param:r.email,staff_email_param:t.value.email,school_id_param:e.value.schoolId});if(i)throw console.error("Failed to fetch activity_responses:",i),i;const a=(n||[]).map(e=>({...e,activities:{id:e.activity_id,name:e.activity_name,vespa_category:e.activity_category,level:e.activity_level,time_minutes:e.activity_time_minutes,difficulty:e.activity_difficulty,do_section_html:e.activity_do_section,think_section_html:e.activity_think_section,learn_section_html:e.activity_learn_section,reflect_section_html:e.activity_reflect_section}}));return console.log(` Loaded ${(null==a?void 0:a.length)||0} activity responses for ${r.full_name}`),{...r,activity_responses:a||[]}}catch(r){throw console.error("Failed to get student:",r),r}},filterStudents:e=>{if(!e)return Xf.value;const t=e.toLowerCase();return Xf.value.filter(e=>{var s,r,n;return(null==(s=e.full_name)?void 0:s.toLowerCase().includes(t))||(null==(r=e.email)?void 0:r.toLowerCase().includes(t))||(null==(n=e.student_group)?void 0:n.toLowerCase().includes(t))})}}}();vs(async()=>{try{if(s.value="Checking authentication...",await l(),!a.value)return void(r.value="You must be logged in as staff to access this dashboard.");s.value="Loading students...",await d(),console.log(" Staff Dashboard initialized successfully")}catch(e){console.error(" Failed to initialize dashboard:",e),r.value=e.message||"Failed to initialize dashboard. Please try refreshing the page."}finally{t.value=!1}});const f=async e=>{try{const t=await h(e);t&&(i.value=t,n.value="workspace")}catch(t){console.error("Failed to load student:",t),alert("Error loading student details. Please try again.")}},p=()=>{n.value="list",i.value=null},v=async()=>{if(i.value){const e=await h(i.value.id);e&&(i.value=e)}};return(e,l)=>(Lr(),Mr("div",tp,[t.value?(Lr(),Mr("div",sp,[Hr("div",rp,[l[0]||(l[0]=Hr("div",{class:"loading-spinner"},null,-1)),l[1]||(l[1]=Hr("h2",null,"Loading VESPA Staff Dashboard...",-1)),Hr("p",np,Y(s.value),1)])])):r.value?(Lr(),Mr("div",ip,[Hr("div",ap,[l[2]||(l[2]=Hr("i",{class:"fas fa-exclamation-triangle error-icon"},null,-1)),l[3]||(l[3]=Hr("h2",null,"Authentication Required",-1)),Hr("p",null,Y(r.value),1),l[4]||(l[4]=Hr("p",{class:"error-hint"},"Please log in through Knack to access the staff dashboard.",-1))])])):kt(a)?(Lr(),Mr("div",op,["list"===n.value?(Lr(),qr($d,{key:0,students:kt(c),"is-loading":kt(u),"staff-context":kt(o),onViewStudent:f,onRefresh:kt(d)},null,8,["students","is-loading","staff-context","onRefresh"])):"workspace"===n.value&&i.value?(Lr(),qr(Qf,{key:1,student:i.value,"staff-context":kt(o),onBack:p,onRefresh:v},null,8,["student","staff-context"])):Xr("",!0)])):Xr("",!0)]))}};window.initializeStaffActivitiesMonitorV3=function(){console.log("[VESPA Staff Activities V3] Initializer called by KnackAppLoader");const e=window.STAFF_ACTIVITIES_MONITOR_V3_CONFIG;if(!e)return console.error("[VESPA Staff Activities V3] Config not found"),!1;console.log("[VESPA Staff Activities V3] Config:",e);const t=document.querySelector(e.elementSelector||"#view_3268");if(!t)return console.error("[VESPA Staff Activities V3] Target element not found:",e.elementSelector),!1;console.log("[VESPA Staff Activities V3] Mounting into:",e.elementSelector),t.innerHTML="";const s=document.createElement("div");s.id="vespa-staff-activities-app",s.style.width="100%",s.style.minHeight="600px",s.style.display="flex",s.style.flexDirection="column",t.appendChild(s);try{const t=li(lp,{config:e});return t.config.errorHandler=(e,t,s)=>{console.error("[VESPA Staff V3] Vue Error:",e),console.error("[VESPA Staff V3] Error Info:",s)},t.mount("#vespa-staff-activities-app"),console.log("[VESPA Staff Activities V3] App mounted successfully"),!0}catch(r){return console.error("[VESPA Staff Activities V3] Mount error:",r),s.innerHTML='<div style="padding: 20px; color: red; text-align: center;"><h3>Error loading Staff Dashboard</h3><p>'+r.message+"</p></div>",!1}},console.log("[VESPA Staff Activities V3] Script loaded, initializer function available")}();
